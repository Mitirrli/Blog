[{"categories":["php"],"content":"1. äº‹ä»¶å¾ªç¯ (Event Loop) 1 2 3 4 5 6 7 8 9 10 11  $loop = Factory::create(); $loop-\u003eaddTimer(0.5, function () { echo 'world'; }); $loop-\u003eaddTimer(0.3, function () { echo 'hello'; }); $loop-\u003erun();   ","description":"","tags":["react-php"],"title":"React Php","uri":"/php/react-php/"},{"categories":["c"],"content":"1. ä¸‹è½½æœ€æ–°ç‰ˆçš„ php $ axel -n 6 https://github.com/php/php-src/archive/php-8.0.0RC3.tar.gz //axelæ˜¯ä¸€ä¸ªå¤šçº¿ç¨‹ä¸‹è½½å·¥å…·,å¤§å¤§æå‡äº†ä¸‹è½½é€Ÿåº¦ 2. ç¼–è¯‘ php $ ./buildconf \u0026\u0026 ./configure --prefix=[PATH] --with-iconv=$(brew --prefix libiconv) $ make $ make install 3. æ„å»º c æ‰©å±• 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15  $ cd ext //å®˜æ–¹æ‹“å±•ç›®å½• $ ./ext_skel.php --ext testextension //åˆ›å»ºæ‰©å±• $ cd testextension $ sudo ../../output/bin/phpize $ ./configure --with-php-config=[PATH]/bin/php-config $ make \u0026\u0026 make install $ echo 'extension=testextension.so' \u003e\u003e ../../output/lib/php.ini //å†™å…¥é…ç½®æ–‡ä»¶ä¸­ $ ../../output/bin/php -m //æ­¤æ—¶å·²ç»å¯ä»¥çœ‹åˆ°æ‰©å±•å·²ç»å­˜åœ¨   4. ä½¿ç”¨å¯¹åº”çš„æ–¹æ³• $ ../../output/bin/php -r \"echo test1();\" $ ../../output/bin/php -r \"echo test2();\" ","description":"","tags":["php","c"],"title":"ç¼–è¯‘ PHP \u0026\u0026 æ„å»º c æ‰©å±•","uri":"/php/compile/"},{"categories":["chrome"],"content":" vimium æ˜¯ vim å’Œ chrome ç»“åˆï¼Œè®©ä½ ä¸ç”¨ç§»åŠ¨é¼ æ ‡å°±èƒ½è·³è½¬é¡µé¢ï¼Œåˆ‡æ¢æ ‡ç­¾ï¼Œæ‰“å¼€å†å²è®°å½•ï¼Œæ‰“å¼€ä¹¦ç­¾ç­‰ç­‰ã€‚\n ä½¿ç”¨æ–¹æ³•: 1. F (Open link in new tab) 2. f (Open link in current tab) 3. J (åé€€) 4. K (å‰è¿›) 5. / (æœç´¢) 6. o (å¿«é€Ÿæœç´¢) 7. r (åˆ·æ–°) ","description":"","tags":["vim","chrome"],"title":"ç»™ Chrome å®‰ä¸Š Vimium","uri":"/chrome/vimium/"},{"categories":["php"],"content":" Garbage Collector ç®€ç§° GC\n å…³äºå¼•ç”¨è®¡æ•° 1 2 3 4 5 6 7 8  \u003c?php $a = \"new string\"; $b = $a; xdebug_debug_zval('a'); // a: (interned, is_ref=0)='new string'   ","description":"","tags":["php"],"title":"Php åƒåœ¾å›æ”¶æœºåˆ¶","uri":"/php/gc/"},{"categories":["php"],"content":"Part 1. PHP FPM å’Œ NGINX  nginx æœ¬èº«ä¸èƒ½å¤„ç† php,å½“æ”¶åˆ°è¯·æ±‚å,å¦‚æœæ˜¯ php è¯·æ±‚,åœ¨æœ¬æ–‡ä¸­,ä»–å°†è¯·æ±‚å‘é€ç»™ fastcgi ç®¡ç†è¿›ç¨‹å¤„ç†,fastcgi ç®¡ç†è¿›ç¨‹ä¼šé€‰æ‹©å­è¿›ç¨‹å¤„ç†å®Œè¿”å›ç»“æœç»™ nginx\n ä¸ºäº†ä¸ç ´åæœ¬æœºçš„ç¯å¢ƒ,æ­å»ºä¸€ä¸ª ubuntu çš„ docker ç¯å¢ƒ 1. CGI å’Œ FastCGI 1 2 3 4 5  1. CGI(common gateway interface å…¬å…±ç½‘å…³æ¥å£) å¯¹äºåŠ¨æ€çš„è¯·æ±‚ï¼Œéœ€è¦ç”¨åˆ°cgiåè®®ï¼Œå°†è¯·æ±‚æ•°æ®è½¬æ¢æˆphpèƒ½ç†è§£çš„ä¿¡æ¯ï¼Œç„¶åphpæ ¹æ®è¿™äº›ä¿¡æ¯è¿”å›çš„ä¿¡æ¯ä¹Ÿè¦é€šè¿‡cgiåè®®è½¬æ¢æˆnginxå¯ä»¥ç†è§£çš„ä¿¡æ¯ï¼Œæœ€ånginxæ¥åˆ°è¿™äº›ä¿¡æ¯å†è¿”å›ç»™æµè§ˆå™¨ 2. FastCGI ä¼ ç»Ÿçš„cgiåè®®åœ¨æ¯æ¬¡è¿æ¥è¯·æ±‚æ—¶ï¼Œä¼šå¼€å¯ä¸€ä¸ªè¿›ç¨‹è¿›è¡Œå¤„ç†ï¼Œå¤„ç†å®Œæ¯•ä¼šå…³é—­è¯¥è¿›ç¨‹ï¼Œå‘¨è€Œå¤å§‹ã€‚å› æ­¤æœ‰å¤šå°‘ä¸ªè¿æ¥å°±æœ‰å¤šå°‘ä¸ªcgiè¿›ç¨‹ï¼Œè¿‡å¤šçš„è¿›ç¨‹ä¼šæ¶ˆè€—èµ„æºå’Œå†…å­˜   php-cgi  php-cgi æ˜¯ php æä¾›ç»™ web serve çš„ cgi åè®®æ¥å£ç¨‹åº\n 1 2 3 4 5  å½“æ¯æ¬¡æ¥åˆ°httpå‰ç«¯æœåŠ¡å™¨çš„è¯·æ±‚éƒ½ä¼šå¼€å¯ä¸€ä¸ªphp-cgiè¿›ç¨‹è¿›è¡Œå¤„ç† è€Œä¸”å¼€å¯çš„php-cgiçš„è¿‡ç¨‹ä¸­ä¼šå…ˆè¦é‡è½½é…ç½®ï¼Œæ•°æ®ç»“æ„ä»¥åŠåˆå§‹åŒ–è¿è¡Œç¯å¢ƒï¼Œå¦‚æœæ›´æ–°äº†phpé…ç½®ï¼Œé‚£ä¹ˆå°±éœ€è¦é‡å¯php-cgiæ‰èƒ½ç”Ÿæ•ˆ ç›´æ¥æ€æ­»php-cgiè¿›ç¨‹,phpå°±ä¸èƒ½è¿è¡Œäº†(PHP-FPMæ²¡æœ‰è¿™ä¸ªé—®é¢˜,å®ˆæŠ¤è¿›ç¨‹ä¼šå¹³æ»‘ä»æ–°ç”Ÿæˆæ–°çš„å­è¿›ç¨‹ï¼‰   php-fpm  php-fpm æ˜¯ php æä¾›ç»™ web serve çš„ fastcgi åè®®æ¥å£ç¨‹åº\n 1 2 3 4 5 6 7 8 9  PHP-FPM å…è®¸ä¸€ä¸ªè¿›ç¨‹å¯¹å¤šä¸ªè¿æ¥è¿›è¡Œå¤„ç†ï¼Œè€Œä¸ä¼šç«‹å³å…³é—­è¿™ä¸ªè¿›ç¨‹ï¼Œè€Œæ˜¯ä¼šæ¥ç€å¤„ç†ä¸‹ä¸€ä¸ªè¿æ¥,å®ƒå¯ä»¥è¯´æ˜¯php-cgiçš„ä¸€ä¸ªç®¡ç†ç¨‹åºï¼Œæ˜¯å¯¹php-cgiçš„æ”¹è¿› php-fpmä¼šå¼€å¯å¤šä¸ªphp-cgiç¨‹åºï¼Œå¹¶ä¸”php-fpmå¸¸é©»å†…å­˜ æ¯æ¬¡web serveæœåŠ¡å™¨å‘é€è¿æ¥è¿‡æ¥çš„æ—¶å€™ï¼Œphp-fpmå°†è¿æ¥ä¿¡æ¯åˆ†é…ç»™ä¸‹é¢å…¶ä¸­çš„ä¸€ä¸ªå­ç¨‹åºphp-cgiè¿›è¡Œå¤„ç†ï¼Œå¤„ç†å®Œæ¯•è¿™ä¸ªphp-cgiå¹¶ä¸ä¼šå…³é—­ï¼Œè€Œæ˜¯ç»§ç»­ç­‰å¾…ä¸‹ä¸€ä¸ªè¿æ¥ï¼Œè¿™ä¹Ÿæ˜¯fast-cgiåŠ é€Ÿçš„åŸç† ä½†æ˜¯ç”±äºphp-fpmæ˜¯å¤šè¿›ç¨‹çš„ï¼Œè€Œä¸€ä¸ªphp-cgiåŸºæœ¬æ¶ˆè€—7-25Må†…å­˜ï¼Œå› æ­¤å¦‚æœè¿æ¥è¿‡å¤šå°±ä¼šå¯¼è‡´å†…å­˜æ¶ˆè€—è¿‡å¤§ php-fpmå°†æ–°çš„è¿æ¥å‘é€ç»™æ–°çš„å­ç¨‹åºphp-cgiï¼Œè¿™ä¸ªæ—¶å€™åŠ è½½çš„æ˜¯æ–°çš„é…ç½®ï¼Œè€ŒåŸå…ˆæ­£åœ¨è¿è¡Œçš„php-cgiè¿˜æ˜¯ä½¿ç”¨çš„åŸå…ˆçš„é…ç½®ï¼Œç­‰åˆ°è¿™ä¸ªè¿æ¥åä¸‹ä¸€æ¬¡è¿æ¥çš„æ—¶å€™ä¼šä½¿ç”¨æ–°çš„é…ç½®åˆå§‹åŒ–ï¼Œè¿™å°±æ˜¯å¹³æ»‘è¿‡æ¸¡   FastCGI çš„å·¥ä½œæµç¨‹ 1 2 3 4  Web Serverå¯åŠ¨æ—¶è½½å…¥FastCGIè¿›ç¨‹ç®¡ç†å™¨ FastCGIè¿›ç¨‹ç®¡ç†å™¨è‡ªèº«åˆå§‹åŒ–ï¼Œå¯åŠ¨å¤šä¸ªCGIè§£é‡Šå™¨è¿›ç¨‹(å¯è§å¤šä¸ªphp-cgi)å¹¶ç­‰å¾…æ¥è‡ªWeb Serverçš„è¿æ¥ å½“å®¢æˆ·ç«¯è¯·æ±‚åˆ°è¾¾Web Serveræ—¶ï¼ŒFastCGIè¿›ç¨‹ç®¡ç†å™¨é€‰æ‹©å¹¶è¿æ¥åˆ°ä¸€ä¸ªCGIè§£é‡Šå™¨ã€‚ Web serverå°†CGIç¯å¢ƒå˜é‡å’Œæ ‡å‡†è¾“å…¥å‘é€åˆ°FastCGIå­è¿›ç¨‹php-cgi FastCGI å­è¿›ç¨‹å®Œæˆå¤„ç†åå°†æ ‡å‡†è¾“å‡ºå’Œé”™è¯¯ä¿¡æ¯ä»åŒä¸€è¿æ¥è¿”å›Web Serverã€‚å½“FastCGIå­è¿›ç¨‹å…³é—­è¿æ¥æ—¶ï¼Œè¯·æ±‚ä¾¿å‘Šå¤„ç†å®Œæˆã€‚FastCGIå­è¿›ç¨‹æ¥ç€ç­‰å¾…å¹¶å¤„ç†æ¥è‡ªFastCGIè¿›ç¨‹ç®¡ç†å™¨(è¿è¡Œåœ¨Web Serverä¸­)çš„ä¸‹ä¸€ä¸ªè¿æ¥ã€‚åœ¨CGIæ¨¡å¼ä¸­ï¼Œphp-cgiåœ¨æ­¤ä¾¿é€€å‡ºäº†   å‚è€ƒæ–‡ç« \n2. ç¼–è¯‘å®‰è£… php 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23  $ docker pull ubuntu:latest $ docker run --name ubuntu --cap-add=SYS_PTRACE -p 6767:80 -d ubuntu /bin/bash -c \"while true; do echo 1; sleep 1; done\" $ docker exec -it ubuntu bash //è¿›å…¥å®¹å™¨ $ cd /tmp $ sed -i 's/archive.ubuntu.com/mirrors.ustc.edu.cn/g' /etc/apt/sources.list //ä½¿ç”¨å›½å†…é•œåƒ $ apt-get update \u0026\u0026 apt install -y wget curl vim gcc pkg-config systemctl make libxml2-dev libsqlite3-dev //ä¸‹è½½ä¹‹åéœ€è¦çš„ä¸€äº›tool $ wget -c https://downloads.php.net/~carusogabriel/php-8.0.0beta3.tar.gz //æˆ‘è¿™è¾¹ç›´æ¥å®‰è£…å½“å‰æœ€æ–°ç‰ˆ $ tar zxvf php-8.0.0beta3.tar.gz $ cd php-8.0.0beta3 $ ./configure --prefix=/tmp/php-8.0.0beta3/output --enable-fpm --with-fpm-user=www-data --with-fpm-group=www-data //åœ¨é…ç½®çš„æ—¶å€™è®¾ç½®è·¯å¾„(å®‰è£…çš„è·¯å¾„å‰ç¼€),é€‰æ‹©å¼€å¯fpm,åŒæ—¶è®¾ç½®fpmçš„userå’Œgroup $ make //ç¼–è¯‘,è¿™ä¸€æ­¥éœ€è¦æ¯”è¾ƒé•¿çš„æ—¶é—´(ä¹‹åsapi/cliç›®å½•é‡Œå°±å·²ç»æœ‰äº†phpçš„å¯æ‰§è¡Œæ–‡ä»¶) $ make install //å®‰è£…(make installåå¯ä»¥æ‰§è¡Œ$prefix/bin/php,æ­¤æ—¶åœ¨/tmp/php-8.0.0beta3/output/sbinç›®å½•ä¸‹å·²ç»æœ‰äº†php-fpmçš„å¯æ‰§è¡Œæ–‡ä»¶)   3. é‡å‘½åé…ç½®æ–‡ä»¶ 1  $ mv /tmp/php-8.0.0beta3/output/etc/php-fpm.conf.default /tmp/php-8.0.0beta3/output/etc/php-fpm.conf \u0026\u0026 mv /tmp/php-8.0.0beta3/output/etc/php-fpm.d/www.conf.default /tmp/php-8.0.0beta3/output/etc/php-fpm.d/www.conf   4. å®‰è£… nginx 1  $ apt install -y nginx   5. ä½¿ç”¨ unix å¥—æ¥å­—é€šè®¯ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15  $ mkdir -p /var/run/php-fpm $ vim /tmp/php-8.0.0beta3/output/etc/php-fpm.d/www.conf // ä¿®æ”¹ listen = /var/run/php-fpm/php8-fpm.sock // æ‰“å¼€æ³¨é‡Š listen.owner = www-data // æ‰“å¼€æ³¨é‡Š listen.group = www-data // æ‰“å¼€æ³¨é‡Š listen.mode = 0660 $ vim /tmp/php-8.0.0beta3/output/etc/php-fpm.conf // æ‰“å¼€æ³¨é‡Š pid = run/php-fpm.pid // æ‰“å¼€æ³¨é‡Š error_log = log/php-fpm.log $ /tmp/php-8.0.0beta3/output/sbin/php-fpm -R //å¯åŠ¨php-fpm $ ps -ef | grep php-fpm //è¿™æ ·å·²ç»å¯ä»¥çœ‹åˆ°å¯¹åº”çš„php-fpmè¿›ç¨‹äº†   6. åˆ›å»ºä¸€ä¸ª php æ–‡ä»¶ 1  $ vim /opt/index.php   1 2 3  \u003c?php echo phpinfo();   7. nginx åˆ›å»ºä¸€ä¸ªé…ç½®æ–‡ä»¶ 1  $ vim /etc/nginx/conf.d/demo.conf //åˆ›å»ºä¸€ä¸ªé…ç½®æ–‡ä»¶   1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22  server { listen 80; server_name 127.0.0.1; root /opt; location / { index index.html index.htm index.php; if (!-e $request_filename) { rewrite ^/(.*)$ /index.php?s=$1 last; rewrite index.php/(.*)$ /index.php?s=$1 last; break; } } location ~ \\.php$ { fastcgi_pass unix:/var/run/php-fpm/php8-fpm.sock; fastcgi_index index.php; fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name; include fastcgi_params; } }   1 2 3 4 5  $ systemctl stop nginx $ nginx -c /etc/nginx/nginx.conf $ nginx -s reload //reloadä¼šé‡æ–°åŠ è½½é…ç½®æ–‡ä»¶   1  $ curl 127.0.0.1 //åœ¨å®¹å™¨ä¸­æ‰§è¡Œæœ¬å‘½ä»¤å¯ä»¥çœ‹åˆ°æˆåŠŸç»“æœ,å®¹å™¨å¤–è®¿é—®http://127.0.0.1:6767/å¯ä»¥æŸ¥çœ‹å¯¹åº”è¯¦æƒ…   Part 2. PHP FPMé…ç½® 1. slow log 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16  $ cd /tmp/php-8.0.0beta3/output \u0026\u0026 mkdir log \u0026\u0026 chown -R www-data:www-data log # æ…¢æ—¥å¿—ç›®å½•åœ¨ /tmp/php-8.0.0beta3/output/log $ vim /tmp/php-8.0.0beta3/output/etc/php-fpm.d/www.conf //æ‰“å¼€æ…¢æ—¥å¿—å¼€å…³ ; The log file for slow requests ; Default Value: not set ; Note: slowlog is mandatory if request_slowlog_timeout is set slowlog = log/$pool.log.slow ; The timeout for serving a single request after which a PHP backtrace will be ; dumped to the 'slowlog' file. A value of '0s' means 'off'. ; Available units: s(econds)(default), m(inutes), h(ours), or d(ays) ; Default Value: 0 request_slowlog_timeout = 1s   PHP-FPMå¯ä»¥åˆ›å»ºæ…¢æ—¥å¿—æ–‡ä»¶ï¼Œä½†æ˜¯å´ä¸èƒ½ç»™æ…¢æ—¥å¿—æ–‡ä»¶å†™å…¥å†…å®¹\n2. é…ç½®php-fpm 1  $ ps -ef | grep php-fpm //å¯ä»¥çœ‹åˆ°ç›®å‰æœ‰1ä¸ªFastcgiè¿›ç¨‹ç®¡ç†å™¨å’Œ2ä¸ªFastcgiå­è¿›ç¨‹   1  $ vim /tmp/php-8.0.0beta3/output/etc/php-fpm.d/www.conf //ä¿®æ”¹é…ç½®æ–‡ä»¶   1 2 3 4 5 6 7 8 9  ; The number of child processes created on startup. ; Note: Used only when pm is set to 'dynamic' ; Default Value: (min_spare_servers + max_spare_servers) / 2 pm.start_servers = 4 ; The desired maximum number of idle server processes. ; Note: Used only when pm is set to 'dynamic' ; Note: Mandatory when pm is set to 'dynamic' pm.max_spare_servers = 4   1 2 3  $ kill -USR2 `cat /tmp/php-8.0.0beta3/output/var/run/php-fpm.pid` //é‡å¯php-fpm $ ps -ef | grep php-fpm //å¯ä»¥çœ‹åˆ°ç›®å‰æœ‰1ä¸ªFastcgiè¿›ç¨‹ç®¡ç†å™¨å’Œ4ä¸ªFastcgiå­è¿›ç¨‹   3. php-fpmå‚æ•°è¯´æ˜ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73  #php-fpmçš„è¿è¡Œæƒé™ã€‚ #ä»¥ä»€ä¹ˆç”¨æˆ·ä»€ä¹ˆç»„çš„æƒé™æ¥è¿è¡Œæ± fpmã€‚ user = www group = www #php-fpmçš„è¿è¡Œæ–¹å¼ï¼Œå¯ä»¥ä½¿ç«¯å£ï¼Œä¹Ÿå¯ä»¥ä½¿sockeæ–‡ä»¶ã€‚ #å¦‚æœæ˜¯ç«¯å£åˆ™æ˜¯èµ°tcpï¼Œå¦‚æœæ˜¯socketåˆ™ç›´æ¥è¯»socketæ–‡ä»¶ï¼Œè¿™æ ·æ€§èƒ½ç›¸å¯¹æ›´å¥½ã€‚ listen = 127.0.0.1:9000 #æ‹¥æœ‰socketæƒé™çš„ç”¨æˆ·ï¼Œéœ€è¦å’Œä¸Šé¢çš„userã€groupé…ç½®ç›¸ç»“åˆã€‚ #å¦‚æœé‡‡ç”¨çš„ç«¯å£çš„æ–¹å¼ï¼Œåˆ™ä¸é…ç½®ã€‚ listen.owner = www listen.group = www listen.mode = 0660 #è¿™æ˜¯php-fpmç«¯å£è¿æ¥çš„åœ°å€ã€‚å¤šä¸ªç”¨\",\"éš”å¼€ã€‚é»˜è®¤ä»»æ„åœ°å€éƒ½å¯ä»¥è¿æ¥ã€‚ #ä¾‹å¦‚Nginxå’Œphp-fpmä¸åœ¨åŒä¸€å°æœåŠ¡å™¨ä¸Šï¼Œè¿™é‡Œçš„å€¼å°±æ˜¯NginxæœåŠ¡çš„ipåœ°å€ã€‚ #å½“Nginxå’Œphp-fpmé…ç½®åœ¨åŒä¸€å°æœåŠ¡å™¨ä¸Šï¼Œåˆ™ç›´æ¥å†™127.0.0.1å³å¯ã€‚ listen.allowed_clients = 127.0.0.1 #pidè¿›ç¨‹æ–‡ä»¶å­˜æ”¾çš„ä½ç½®ï¼Œå½“æˆ‘ä»¬å¯ç”¨ä¸€ä¸ªphpæœåŠ¡ï¼Œ #åˆ™ä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªè¯¥pidæ–‡ä»¶ï¼Œå…¶å®æˆ‘ä»¬å¯ä»¥ç›´æ¥æŠŠè¯¥æ–‡ä»¶ç†è§£ç†è§£php-fpmçš„è¿›ç¨‹å·æ–‡ä»¶ï¼Œ #ä¸¤åˆ™æ˜¯ç­‰ä»·çš„ã€‚é»˜è®¤ä¸ºnoneã€‚ pid = /opt/remi/php72/root/var/run/php-fpm/php-fpm.pid #é”™è¯¯æ—¥å¿—ä½ç½®ï¼Œé»˜è®¤ï¼šå®‰è£…è·¯å¾„ #INSTALL_PREFIX#/log/php-fpm.logã€‚ #å¦‚æœè®¾ç½®ä¸ºsyslogï¼Œlogå°±ä¼šå‘é€ç»™syslogdæœåŠ¡è€Œä¸ä¼šå†™è¿›æ–‡ä»¶é‡Œã€‚ error_log = /opt/remi/php72/root/var/log/php-fpm/error.log #PHPé™åˆ¶çš„æ–‡ä»¶æ‰©å±•å security.limit_extensions = .php .php3 .php4 .php5 .php7 #ç³»ç»Ÿæ—¥å¿—æ ‡ç¤ºï¼Œå¦‚æœè·‘äº†å¤šä¸ªfpmè¿›ç¨‹ï¼Œéœ€è¦ç”¨è¿™ä¸ªæ¥åŒºåˆ†æ—¥å¿—æ˜¯è°çš„ã€‚ syslog.ident = php-fpm #æ—¥è®°ç™»è®°ï¼Œå¯é€‰ï¼šalert, error, warning, notice, debugã€‚ log_level = notice #ç´§æ€¥é‡å¯é˜ˆå€¼ï¼Œéœ€è¦ä¸ä¸‹é¢emergency_restart_intervalå‚æ•°ä¸€èµ·é…ç½®ã€‚ emergency_restart_threshold = 60 # ç´§æ€¥é‡å¯é˜ˆå€¼çš„æ—¶é—´èŒƒå›´ã€‚åœ¨æ­¤å‚æ•°è®¾ç½®çš„æ—¶é—´å†…ï¼Œ # å‡ºç°SIGSEGVæˆ–SIGBUSçš„å­è¿›ç¨‹æ•°è¶…è¿‡emergency_restart_thresholdå‚æ•°è®¾ç½®çš„å€¼ã€‚ # é‚£ä¹ˆfpmå°±ä¼šä¼˜é›…çš„é‡å¯ï¼Œå€¼æ˜¯0è¡¨ç¤ºoffè¿™ä¸ªåŠŸèƒ½ï¼Œå¯ç”¨çš„å•ä½æœ‰ï¼šsç§’,måˆ†,hæ—¶,då¤©ã€‚ emergency_restart_interval = 60s #è®¾ç½®å­è¿›ç¨‹æ¥å—ä¸»è¿›ç¨‹å¤ç”¨ä¿¡å·çš„è¶…æ—¶æ—¶é—´ã€‚ process_control_timeout = 0 #å½“åŠ¨æ€ç®¡ç†å­è¿›ç¨‹æ—¶ï¼Œfpmæœ€å¤šèƒ½forkå¤šå°‘ä¸ªè¿›ç¨‹ï¼Œ0è¡¨ç¤ºæ— é™åˆ¶ï¼Œ # è¿™æ˜¯æ‰€æœ‰è¿›ç¨‹æ± èƒ½å¯åŠ¨å­è¿›ç¨‹çš„æ€»å’Œï¼Œè°¨æ…ä½¿ç”¨ã€‚ process.max = 128 #è®¾ç½®å­è¿›ç¨‹çš„ä¼˜å…ˆçº§ï¼Œåœ¨masterè¿›ç¨‹ä»¥rootç”¨æˆ·å¯åŠ¨æ—¶æœ‰æ•ˆï¼› #å¦‚æœæ²¡æœ‰è®¾ç½®ï¼Œå­è¿›ç¨‹ä¼šç»§æ‰¿masterè¿›ç¨‹çš„ä¼˜å…ˆçº§ï¼Œå€¼èŒƒå›´-19(æœ€é«˜)åˆ°20(æœ€ä½)ï¼Œé»˜è®¤ä¸è®¾ç½®ã€‚ process.priority = -19 #è®¾ç½®æˆnoç”¨äºè°ƒè¯•bugï¼Œé»˜è®¤ä¸ºyesã€‚ daemonize = yes #masterè¿›ç¨‹æœ€å¤šèƒ½æ‰“å¼€çš„æ–‡ä»¶æ•°é‡ã€‚é»˜è®¤é‡‡ç”¨ç³»ç»Ÿè®¾ç½®çš„å€¼ã€‚ rlimit_files = 1024 #masterè¿›ç¨‹æ ¸å¿ƒrlimité™åˆ¶å€¼ï¼›å¯é€‰unlimitedæˆ–\u003e=0çš„æ•´æ•°ï¼Œé»˜è®¤ä¸ºç³»ç»Ÿçš„å€¼ã€‚ rlimit_core = 0 #äº‹ä»¶å¤„ç†æœºåˆ¶ï¼Œé»˜è®¤è‡ªåŠ¨æ£€æµ‹ï¼Œå¯é€‰å€¼ï¼šselectï¼Œpollï¼Œ #epoll(linux\u003e=2.5.44)ï¼Œkqueueï¼Œ/dev/pollï¼Œport events.mechanism = epoll #fpmæƒ³ç³»ç»Ÿå‘é€çŠ¶æ€çš„é¢‘ç‡ã€‚å•ä½æœ‰s,m,hã€‚ #å‰ææ˜¯fpmè¢«è®¾ç½®ä¼šç³»ç»ŸæœåŠ¡ã€‚ systemd_interval = 10s   4. php-fpmè¿›ç¨‹è¿›ç¨‹æ± é…ç½®  1ä¸ªå­è¿›ç¨‹åŸºæœ¬ä¸Šå ç”¨å†…å­˜åœ¨30MB-40MBå·¦å³,éœ€è¦æ ¹æ®è‡ªå·±çš„ä¸»æœºé…ç½®ä»¥åŠä¸šåŠ¡æƒ…å†µç»™å‡ºåˆé€‚çš„æ–¹æ¡ˆ\n 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67  #php-fpmçš„é˜Ÿåˆ—é•¿åº¦ã€‚ listen.backlog = 65535 #phpè¿›ç¨‹æ± æƒé™ï¼ŒåŒæ ·è¦masterè¿›ç¨‹æ˜¯rootç”¨æˆ·æ‰æœ‰æ•ˆï¼Œ #å’Œä¸Šé¢çš„å…¨å±€è®¾ç½®ä¸€æ ·ï¼Œä¸è®¾ç½®çš„è¯ä¼šç»§æ‰¿masterè¿›ç¨‹çš„ä¼˜å…ˆçº§ã€‚ process.priority = -19 #å­è¿›ç¨‹ç®¡ç†æ–¹å¼ #static(é™æ€é…ç½®ï¼Œåœ¨å¯åŠ¨php-fpmæ—¶æ ¹æ®è¯¥å€¼åˆ›å»ºå›ºå®šçš„å­è¿›ç¨‹æ•°é‡)ï¼› #dynamic(åŠ¨æ€é…ç½®ï¼Œåœ¨å¯åŠ¨php-fpmæ—¶æ ¹æ®pm.start_serversçš„å€¼åˆå§‹åŒ–å¯¹åº”çš„å­è¿›ç¨‹æ•°ï¼Œè‡³å°‘ä¸€ä¸ªå­è¿›ç¨‹)ï¼› #ondemand(æŒ‰éœ€é…ç½®ï¼Œåœ¨å¯åŠ¨php-fpmæ—¶ä¸åˆ›å»ºå­è¿›ç¨‹ï¼Œè€Œæ˜¯æ ¹æ®è¯·æ±‚åŠ¨æ€forkå­è¿›ç¨‹)ï¼› pm = dynamic #æœ€å¤§å­è¿›ç¨‹æ•°é‡ pm.max_children = 5 #åˆå§‹åŒ–å­è¿›ç¨‹æ•°é‡ï¼Œä¸ä¸Šé¢çš„pm = dynamicé…ç½®ä½¿ç”¨ã€‚ pm.start_servers = 2 #æœåŠ¡å™¨é—²ç½®æ—¶æœ€å°‘ä¿æŒ2ä¸ªå­è¿›ç¨‹ï¼Œä¸å¤Ÿè¿™ä¸ªæ•°å°±ä¼šåˆ›å»ºï¼Œåªé€‚ç”¨åŠ¨æ€dynamicç®¡ç†æ–¹å¼ pm.min_spare_servers = 2 #æœåŠ¡å™¨é—²ç½®æ—¶æœ€å¤šè¦æœ‰å‡ ä¸ªï¼Œå¤šäº†ä¼škillï¼Œåªé€‚ç”¨åŠ¨æ€dynamicç®¡ç†æ–¹å¼ pm.max_spare_servers = 3 #å­è¿›ç¨‹é—²ç½®æ—¶é—´ï¼Œä¹Ÿå°±æ˜¯è¯´å­è¿›ç¨‹æ²¡æœ‰å¯å¤„ç†çš„ä»»åŠ¡æ—¶ï¼Œåœ¨è¯¥ä¹‹é—´ä½¿å°±ä¼šè¢«killedã€‚ pm.process_idle_timeout = 10s #æ¯ä¸ªå­è¿›ç¨‹æœ€å¤§çš„å¤„ç†è¯·æ±‚æ•°é‡ã€‚åœ¨ä¸€å®šç¨‹åº¦ä¸Šå¯ä»¥é˜²æ­¢å†…å­˜æ³„æ¼ã€‚ pm.max_requests = 500 #php-fpmçŠ¶æ€ç›‘æ§çš„uri pm.status_path string #php-fpmç›‘æ§é¡µé¢çš„ ping ç½‘å€ã€‚ #å¦‚æœæ²¡æœ‰è®¾ç½®ï¼Œåˆ™æ— æ³•è®¿é—® ping é¡µé¢ã€‚ #è¯¥é¡µé¢ç”¨äºå¤–éƒ¨æ£€æµ‹php-fpmæ˜¯å¦å­˜æ´»å¹¶ä¸”å¯ä»¥å“åº”è¯·æ±‚ã€‚è¯·æ³¨æ„å¿…é¡»ä»¥æ–œçº¿å¼€å¤´ï¼ˆ/ï¼‰ã€‚ ping.path string #ç”¨äºå®šä¹‰pingè¯·æ±‚çš„è¿”å›å“åº”ã€‚è¿”å›ä¸º HTTP 200 çš„ text/plain æ ¼å¼æ–‡æœ¬ã€‚é»˜è®¤å€¼ï¼špongã€‚ ping.response string #è®¾ç½®workerçš„nice(2)ä¼˜å…ˆçº§ï¼ˆå¦‚æœè®¾ç½®äº†çš„è¯ï¼‰ã€‚ #è¯¥å€¼ä» -19ï¼ˆæœ€é«˜ä¼˜å…ˆçº§ï¼‰ åˆ° 20ï¼ˆæ›´ä½ä¼˜å…ˆçº§ï¼‰ã€‚ #é»˜è®¤å€¼ï¼šä¸è®¾ç½® process.priority int #æ£€æµ‹è·¯å¾„æ—¶ä½¿ç”¨çš„å‰ç¼€ prefix string #è®¿é—®æ–‡ä»¶æ—¥å¿—ï¼Œæ²¡å•¥ç”¨å¤„ï¼Œæ¯”å¦‚yii2æ¯æ¬¡éƒ½è®°å½•è®¿é—®index.phpï¼Œåªæ˜¯è®°å½•çœŸå®çš„PHPæ–‡ä»¶ã€‚ access.log = var/log/$pool.access.log #phpçš„æ…¢æ—¥å¿— slowlog = var/log/$pool.log.slow #æ…¢æ—¥å¿—æ—¶é—´é˜ˆå€¼ request_slowlog_timeout = 2s #å•ä¸ªè¯·æ±‚çš„è¶…æ—¶æ—¶é—´ï¼Œå½“php.iniè®¾ç½®çš„æœ€å¤§æ‰§è¡Œæ—¶é—´æœªç”Ÿæ•ˆï¼Œåˆ™äº¤ç”±å®ƒæ¥å¤„ç†ã€‚ request_terminate_timeout = 3s #æœ€å¤§æ‰“å¼€å¥æŸ„æ•°ï¼Œé»˜è®¤ä¸ºç³»ç»Ÿå€¼ã€‚ rlimit_files = 1024 #æœ€å¤šçš„æ ¸å¿ƒä½¿ç”¨æ•°ï¼Œé»˜è®¤ä¸ºç³»ç»Ÿåˆ†é…ã€‚ rlimit_core = 0   ","description":"","tags":["php-fpm","php","nginx","docker"],"title":"PHP-FPM æ˜¯å•¥","uri":"/php/php-fpm-union/"},{"categories":["vscode"],"content":" è®°å½•ä¸€ä¸‹è‡ªå·±çš„é…ç½®ï¼Œæ¯ä¸ªäººå¯ä»¥æœ‰è‡ªå·±çš„é…ç½®ï¼Œä»…ä¾›å‚è€ƒ\n 1. ä¸€æ¬¡æœç´¢æ‰€æœ‰æ–‡ä»¶çš„æ–‡æœ¬ Cmd(âŒ˜) + Shift(â‡§) + F 2. æ‰“å¼€ç»ˆç«¯ Ctrl(âŒƒ) + Shift(â‡§) + ` 3. ä¿®æ”¹å¿«é€Ÿæ‰“å¼€æ–‡ä»¶å¿«æ·é”®(åœ¨å½“å‰çš„é¡¹ç›®å·¥ç¨‹é‡Œï¼Œå…¨å±€æœç´¢æ–‡ä»¶å)  ç”¨æƒ¯äº† storm çš„ Cmd+E å¿«é€Ÿè·³è½¬ï¼Œæ•…ç»§ç»­ä¿ç•™\n å…ˆæŒ‰ Cmd(âŒ˜) + k, å†æŒ‰ Cmd(âŒ˜) + S, å°† Cmd(âŒ˜) + P æ”¹ä¸º Cmd(âŒ˜) + E è¾“å…¥ \u003e å¯ä»¥å›åˆ°ä¸»å‘½ä»¤æ¡† Ctrl + Shift + P æ¨¡å¼ 4. ä¿®æ”¹è·³è½¬æ–¹æ³•ä¸º Cmd(âŒ˜) + B 5. å°†éšè—ä¾§è¾¹æ ä¿®æ”¹ä¸º Cmd(âŒ˜) + ESC 6. è¡Œç¼©è¿› Cmd(âŒ˜) + [ Cmd(âŒ˜) + ] 7. å°†ä»£ç å‘ä¸Šæˆ–å‘ä¸‹ç§»åŠ¨ Option + â¬† Option + â¬‡ 8. å·¦å³æ˜¾ç¤ºå¤šä¸ªç¼–è¾‘å™¨çª—å£ Cmd(âŒ˜) + \\ 9. åˆ‡æ¢çª—å£ Cmd(âŒ˜) + num 10. è¿”å›åˆ°ä¸Šä¸€ä¸ªæ–‡ä»¶ Control + - 11. ä»£ç æŠ˜å  Cmd(âŒ˜) + Option + [ Cmd(âŒ˜) + Option + ] 12. è¿›å…¥ç¦…æ¨¡å¼ Cmd(âŒ˜) + K å†æŒ‰ Z 13. ä¾æ¬¡é€‰ä¸­å½“å‰é€‰ä¸­çš„å•è¯ Cmd(âŒ˜) + D ","description":"","tags":["vscode"],"title":"Vscode å¿«æ·é”®","uri":"/vscode/short-key/"},{"categories":["vscode"],"content":"1. æ±‰åŒ– vscode çœ‹è‹±æ–‡ä¸æ˜¯çœ‹ä¸æ‡‚ï¼Œä½†æœ‰ä¸­æ–‡å¿…é¡»ä¼˜å…ˆä¸­æ–‡ æ’ä»¶å: Chinese (Simplified) Language Pack for Visual Studio Code 2. vscode-icons ç»™ä¸åŒçš„æ–‡ä»¶ç±»å‹æ·»åŠ å›¾æ ‡ 3. PHP Intelephense PHPä»£ç æç¤ºå·¥å…·ï¼Œä»£ç æç¤ºã€æŸ¥æ‰¾å®šä¹‰ã€ç±»æœç´¢ç­‰åŠŸèƒ½ ç¼–è¾‘å¯¹åº”çš„é…ç½®ï¼Œå…·ä½“æ ¹æ®è‡ªå·±å®é™…æƒ…å†µé…ç½® \"intelephense.phpdoc.classTemplate\": { \"php.validate.executablePath\": \"/usr/local/bin/php\", \"php.executablePath\": \"/usr/local/bin/php\", \"window.zoomLevel\": 0, \"summary\": \"$1\", \"tags\": [ \"@package ${1:$SYMBOL_NAMESPACE}\" ] } 4. PHP Cs 1  $ composer require --dev squizlabs/php_codesniffer   5. PHP DocBlocker \"php-docblocker.extra\": [ \"\", \"@Author huanglei huanglei@quanjingshuju.com\", \"@DateTime $CURRENT_YEAR-$CURRENT_MONTH-$CURRENT_DATE\" ], \"php-docblocker.returnGap\": false, \"php-docblocker.classTemplate\": {}, 6. Mysql é€šè¿‡ + æ·»åŠ é…ç½®ï¼Œæ”¯æŒè‡ªåŠ¨è”æƒ³ 7. cloudmusic vscodeä¸­çš„å¯è§†åŒ–çš„ç½‘æ˜“äº‘éŸ³ä¹ï¼Œéå¸¸å¥ˆæ–¯ 8. PHP Debug é€šè¿‡æ–­ç‚¹è°ƒè¯•æ¥ä¸€æ­¥æ­¥è°ƒè¯•ä»£ç  9. åˆ é™¤æ–‡ä»¶çŠ¶æ€æ  \"workbench.editor.showTabs\": false ","description":"","tags":["php","vscode"],"title":"Vscode phpé…ç½®","uri":"/vscode/config/"},{"categories":["php"],"content":"1. åˆå¹¶æ‰€æœ‰å…ƒç´ (ä½¿ç”¨æ•°ç»„è§£åŒ…) 1 2 3 4 5 6 7  \u003c?php $a = 1; $b = [2, 3]; var_dump(array_merge([$a], $b));//php7.4å‰  var_dump([$a, ...$b]);//php7.4   2. null åˆå¹¶è¿ç®—ç¬¦ 1 2 3 4 5 6  \u003c?php $default = 'a'; $username = $default ?? 'username'; var_dump($username);//php7.0   1 2 3  \u003c?php var_dump(isset($username) ? 'hi' : 'username');//php7.0å‰   3. ç©ºåˆå¹¶è¿ç®—ç¬¦èµ‹å€¼ 1 2 3 4 5 6 7 8  \u003c?php $q = isset($q) ? 1 : 2;//php7.4å‰  $a ??= 1;//php7.4  var_dump($q); var_dump($a);   4. å¯ä¸ºç©º(Nullable)ç±»å‹ 1 2  php7.1åï¼Œå‚æ•°ä»¥åŠè¿”å›å€¼çš„ç±»å‹ç°åœ¨å¯ä»¥é€šè¿‡åœ¨ç±»å‹å‰åŠ ä¸Šä¸€ä¸ªé—®å·ä½¿ä¹‹å…è®¸ä¸ºç©º å½“å¯ç”¨è¿™ä¸ªç‰¹æ€§æ—¶ï¼Œä¼ å…¥çš„å‚æ•°æˆ–è€…å‡½æ•°è¿”å›çš„ç»“æœè¦ä¹ˆæ˜¯ç»™å®šçš„ç±»å‹ï¼Œè¦ä¹ˆæ˜¯ null   1 2 3 4 5 6 7 8 9 10  \u003c?php function test(?string $name) { var_dump($name); } test('test'); //\"test\"  test(null); //null  test(); //Uncaught Error: Too few arguments ...   5. å¤šå¼‚å¸¸æ•è·å¤„ç† 1 2 3 4 5 6  \u003c?php try { // some code  } catch (Exception1 | Exception2 $e) { }   6. list å‡½æ•° 1 2 3 4 5  $arr = ['apple', 'red']; list($fruit, $color) = $arr; var_dump($fruit, $color);   1 2 3 4 5 6  # åˆ—å‡ºä»–ä»¬çš„å…¶ä¸­ä¸€ä¸ª $arr = ['apple', 'red']; list(, $color) = $arr; var_dump($color);   1 2 3 4 5 6 7 8  # php7.1åå¯ä»¥æŒ‡å®šé”®å $arr = [ ['id' =\u003e 1, 'val' =\u003e 'val1'], ['id' =\u003e 2, 'val' =\u003e 'val2'], ]; list('id' =\u003e $id, 'val' =\u003e $val) = reset($arr); var_dump($id, $val);   1 2 3 4 5 6 7 8  $arr = [ ['id' =\u003e 1, 'val' =\u003e 'val1'], ['id' =\u003e 2, 'val' =\u003e 'val2'], ]; foreach ($arr as ['id' =\u003e $id, 'val' =\u003e $val]) { var_dump($id, $val); }   7. ç®­å¤´å‡½æ•° 1 2 3 4 5 6 7 8  \u003c?php //php7.4å‰  $demo1 = array_map(function ($val){ return $val * $val; }, [1,2]); //php7.4å  $demo2 = array_map(fn($val) =\u003e $val * $val, [1,2]);   8. å–å‡ºæ•°ç»„ä¸­çš„å…ƒç´  1 2 3 4 5 6 7 8 9 10  \u003c?php $arr = [ ['id' =\u003e 'zx', 'name' =\u003e 'ZX'], ['id' =\u003e 'as', 'name' =\u003e 'AS'], ['id' =\u003e 'qw', 'name' =\u003e 'QW'], ]; # å¦‚ä½•å¿«é€Ÿå–å‡ºäºŒç»´æ•°ç»„å¯¹äºidçš„å€¼  var_dump(array_column($arr, 'id'));   9. match 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29  \u003c?php //php8å‰  switch ($input) { case \"true\": $result = 1; break; case \"false\": $result = 0; break; case \"null\": $result = NULL; break; } //php8å  $result = match($input) { \"true\" =\u003e 1, \"false\" =\u003e 0, \"null\" =\u003e NULL, }; $result = match($input) { \"true\", \"on\" =\u003e 1, \"false\", \"off\" =\u003e 0, \"null\", \"empty\", \"NaN\" =\u003e NULL, }; # matchä½¿ç”¨çš„æ˜¯ä¸¥æ ¼æ¯”è¾ƒ(===)ï¼Œå€¼å’Œç±»å‹éƒ½è¦å®Œå…¨ç›¸ç­‰  # å½“inputå¹¶ä¸èƒ½è¢«matchä¸­çš„æ‰€æœ‰æ¡ä»¶æ»¡è¶³çš„æ—¶å€™ï¼Œmatchä¼šæŠ›å‡ºä¸€ä¸ªUnhandledMatchError exception   å‚è€ƒæ–‡ç« \n","description":"","tags":["php"],"title":"Clean code","uri":"/php/tips/"},{"categories":["docker"],"content":" å¿«é€Ÿæ­å»ºåœ¨çº¿Vscode,æˆ‘çš„ç”µè„‘æ˜¯8g Macbook,è¶Šæ¥è¶ŠåŠ›ä¸ä»å¿ƒäº†,äºæ˜¯å¼€å§‹ä»phpstormè½¬æ¢åˆ°Vscode\n ä¸‹æ–‡éœ€è¦ä¸€ç‚¹ç‚¹dockeråŸºç¡€ 1 2 3 4 5  $ git clone https://github.com/Mitirrli/docker-vscode.git $ cd docker-vscode \u0026\u0026 cp .env.example .env \u0026\u0026 vim .env //å¤åˆ¶envæ–‡ä»¶å¹¶ä¿®æ”¹é…ç½®é¡¹ $ vim docker-compose.yaml //æ”¹æˆä½ çš„æ–‡ä»¶å¤¹è·¯å¾„   å¯åŠ¨é¡¹ç›® 1 2 3  # æ³¨: éœ€è¦å…ˆå®‰è£…dockerå’Œdocker-compose $ docker-compose up -d //å¯åŠ¨é¡¹ç›®,ä¹‹åå°±å¯ä»¥é€šè¿‡å¯¹åº”ç«¯å£è¿›è¡Œè®¿é—®äº†,å¦‚æœæ˜¯äº‘æœåŠ¡å™¨,å¼€å¯å¯¹åº”é˜²ç«å¢™è§„åˆ™å³å¯   å‚è€ƒé¡¹ç›®\n","description":"","tags":["docker","vscode"],"title":"Docker Vscode","uri":"/docker/docker-vscode/"},{"categories":["elasticsearch"],"content":"ä½¿ç”¨docker-composeå¿«é€Ÿæ­å»ºç¯å¢ƒ 1. ç¼–è¾‘docker-composeæ–‡ä»¶ 1  $ vim docker-compose.yaml   1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43  version:'3.7'services:elasticsearch:container_name:elasticsearchbuild:context:./elasticsearchargs:- ELK_VERSION=${ELK_VERSION}restart:alwaysenvironment:- \"discovery.type=single-node\"- \"xpack.security.enabled=true\"- bootstrap.memory_lock=true- \"ES_JAVA_OPTS=-Xms512m -Xmx512m\"- ELASTIC_PASSWORD=changemeulimits:memlock:soft:-1hard:-1volumes:- ./data:/usr/share/elasticsearch/dataports:- \"${ELASTICSEARCH_HTTP_PORT}:9200\"networks:- elastickibana:container_name:kibanabuild:context:./kibanaargs:- ELK_VERSION=${ELK_VERSION}restart:alwaysdepends_on:- elasticsearchvolumes:- ./kibana/kibana.yml:/usr/share/kibana/config/kibana.ymlports:- \"${KIBANA_HTTP_PORT}:5601\"networks:- elasticnetworks:elastic:  2. ç¼–è¾‘elasticsearchçš„Dockerfile 1  $ vim elasticsearch/Dockerfile   1 2 3  ARG ELK_VERSIONFROMdocker.elastic.co/elasticsearch/elasticsearch:${ELK_VERSION}  3. ç¼–è¾‘kibanaçš„Dockerfile 1  $ vim kibana/Dockerfile   1 2 3  ARG ELK_VERSIONFROMdocker.elastic.co/kibana/kibana:${ELK_VERSION}  4. ç¼–è¾‘kibanaçš„é…ç½®æ–‡ä»¶ 1  $ vim kibana/kibana.yml   1 2 3 4 5 6 7 8 9 10  server.name:kibanaserver.host:\"0\"elasticsearch.hosts:[\"http://elasticsearch:9200\"]elasticsearch.username:\"elastic\"elasticsearch.password:\"changeme\"i18n.locale:\"zh-CN\"monitoring.ui.container.elasticsearch.enabled:true  5. å¢åŠ ç¯å¢ƒå˜é‡ 1  $ vim .env   ELK_VERSION=7.9.0 KIBANA_HTTP_PORT=5601 ELASTICSEARCH_HTTP_PORT=9200 ä½¿ç”¨dockerå¿«é€Ÿæ­å»ºelasticsearchå’Œkibana\n","description":"","tags":["docker","elasticsearch","kibana"],"title":"å¿«é€Ÿæ­å»ºå•èŠ‚ç‚¹elasticsearchå’Œkibana","uri":"/elasticsearch/build/"},{"categories":["mysql"],"content":"1. é¦–å…ˆåˆ›å»ºä¸€ä¸ªæ•°æ®åº“ 1  CREATE DATABASE function_db;   2. åˆ›å»ºä¸€ä¸ªç”¨æˆ·è¡¨ use function_db; CREATE table user( `uid` INT(10) UNSIGNED NOT NULL AUTO_INCREMENT COMMENT 'ç”¨æˆ·id', `name` VARCHAR(5) NOT NULL DEFAULT '' COMMENT 'ç”¨æˆ·å§“å', `age` TINYINT(3) NOT NULL DEFAULT 1 COMMENT 'ç”¨æˆ·å¹´é¾„', PRIMARY KEY (`uid`) ); 3. æ’å…¥å•æ¡æ•°æ® INSERT INTO function_db.user ( name, age ) VALUES ( 'å¼ ä¸‰', 10 ) 4. æ’å…¥å¤šæ¡æ•°æ® INSERT INTO function_db.user ( name, age ) VALUES ( 'å¼ ä¸‰', 10 ), ( 'æå››', 20 ) 5. æŒ‰è§„å®šåˆ—æ·»åŠ  # ä¸»é”®ç”¨0æˆ–è€…nullä»£æ›¿ INSERT INTO function_db.user VALUES ( NULL, 'å¼ ä¸‰', 10 ), ( NULL, 'æå››', 20 ) ","description":"","tags":["mysql"],"title":"Mysql æ•°æ®åº“æ“ä½œ","uri":"/mysql/operate/"},{"categories":["kubernetes"],"content":"1. Cronjobs 2. Deployment 3. Service 4. Ingress ","description":"","tags":["kubernetes"],"title":"K8Så„ç§yamlé…ç½®","uri":"/kubernetes/yaml/"},{"categories":["git"],"content":"Gitlabç‰ˆæœ¬å‡çº§ å…¬å¸ç›®å‰gitlabç‰ˆæœ¬æ˜¯9.5.5,å› å‡çº§æœåŠ¡å™¨é¡ºé“æŠŠgitlabä¹Ÿå‡åˆ°æœ€æ–°,è¿™é‡Œè®°å½•ä¸‹å†ç¨‹ã€‚\nå¤‡ä»½Gitlab 1  $ gitlab-rake gitlab:backup:create   æ‰§è¡Œå‘½ä»¤è¿›è¡Œå¤‡ä»½ï¼Œå°†ä¼šç”Ÿæˆä¸€ä¸ªå‘½åæ ¼å¼ä¸º_gitlab_backup.tarçš„å‹ç¼©åŒ…\nGitlabå‡çº§ å‡çº§å†ç¨‹: 9.5.5 -\u003e 9.5.9 -\u003e 9.5.10 -\u003e 10.8.7 -\u003e 11.11.8 -\u003e 12.0.12 -\u003e 12.10.14 -\u003e 13.0.12 -\u003e 13.2.3 æŒ‰ç…§å®˜ç½‘å‡çº§é¡ºåºä¾æ¬¡å‡çº§\nä¸‹è½½debåŒ…(*ä¸ºç‰ˆæœ¬å·) 1  $ wget https://mirrors.tuna.tsinghua.edu.cn/gitlab-ce/ubuntu/pool/xenial/main/g/gitlab-ce/gitlab-ce_*-ce.0_amd64.deb   å®‰è£…debåŒ… 1  $ dpkg -i *.deb   æŸ¥çœ‹ç‰ˆæœ¬ 1  $ cat /opt/gitlab/embedded/service/gitlab-rails/VERSION   Gitlabæ¢å¤ é¦–å…ˆå…³é—­æœåŠ¡\n1  $ gitlab-rake gitlab:backup:restore BACKUP 1597233443_2020_08_12_9.3.1   Gitlab 502è§£å†³(æŸ¥çœ‹pid) 1  $ gitlab-ctl status   ","description":"","tags":["gitlab"],"title":"Update Gitlab","uri":"/gitlab/update/"},{"categories":["docker"],"content":"1. ä½¿ç”¨docker-composeå¿«é€Ÿéƒ¨ç½² 1 2 3 4 5  $ git clone https://github.com/Mitirrli/docker-compose.git $ cp .env.example .env ä¹‹ååœ¨é¡¹ç›®æ ¹ç›®å½•æ”¾ç½®è‡ªå·±ä»£ç , åœ¨.docker/nginx/conf.dä¸‹æ”¾ç½®nginxé…ç½®æ–‡ä»¶å³å¯   ç¯å¢ƒå˜é‡ # Port PHP5_PORT=9005 PHP7_PORT=9007 WEB_PORT=80 REDIS_PORT=6379 # Container PHP5_CONTAINER_NAME=php5 PHP7_CONTAINER_NAME=php7 NGINX_CONTAINER_NAME=web REDIS_CONTAINER_NAME=redis # Version PHP5_VERSION=5.5.38-fpm-alpine PHP7_VERSION=7.1.30-fpm-alpine PHP7REDIS_VERSION=5.3.1 PHP5REDIS_VERSION=5.3.1 REDIS_VERSION=6.0.6-alpine3.12 NGINX_VERSION=latest XLSWRITER_VERSION=1.3.6 SWOOLE_VERSION=4.5.2 # Ini INSTALL_XDEBUG=true INSTALL_REDIS=true INSTALL_XLSWRITER=false INSTALL_SWOOLE=false docker-composeå‘½ä»¤ 1 2 3 4 5 6 7 8 9 10 11  $ docker-compose up //å‰å°å¯åŠ¨ $ docker-compose up -d //åå°å¯åŠ¨ $ docker-compose stop //æš‚åœå®¹å™¨ $ docker-compose start //å¯åŠ¨å®¹å™¨ $ docker-compose down -v //åœæ­¢å¹¶åˆ é™¤å®¹å™¨ $ docker exec -it [container_name] sh //è¿›å…¥å®¹å™¨   å¼€å¯Xdebug 1 2 3 4 5  1 . é…ç½® INSTALL_XDEBUG ä¸ºtrue 2 . Preferences -\u003e Set Debug port 9001 3 . Select path mapping   2. å®¹å™¨å®‰è£…æ‰©å±• å®‰è£…æ‰©å±•, ä»¥ redis ä¸ºä¾‹: 1 2 3 4 5 6 7  RUN curl -L -o /tmp/redis.tar.gz https://github.com/phpredis/phpredis/archive/{VERSION}.tar.gz \\  \u0026\u0026 tar xfz /tmp/redis.tar.gz \\  \u0026\u0026 rm -r /tmp/redis.tar.gz \\  \u0026\u0026 mkdir -p /usr/src/php/ext \\  \u0026\u0026 mv phpredis-{VERSION} /usr/src/php/ext/phpredisRUN docker-php-ext-install phpredis  æ›´æ¢ ALPINE çš„æº 1 2  RUN echo http://mirrors.aliyun.com/alpine/v3.12/main \u003e /etc/apk/repositories \\  \u0026\u0026 echo http://mirrors.aliyun.com/alpine/v3.12/community \u003e\u003e /etc/apk/repositories  æ›´æ¢ UBUNTU çš„æº 1  RUN sed -i 's/security-cdn.debian.org/mirrors.tuna.tsinghua.edu.cn/' /etc/apt/sources.list  å®‰è£… composer 1 2 3  RUN wget https://mirrors.aliyun.com/composer/composer.phar -O /usr/local/bin/composer \\  \u0026\u0026 chmod a+x /usr/local/bin/composer \\  \u0026\u0026 composer config -g repo.packagist composer https://mirrors.aliyun.com/composer  ","description":"","tags":["docker","php"],"title":"Docker æ­å»ºphpç¯å¢ƒ","uri":"/docker/php-environment-build/"},{"categories":["elasticsearch"],"content":" å‡ ç§è°ƒç”¨æ–¹å¼\n 1. kibana æ§åˆ¶å° 1 2 3 4 5 6  GET /my_index/_search { \"query\": { \"match\": {\"testField\": \"abc\"} } }   2. å‘½ä»¤è¡Œ 1 2 3 4 5 6 7  $ curl -XGET 'localhost:9200/my_index/_search' -d '{ \"query\" : { \"match\" : { \"testField\" : \"abc\" } } }'   3. phpè°ƒç”¨ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24  $param1 = [ 'index' =\u003e 'my_index', 'body' =\u003e [ 'query' =\u003e [ 'match' =\u003e [ 'testField' =\u003e 'abc' ] ] ] ]; $param2 = [ 'index' =\u003e 'my_index', 'body' =\u003e '{ \"query\" : { \"match\" : { \"testField\" : \"abc\" } } }' ]; $results = $client-\u003esearch($param1); $results = $client-\u003esearch($param2);   4. ä¸€äº›å¸¸ç”¨å­—æ®µ 1 2 3 4 5  $milliseconds = $results['took']; $maxScore = $results['hits']['max_score']; $score = $results['hits']['hits'][0]['_score']; $doc = $results['hits']['hits'][0]['_source'];    è¯·æ±‚ä½“æŸ¥è¯¢\n 1. ç©ºæŸ¥è¯¢ 1 2 3 4 5 6 7 8 9 10 11  GET /_search {} GET /_search { \"query\": { \"match_all\": {} } } //ç©ºæŸ¥è¯¢å°†è¿”å›æ‰€æœ‰ç´¢å¼•åº“ä¸­çš„æ‰€æœ‰æ–‡æ¡£    æŸ¥è¯¢ä¸è¿‡æ»¤\n 1. match_allæŸ¥è¯¢ 1  { \"match_all\": {}}   2. matchæŸ¥è¯¢ 1 2 3 4  { \"match\": { \"age\": 26 }} { \"match\": { \"date\": \"2014-09-01\" }} { \"match\": { \"public\": true }} { \"match\": { \"tag\": \"full_text\" }}   3. multi_matchæŸ¥è¯¢ 1 2 3 4 5 6  { \"multi_match\": { \"query\": \"full text search\", \"fields\": [ \"title\", \"body\" ] } }   4. rangeæŸ¥è¯¢ 1 2 3 4 5 6 7 8  { \"range\": { \"age\": { \"gte\": 20, \"lt\": 30 } } }   5. termæŸ¥è¯¢ 1 2 3 4 5 6  //term æŸ¥è¯¢è¢«ç”¨äºç²¾ç¡®å€¼åŒ¹é…ï¼Œè¿™äº›ç²¾ç¡®å€¼å¯èƒ½æ˜¯æ•°å­—ã€æ—¶é—´ã€å¸ƒå°”æˆ–è€…é‚£äº› not_analyzed çš„å­—ç¬¦ä¸²ï¼š { \"term\": { \"age\": 26 }} { \"term\": { \"date\": \"2014-09-01\" }} { \"term\": { \"public\": true }} { \"term\": { \"tag\": \"full_text\" }}   6. termsæŸ¥è¯¢ 1 2 3  //terms æŸ¥è¯¢å’Œ term æŸ¥è¯¢ä¸€æ ·ï¼Œä½†å®ƒå…è®¸ä½ æŒ‡å®šå¤šå€¼è¿›è¡ŒåŒ¹é…ã€‚å¦‚æœè¿™ä¸ªå­—æ®µåŒ…å«äº†æŒ‡å®šå€¼ä¸­çš„ä»»ä½•ä¸€ä¸ªå€¼ï¼Œé‚£ä¹ˆè¿™ä¸ªæ–‡æ¡£æ»¡è¶³æ¡ä»¶ï¼š { \"terms\": { \"tag\": [ \"search\", \"full_text\", \"nosql\" ] }}   7. existså’ŒmissingæŸ¥è¯¢ 1 2 3 4 5 6 7 8  //exists æŸ¥è¯¢å’Œ missing æŸ¥è¯¢è¢«ç”¨äºæŸ¥æ‰¾é‚£äº›æŒ‡å®šå­—æ®µä¸­æœ‰å€¼ (exists) æˆ–æ— å€¼ (missing) çš„æ–‡æ¡£ã€‚è¿™ä¸SQLä¸­çš„ IS_NULL (missing) å’Œ NOT IS_NULL (exists) åœ¨æœ¬è´¨ä¸Šå…·æœ‰å…±æ€§ï¼š { \"exists\": { \"field\": \"title\" } } //è¿™äº›æŸ¥è¯¢ç»å¸¸ç”¨äºæŸä¸ªå­—æ®µæœ‰å€¼çš„æƒ…å†µå’ŒæŸä¸ªå­—æ®µç¼ºå€¼çš„æƒ…å†µã€‚    ä¸€äº›ç¤ºä¾‹\n 1. å¸ƒå°”è¯·æ±‚ 1 2 3 4 5 6 7 8 9 10 11 12 13 14  $ curl -XGET 'localhost:9200/my_index/_search' -d '{ \"query\" : { \"bool\" : { \"must\": [ { \"match\" : { \"testField\" : \"abc\" } }, { \"match\" : { \"testField2\" : \"xyz\" } } ] } } }'   1 2 3 4 5 6 7 8 9 10 11 12 13 14 15  $params = [ 'index' =\u003e 'my_index', 'body' =\u003e [ 'query' =\u003e [ 'bool' =\u003e [ 'must' =\u003e [ [ 'match' =\u003e [ 'testField' =\u003e 'abc' ] ], [ 'match' =\u003e [ 'testField2' =\u003e 'xyz' ] ], ] ] ] ] ]; $results = $client-\u003esearch($params);   2. æ—¢åŒ…å«è¿‡æ»¤å™¨ï¼Œä¹ŸåŒ…å«æŸ¥è¯¢ 1 2 3 4 5 6 7 8 9 10 11 12  $ curl -XGET 'localhost:9200/my_index/_search' -d '{ \"query\" : { \"bool\" : { \"filter\" : { \"term\" : { \"my_field\" : \"abc\" } }, \"should\" : { \"match\" : { \"my_other_field\" : \"xyz\" } } } } }'   1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17  $params = [ 'index' =\u003e 'my_index', 'body' =\u003e [ 'query' =\u003e [ 'bool' =\u003e [ 'filter' =\u003e [ 'term' =\u003e [ 'my_field' =\u003e 'abc' ] ], 'should' =\u003e [ 'match' =\u003e [ 'my_other_field' =\u003e 'xyz' ] ] ] ] ] ]; $results = $client-\u003esearch($params);   3. å¯¹æŸ¥è¯¢å‡ºçš„æ•°æ®è¿›è¡Œç»Ÿè®¡(å»é‡) 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34  { \"index\":\"data_source\", \"body\": { \"aggs\": { \"graph\": { \"terms\": {\"field\":\"channel.keyword\"}, \"aggs\": { \"distinct_user_count\": { \"cardinality\": {\"field\": \"uid\"} } } } }, \"query\": { \"bool\": { \"must\":[ {\"match_phrase\": {\"type\": \"open\"}}, {\"match\": {\"uid\": 1}} ], \"filter\": { \"bool\": { \"must\": { \"range\": { \"request_time\": {\"gte\": \"1\", \"lte\": \"10000000000\"} } } } } } }, \"sort\":[{\"request_time\":{\"order\":\"desc\"}}], \"_source\":false } }   4. å½“å¤©æµè§ˆæœ€å¤šçš„äº§å“æ’åº { \"index\":\"data_source\", \"body\":{ \"size\": 0, \"aggs\": { \"date\": { \"date_histogram\": { \"field\": \"request_time\", \"interval\": \"day\", \"format\": \"yyyy-MM-dd\", \"time_zone\": \"+08:00\", \"min_doc_count\" : 1, \"order\": { \"_key\": \"desc\" } }, \"aggs\": { \"group_by_date\": { \"terms\": { \"size\": 100, \"field\": \"id.keyword\" } } } } }, \"query\":{\"bool\":{\"must\":[{\"match\":{\"uid\":%s}},{\"match_phrase\":{\"type\":\"product_view\"}}]}}, \"sort\":[{\"request_time\":{\"order\":\"desc\"}}] }, \"_source\": [\"id\", \"request_time\"] } å‚è€ƒæ–‡æ¡£\n","description":"","tags":["php","elasticsearch"],"title":"ä½¿ç”¨elasticsearch-phpæ‰©å±•","uri":"/elasticsearch/search-operation/"},{"categories":["elasticsearch"],"content":"1. FROM + SIZE æ–¹æ¡ˆ 1 2 3  from æŒ‡æ˜äº†åˆ†é¡µæŸ¥è¯¢è¿”å›çš„ç»“æœçš„èµ·å§‹ä½ç½®ï¼Œè€Œsizeå‚æ•°åˆ™æŒ‡æ˜äº†åˆ†é¡µæŸ¥è¯¢çš„é¡µå®¹é‡ åŸç†: æ¯”å¦‚æŸ¥è¯¢ç¬¬äºŒé¡µçš„æ•°æ®ï¼Œæ¯é¡µæœ‰10æ¡æ•°æ®ï¼Œå°±æ˜¯æŸ¥è¯¢å‰20æ¡æ•°æ®ï¼Œç„¶åæˆªæ–­å‰10æ¡ï¼Œåªè¿”å›åé¢10æ¡   1 2 3  å­˜åœ¨çš„é—®é¢˜: 1. åˆ†é¡µçš„åç§»å€¼è¶Šå¤§ï¼Œæ‰§è¡Œåˆ†é¡µæŸ¥è¯¢æ—¶é—´è¶Šé•¿ 2. from + size ä¸èƒ½è¶…è¿‡ç´¢å¼•çš„ index.max_result_window å€¼   1 2 3 4 5 6 7 8 9 10 11 12  POST /_search { \"from\": 30, \"size\": 10 } GET /_search { \"from\": 30, \"size\": 10 } //ä¸¤ç§æ–¹å¼å‡æ”¯æŒ   2. SCROLL æ·±åˆ†é¡µ 1 2  è¯¥æŸ¥è¯¢å®ç°ç±»ä¼¼äºæ¶ˆæ¯æ¶ˆè´¹çš„æœºåˆ¶ï¼Œé¦–æ¬¡æŸ¥è¯¢çš„æ—¶å€™ä¼šåœ¨å†…å­˜ä¸­ä¿å­˜ä¸€ä¸ªå†å²å¿«ç…§ä»¥åŠæ¸¸æ ‡(scroll_id)ï¼Œè®°å½•å½“å‰æ¶ˆæ¯æŸ¥è¯¢çš„ç»ˆæ­¢ä½ç½®ï¼Œä¸‹æ¬¡æŸ¥è¯¢çš„æ—¶å€™å°†åŸºäºæ¸¸æ ‡è¿›è¡Œæ¶ˆè´¹ æ€§èƒ½è‰¯å¥½ï¼Œç»´æŠ¤æˆæœ¬é«˜ï¼Œåœ¨æ¸¸æ ‡å¤±æ•ˆå‰ï¼Œä¸ä¼šæ›´æ–°æ•°æ®ï¼Œä¸å¤Ÿçµæ´»ï¼Œä¸€æ—¦æ¸¸æ ‡åˆ›å»ºsizeå°±ä¸å¯æ”¹å˜ï¼Œé€‚ç”¨äºå¤§é‡æ•°æ®å¯¼å‡ºæˆ–è€…ç´¢å¼•é‡å»º   1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36  $client = ClientBuilder::create()-\u003ebuild(); $params = [ 'scroll' =\u003e '30s', // how long between scroll requests. should be small! 'size' =\u003e 50, // how many results *per shard* you want back 'index' =\u003e 'my_index', 'body' =\u003e [ 'query' =\u003e [ 'match_all' =\u003e new \\stdClass() ] ] ]; // Execute the search // The response will contain the first batch of documents // and a scroll_id $response = $client-\u003esearch($params); // Now we loop until the scroll \"cursors\" are exhausted while (isset($response['hits']['hits']) \u0026\u0026 count($response['hits']['hits']) \u003e 0) { // ** // Do your work here, on the $response['hits']['hits'] array // ** // When done, get the new scroll_id // You must always refresh your _scroll_id! It can change sometimes $scroll_id = $response['_scroll_id']; // Execute a Scroll request and repeat $response = $client-\u003escroll([ 'body' =\u003e [ 'scroll_id' =\u003e $scroll_id, //...using our previously obtained _scroll_id 'scroll' =\u003e '30s' // and the same timeout window ] ]); }   3. Search After 1 2 3  åŸç†: ä½¿ç”¨å†å²æ¡ä»¶è¿‡æ»¤æ‰æ•°æ®ï¼Œé€šè¿‡ä¸Šä¸€é¡µçš„ç»“æœå¸®åŠ©æ£€ç´¢ä¸‹ä¸€é¡µï¼Œé€šè¿‡å°†sortå€¼ä¸search_afterå‚æ•°ä¸€èµ·ä½¿ç”¨ï¼Œä»¥å¼€å§‹è¿”å›åœ¨è¿™ä¸ªç»“æœåˆ—è¡¨ä¹‹åçš„ä»»ä½•æ–‡æ¡£ æ³¨æ„: å½“ä½¿ç”¨search_afterå‚æ•°æ—¶ï¼Œfromçš„å€¼å¿…é¡»è¢«è®¾ä¸º0æˆ–è€…-1   1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28  $ curl -XGET \"http://localhost:9200/bank/_search\" -H 'Content-Type: application/json' -d' { \"size\": 10, \"query\": { \"match\" : { \"address\" : \"place\" } }, \"sort\": [ {\"balance\": \"asc\"}, {\"_id\": \"desc\"} ] }' $ curl -XGET \"http://localhost:9200/bank/_search\" -H 'Content-Type: application/json' -d' { \"size\": 10, \"query\": { \"match\" : { \"address\" : \"place\" } }, \"search_after\": [4652, \"590\"], \"sort\": [ {\"balance\": \"asc\"}, {\"_id\": \"desc\"} ] }'   å‚è€ƒæ–‡ç« \nå‚è€ƒæ–‡ç« \nå‚è€ƒæ–‡æ¡£\n","description":"","tags":["php","elasticsearch"],"title":"Elasticsearch åˆ†é¡µ","uri":"/elasticsearch/page/"},{"categories":["php"],"content":"ä½¿ç”¨composerå®‰è£… 1  $ composer require symfony/console   å¢åŠ artisanæ–‡ä»¶ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19  #!/usr/bin/env php \u003c?php require __DIR__.'/vendor/autoload.php'; use Symfony\\Component\\Console\\Application; $application = new Application(); $commands = glob(__DIR__ . '/app/command/*.php'); foreach ($commands as $command) { $bool = preg_match('/(app\\/command\\/.+?)\\.php/', $command, $matches); if ($bool !== false \u0026\u0026 isset($matches[1])) { $command = str_replace('/', '\\\\', $matches[1]); $application-\u003eadd(new $command()); } } $application-\u003erun();   æ—¶é—´æˆ³è½¬åŒ–å‘½ä»¤ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32  \u003c?php namespace app\\command; use Symfony\\Component\\Console\\Command\\Command; use Symfony\\Component\\Console\\Input\\InputInterface; use Symfony\\Component\\Console\\Output\\OutputInterface; use Symfony\\Component\\Console\\Input\\InputArgument; class TimestampConvertCommand extends Command { protected function configure() { $this -\u003eaddArgument('time', InputArgument::OPTIONAL, 'The timestamp to be converted.') -\u003esetName('time:convert') -\u003esetDescription('æ—¶é—´æˆ³è½¬æ¢.') -\u003esetHelp(\"The timestamp to be converted...\") ; } protected function execute(InputInterface $input, OutputInterface $output) { $time = $input-\u003egetArgument('time') ?? time(); $output-\u003ewrite('You are about to '); $output-\u003ewrite('convert time. '); $output-\u003ewriteln('æ—¶é—´: '. date('Y-m-d H:i:s', $time)); return 0; } }   ","description":"","tags":["symfony","console"],"title":"ä½¿ç”¨Symfony Console","uri":"/php/symfony-console/"},{"categories":["kubernetes"],"content":"1. K8S èŠ‚ç‚¹çŠ¶æ€æ— æ³•è°ƒåº¦, çŠ¶æ€ä¸º SchedulingDisabled è§£å†³æ–¹æ¡ˆ(*ä¸º ip):\n1  $ kubectl patch no * -p '{\"spec\": {\"unschedulable\": false}}'   2. Back-off restarting failed container æ ¹æ® Describe Pod,pod å†…çš„ Container å·²å®Œæˆ.ä½†æ˜¯ Pod çš„ç”Ÿå‘½å‘¨æœŸéå¸¸çŸ­,è¦ä½¿ Pod æŒç»­è¿è¡Œ,æ‚¨å¿…é¡»æŒ‡å®šä¸€ä¸ªæ°¸è¿œä¸ä¼šå®Œæˆçš„ä»»åŠ¡.\n3. K8S æŒ‚è½½å•ä¸ªæ–‡ä»¶ ä½¿ç”¨ subPath,éƒ¨åˆ†ä»£ç å¦‚ä¸‹:\n1 2 3 4  volumeMounts:- mountPath:/var/www/html/.envname:envsubPath:.env  4. K8S è·å–å´©æºƒå®¹å™¨çš„åº”ç”¨æ—¥å¿— 1 2 3 4  å¦‚æœä½ çš„å®¹å™¨é‡å¯,kubectl logså‘½ä»¤å°†æ˜¾ç¤ºå½“å‰å®¹å™¨çš„æ—¥å¿—ã€‚ å¦‚æœä½ æƒ³çœ‹å‰ä¸€ä¸ªå®¹å™¨çš„æ—¥å¿—,æ·»åŠ --previous kubectl logs mypod --previous   5. å¢åŠ æ»šåŠ¨æ›´æ–° minReadySeconds: 5 strategy: rollingUpdate: maxSurge: 25% maxUnavailable: 25% type: RollingUpdate 6. Runtime privilege and Linux capabilities name: fpm securityContext: capabilities: add: - SYS_PTRACE ","description":"","tags":["kubernetes"],"title":"K8Sé‡åˆ°çš„é—®é¢˜è®°å½•","uri":"/kubernetes/question-record/"},{"categories":["regex"],"content":"æ¨èä¸€ä¸ªåœ¨çº¿regexå¹³å°\nä¸€ã€åŸºç¡€ç”¨æ³• 1. ç›´æ¥åŒ¹é…å­—ç¬¦ä¸²  123\n 123 (åŒ¹é…) 2. ^ä»£è¡¨æ•´æ®µå­—ç¬¦ä¸²çš„å¼€å¤´ï¼Œ$ä»£è¡¨æ•´æ®µå­—ç¬¦ä¸²çš„ç»“å°¾  ^123$\n 123 (åŒ¹é…) 1234 3. ä¸­æ‹¬å·åªèƒ½åŒ¹é…ä¸€ä¸ªå­—ç¬¦  ^[abc]$\n a (åŒ¹é…)  ^[a-zA-Z]$\n a (åŒ¹é…) 4. å–å^ (è¯¥ç¬¦å·åœ¨æ–¹æ‹¬å·è¡¨è¾¾å¼ä¸­ä½¿ç”¨æ—¶ï¼Œè¡¨ç¤ºä¸æ¥å—è¯¥æ–¹æ‹¬å·è¡¨è¾¾å¼ä¸­çš„å­—ç¬¦é›†åˆ)  ^[^abca-z]$\n d (åŒ¹é…) 5. åŒ¹é…å­—æ¯çš„æ•°ç›®  ^[a-zA-Z]{3}$\n abc (åŒ¹é…)  ^[a-zA-Z]{3,}$\n abcdef (åŒ¹é…) //è‡³å°‘åŒ¹é…3æ¬¡  ^[a-zA-Z]{3,6}$\n abcdef (åŒ¹é…) //æœ€å°‘åŒ¹é…3æ¬¡ä¸”æœ€å¤šåŒ¹é…6æ¬¡ 6. åŒ¹é…ä»»æ„å­—ç¬¦(å›è½¦é™¤å¤–) .  ^.{3,6}$\n abc (åŒ¹é…) //é™¤æ¢è¡Œç¬¦çš„ä»»æ„å­—ç¬¦ 7. åŒ¹é…æ•°å­—  \\d\n // \\dä¸[0-9]ç­‰æ•ˆ 8. åŒ¹é…éæ•°å­—  \\D\n // \\Dä¸[^0-9]ç­‰æ•ˆ 9. åŒ¹é…ä»»æ„å­—ç¬¦  [\\d\\D]{0,}\n 123 612334 abc (åŒ¹é…) 10. åŒ¹é…å­—æ¯æ•°å­—ä¸‹åˆ’çº¿  \\w\n // \\wä¸[a-zA-z0-9_]ç­‰æ•ˆ 11. åŒ¹é…éå­—æ¯æ•°å­—ä¸‹åˆ’çº¿  \\W\n // \\Wä¸[^a-zA-z0-9_]ç­‰æ•ˆ 12. åŒ¹é…æ‰€æœ‰ç©ºç™½ç¬¦  \\s\n // \\sä¸[\\r\\n\\t\\f\\v ]ç­‰æ•ˆ 13. åŒ¹é…éæ‰€æœ‰ç©ºç™½ç¬¦  \\S\n // \\Sä¸[^\\r\\n\\t\\f\\v ]ç­‰æ•ˆ 14. åŒ¹é… 0 æ¬¡-1 æ¬¡  ?\n // åŒ¹é…å‰é¢çš„å­è¡¨è¾¾å¼é›¶æ¬¡æˆ–ä¸€æ¬¡ // ?ä¸{0,1}ç­‰æ•ˆ 15. åŒ¹é… 0 æ¬¡-æ— ç©·æ¬¡      // åŒ¹é…å‰é¢çš„å­è¡¨è¾¾å¼é›¶æ¬¡åˆ°æ— ç©·æ¬¡ // *ä¸{0,}ç­‰æ•ˆ 16. åŒ¹é… 1 æ¬¡-æ— ç©·æ¬¡      // åŒ¹é…å‰é¢çš„å­è¡¨è¾¾å¼ä¸€æ¬¡åˆ°æ— ç©·æ¬¡ // +ä¸{1,}ç­‰æ•ˆ 17. è½¬ä¹‰  \\\n // .è¡¨ç¤ºé™¤æ¢è¡Œç¬¦ä»»æ„å­—ç¬¦ï¼Œè¡¨ç¤º.éœ€è¦ç”¨\\. äºŒã€Group 1. ä½¿ç”¨()åŒ¹é…æ–‡æœ¬ ^([a-zA-Z0-9][\\w.]*)@[a-zA-Z0-9]*.com$ 2. åœ¨(åå¢åŠ ?\u003c\u003eç»™ç»„å‘½å 1 2 3 4 5 6 7 8 9  \u003c?php preg_match( '/^(?\u003cfirst\u003e[a-zA-Z0-9][\\w.]*)@(?\u003csecond\u003e[a-zA-Z0-9]*).com$/', 'phper@gmail.com', $result ); var_dump($result);   array(5) { [0]=\u003e string(15) \"phper@gmail.com\" [\"first\"]=\u003e string(5) \"phper\" [1]=\u003e string(5) \"phper\" [\"second\"]=\u003e string(5) \"gmail\" [2]=\u003e string(5) \"gmail\" } 3. åŒ¹é…é‡å¤çš„å­—ç¬¦  ^(\\d\\d)\\1$\n // \\1è¡¨ç¤ºç¬¬ä¸€ä¸ªè¢«åŒ¹é…çš„ç»„ 1212 (åŒ¹é…)  ^(?\\d\\d)\\k$\n // \\k è¡¨ç¤ºåŒ¹é…ç»„å 1212 (åŒ¹é…) 4. ?=  run(?=[\\d+])\n // run123run12567 // exp1(?=exp2)ï¼šæŸ¥æ‰¾ exp2 å‰é¢çš„ exp1 5. ?\u003c=  (?\u003c=[\\d+])[a-z]+\n // 123accc1111d // (?\u003c=exp2)exp1ï¼šæŸ¥æ‰¾ exp2 åé¢çš„ exp1ã€‚ 6. ?!  woyong(?!qq)\n woyongqq woyongdd (åŒ¹é…) // exp1(?!exp2)ï¼šæŸ¥æ‰¾åé¢ä¸æ˜¯ exp2 çš„ exp1ã€‚ 7.?\u003c!  (?\u003c![qq*])ilove\n qqilove wxilove (åŒ¹é…) (?\u003c!exp2)exp1ï¼šæŸ¥æ‰¾å‰é¢ä¸æ˜¯ exp2 çš„ exp1ã€‚ å‚è€ƒèµ„æ–™\n","description":"","tags":["regex"],"title":"æ­£åˆ™è¡¨è¾¾å¼","uri":"/regex/usage/"},{"categories":["machine-learning"],"content":"1. ç®€ä»‹ éœ€è¦6ä¸ªç®€å•çš„æ­¥éª¤æ¥éƒ¨ç½²å’Œä½¿ç”¨ä¸€ä¸ªå¼•æ“: 1. å®‰è£…å’Œè¿è¡ŒPredictionIO 2. åˆ›å»ºä¸€ä¸ªæ¨¡æ¿å¼•æ“é€šè¿‡ä¸‹è½½ä¸€ä¸ªå¼•æ“ 3. ç”Ÿæˆä¸€ä¸ªåº”ç”¨ç¨‹åºIDå’Œè®¿é—®å¯†é’¥,å¦‚æœä½ å°†PredictionIOä¸ä¸€ä¸ªæ–°çš„åº”ç”¨ç¨‹åº 4. æ”¶é›†æ•°æ® 5. ä½œä¸ºæœåŠ¡éƒ¨ç½²å¼•æ“ 6. ä½¿ç”¨å¼•æ“ 2. ä¸‹è½½å®˜ç½‘åŒ… 1  $ git clone https://github.com/apache/predictionio.git   3. ä¸‹è½½template 1 2 3 4  $ cd predictionio/docker/templates $ git clone https://github.com/actionml/universal-recommender.git universal $ cd universal \u0026\u0026 cp engine.json.template engine.json $ sed -i \"s/handmade/YXB/\" engine.json   4. ä¿®æ”¹pgsqlå¯†ç  1 2 3 4  $ vim pgsql/docker-compose.base.yml $ vim docker-compose.yaml å¢åŠ å¼€æœºè‡ªå¯, ä¿®æ”¹volumes   5. ä½¿ç”¨dockerè¿›è¡Œå®‰è£… 1 2 3 4 5 6 7 8 9  $ docker-compose -f docker-compose.yml \\  -f pgsql/docker-compose.base.yml \\  -f pgsql/docker-compose.meta.yml \\  -f pgsql/docker-compose.event.yml \\  -f pgsql/docker-compose.model.yml \\  up -d è¿›å…¥å®¹å™¨ä¸­æ–°å»ºä¸€ä¸ªåº”ç”¨ $ pio app new YXB   ","description":"","tags":["Predictionio"],"title":"Predictionio","uri":"/machine-learning/predictionio/"},{"categories":["docker"],"content":"1. å•æœºæ„å‘³ç€è¯¥ç½‘ç»œåªèƒ½åœ¨å•ä¸ªDockerä¸»æœºä¸Šè¿è¡Œ, å¹¶ä¸”åªèƒ½ä¸æ‰€åœ¨Dockerä¸»æœºä¸Šçš„å®¹å™¨è¿›è¡Œè¿æ¥. 2. æ¡¥æ¥æ„å‘³ç€è¿™æ˜¯802.1.dæ¡¥æ¥çš„ä¸€ç§å®ç°(äºŒå±‚äº¤æ¢æœº). 3. æ¯ä¸ªdockerä¸»æœºéƒ½æœ‰ä¸€ä¸ªé»˜è®¤çš„å•æœºæ¡¥æ¥ç½‘ç»œ, åœ¨Linuxä¸Šç½‘ç»œåç§°ä¸ºbridge, é™¤éé€šè¿‡å‘½ä»¤è¡Œåˆ›å»ºå®¹å™¨æ—¶æŒ‡å®šå‚æ•°--network, å¦åˆ™é»˜è®¤æƒ…å†µä¸‹, æ–°åˆ›å»ºçš„å®¹å™¨éƒ½ä¼šè¿æ¥è¯¥ç½‘ç»œ. åœ¨Linuxä¸»æœºä¸Š, Dockerç½‘ç»œç”±Bridgeé©±åŠ¨åˆ›å»º, è€ŒBridgeåº•å±‚æ˜¯åŸºäºLinux BridgeæŠ€æœ¯. é»˜è®¤çš„ \"bridge\" ç½‘ç»œè¢«æ˜ å°„åˆ°å†…æ ¸ä¸­ä¸º \"docker0\" çš„Linuxç½‘æ¡¥. 1 2 3 4 5 6 7 8  # æŸ¥çœ‹dockerç½‘ç»œ $ docker network ls # æŸ¥çœ‹dockerç½‘ç»œè¯¦ç»†ä¿¡æ¯ $ docker network inspect bridge # é»˜è®¤çš„ \"bridge\" ç½‘ç»œè¢«æ˜ å°„åˆ°å†…æ ¸ä¸­ \"docker0\" çš„Linuxç½‘æ¡¥ $ docker network inspect bridge | grep bridge.name   åˆ›å»ºä¸€ä¸ªå•æœºæ¡¥æ¥ç½‘ç»œ 1 2  # --driver, -d é©±åŠ¨ç¨‹åºç®¡ç†ç½‘ç»œ $ docker network create -d bridge localnet   1 2 3 4 5 6 7  # æŸ¥ç½‘æ¡¥ $ brctl show bridge name\tbridge id\tSTP enabled\tinterfaces br-af67059cd875\t8000.0242002faa2a\tno br-f3899931862a\t8000.02426061dc5d\tno\tveth5e503b2 docker0\t8000.0242dfe1b585\tno   1 2  # åˆ›å»ºä¸€ä¸ªæ–°å®¹å™¨, æ¥å…¥åˆ°æ¡¥æ¥ç½‘ç»œlocalnetä¸­ $ docker run -d --name c1 --network localnet alpine sleep 1d   1 2 3 4 5 6 7 8 9 10 11 12 13 14  # æŸ¥çœ‹æ¥å…¥çŠ¶å†µ $ docker network inspect localnet \"Containers\": { \"fef8306b1fa75eab73e4976f9a546bbba19e2ed94e6e8f1e71d85c8f386143d0\": { \"Name\": \"c1\", \"EndpointID\": \"cc7395dc34c3fd618cdebf6c25758525c19a5f5781c113c55f066e9d8528e630\", \"MacAddress\": \"02:42:ac:17:00:02\", \"IPv4Address\": \"172.23.0.2/16\", \"IPv6Address\": \"\" } } # æ­¤æ—¶ \"c1\" å®¹å™¨æ­¤æ—¶å·²ç»ä½äºæ¡¥æ¥ç½‘ç»œlocalnetä¹‹ä¸Š   1 2 3 4 5 6 7  # å†æ¬¡æŸ¥çœ‹ç½‘æ¡¥ $ brctl show bridge name\tbridge id\tSTP enabled\tinterfaces br-af67059cd875\t8000.0242002faa2a\tno\tvethabd87e7 br-f3899931862a\t8000.02426061dc5d\tno\tveth5e503b2 docker0\t8000.0242dfe1b585\tno    å¦‚æœåœ¨ç›¸åŒçš„ç½‘ç»œç»§ç»­æ¥å…¥å…¶ä»–å®¹å™¨, é‚£ä¹ˆåœ¨æ–°æ¥å…¥å®¹å™¨æ˜¯å¯ä»¥é€šè¿‡ â€œc1â€ çš„å®¹å™¨åç§°æ¥pingé€šçš„. è¿™æ˜¯å› ä¸ºæ–°å®¹å™¨éƒ½æ³¨å†Œåˆ°äº†æŒ‡å®šçš„ Docker DNSæœåŠ¡. Linux é»˜è®¤çš„ Bridgeç½‘ç»œæ˜¯ä¸æ”¯æŒé€šè¿‡ Docker DNSæœåŠ¡è¿›è¡ŒåŸŸåè§£æçš„, å­—å®šä¹‰æ¡¥æ¥ç½‘ç»œå¯ä»¥.\n 1 2 3 4 5  # åˆ›å»º \"c2\" å®¹å™¨, ä¹Ÿæ¥å…¥localnet $ docker run -it --name c2 --network localnet alpine sh $ ping c1    è¿™æ˜¯å› ä¸º c2 å®¹å™¨è¿è¡Œäº†ä¸€ä¸ªæœ¬åœ° DNS è§£æå™¨, è¯¥è§£æå™¨å°†è¯·æ±‚è½¬å‘åˆ°äº†Dockerå†…éƒ¨DNSæœåŠ¡å™¨ä¸­. DNSæœåŠ¡å™¨ä¸­è®°å½•äº†å®¹å™¨å¯åŠ¨æ—¶é€šè¿‡ â€“nameæˆ–è€…â€“net-aliaså‚æ•°è¿½å®šçš„åç§°ä¸å®¹å™¨ä¹‹é—´çš„æ˜ å°„å…³ç³».\n å‚è€ƒä¹¦ç±: æ·±å…¥æµ…å‡ºDocker ","description":"","tags":["docker","network"],"title":"Docker å•æœºæ¡¥æ¥ç½‘ç»œ","uri":"/docker/network/"},{"categories":["php"],"content":"1. å…³äº Git Hooks  å’Œå…¶å®ƒç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿä¸€æ ·ï¼ŒGit èƒ½åœ¨ç‰¹å®šçš„é‡è¦åŠ¨ä½œå‘ç”Ÿæ—¶è§¦å‘è‡ªå®šä¹‰è„šæœ¬ã€‚ æœ‰ä¸¤ç»„è¿™æ ·çš„é’©å­ï¼šå®¢æˆ·ç«¯çš„å’ŒæœåŠ¡å™¨ç«¯çš„ã€‚ å®¢æˆ·ç«¯é’©å­ç”±è¯¸å¦‚æäº¤å’Œåˆå¹¶è¿™æ ·çš„æ“ä½œæ‰€è°ƒç”¨ï¼Œè€ŒæœåŠ¡å™¨ç«¯é’©å­ä½œç”¨äºè¯¸å¦‚æ¥æ”¶è¢«æ¨é€çš„æäº¤è¿™æ ·çš„è”ç½‘æ“ä½œã€‚ ä½ å¯ä»¥éšå¿ƒæ‰€æ¬²åœ°è¿ç”¨è¿™äº›é’©å­ã€‚\n  é’©å­éƒ½è¢«å­˜å‚¨åœ¨ Git ç›®å½•ä¸‹çš„ hooks å­ç›®å½•ä¸­ã€‚ ä¹Ÿå³ç»å¤§éƒ¨åˆ†é¡¹ç›®ä¸­çš„ .git/hooks ã€‚ å½“ä½ ç”¨ git init åˆå§‹åŒ–ä¸€ä¸ªæ–°ç‰ˆæœ¬åº“æ—¶ï¼ŒGit é»˜è®¤ä¼šåœ¨è¿™ä¸ªç›®å½•ä¸­æ”¾ç½®ä¸€äº›ç¤ºä¾‹è„šæœ¬ã€‚ è¿™äº›è„šæœ¬é™¤äº†æœ¬èº«å¯ä»¥è¢«è°ƒç”¨å¤–ï¼Œå®ƒä»¬è¿˜é€éœ²äº†è¢«è§¦å‘æ—¶æ‰€ä¼ å…¥çš„å‚æ•°ã€‚ æ‰€æœ‰çš„ç¤ºä¾‹éƒ½æ˜¯ shell è„šæœ¬ï¼Œå…¶ä¸­ä¸€äº›è¿˜æ··æ‚äº† Perl ä»£ç ï¼Œä¸è¿‡ï¼Œä»»ä½•æ­£ç¡®å‘½åçš„å¯æ‰§è¡Œè„šæœ¬éƒ½å¯ä»¥æ­£å¸¸ä½¿ç”¨ â€”â€” ä½ å¯ä»¥ç”¨ Ruby æˆ– Pythonï¼Œæˆ–ä»»ä½•ä½ ç†Ÿæ‚‰çš„è¯­è¨€ç¼–å†™å®ƒä»¬ã€‚ è¿™äº›ç¤ºä¾‹çš„åå­—éƒ½æ˜¯ä»¥ .sample ç»“å°¾ï¼Œå¦‚æœä½ æƒ³å¯ç”¨å®ƒä»¬ï¼Œå¾—å…ˆç§»é™¤è¿™ä¸ªåç¼€ã€‚æŠŠä¸€ä¸ªæ­£ç¡®å‘½åï¼ˆä¸å¸¦æ‰©å±•åï¼‰ä¸”å¯æ‰§è¡Œçš„æ–‡ä»¶æ”¾å…¥ .git ç›®å½•ä¸‹çš„ hooks å­ç›®å½•ä¸­ï¼Œå³å¯æ¿€æ´»è¯¥é’©å­è„šæœ¬ã€‚\n 2. æäº¤å·¥ä½œæµé’©å­ 1. pre-commit pre-commit é’©å­åœ¨é”®å…¥æäº¤ä¿¡æ¯å‰è¿è¡Œã€‚ å®ƒç”¨äºæ£€æŸ¥å³å°†æäº¤çš„å¿«ç…§ï¼Œä¾‹å¦‚ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰æ‰€é—æ¼ï¼Œç¡®ä¿æµ‹è¯•è¿è¡Œï¼Œä»¥åŠæ ¸æŸ¥ä»£ç ã€‚ å¦‚æœè¯¥é’©å­ä»¥éé›¶å€¼é€€å‡ºï¼ŒGit å°†æ”¾å¼ƒæ­¤æ¬¡æäº¤ï¼Œä¸è¿‡ä½ å¯ä»¥ç”¨ git commit --no-verify æ¥ç»•è¿‡è¿™ä¸ªç¯èŠ‚ã€‚ ä½ å¯ä»¥åˆ©ç”¨è¯¥é’©å­ï¼Œæ¥æ£€æŸ¥ä»£ç é£æ ¼æ˜¯å¦ä¸€è‡´ï¼ˆè¿è¡Œç±»ä¼¼ lint çš„ç¨‹åºï¼‰ã€å°¾éšç©ºç™½å­—ç¬¦æ˜¯å¦å­˜åœ¨ï¼ˆè‡ªå¸¦çš„é’©å­å°±æ˜¯è¿™ä¹ˆåšçš„ï¼‰ï¼Œæˆ–æ–°æ–¹æ³•çš„æ–‡æ¡£æ˜¯å¦é€‚å½“ã€‚ 2. post-commit é’©å­åœ¨æ•´ä¸ªæäº¤è¿‡ç¨‹å®Œæˆåè¿è¡Œã€‚ å®ƒä¸æ¥æ”¶ä»»ä½•å‚æ•°ï¼Œä½†ä½ å¯ä»¥å¾ˆå®¹æ˜“åœ°é€šè¿‡è¿è¡Œ git log -1 HEAD æ¥è·å¾—æœ€åä¸€æ¬¡çš„æäº¤ä¿¡æ¯ã€‚ è¯¥é’©å­ä¸€èˆ¬ç”¨äºé€šçŸ¥ä¹‹ç±»çš„äº‹æƒ…ã€‚ 3. pre-push pre-push é’©å­ä¼šåœ¨ git push è¿è¡ŒæœŸé—´ï¼Œ æ›´æ–°äº†è¿œç¨‹å¼•ç”¨ä½†å°šæœªä¼ é€å¯¹è±¡æ—¶è¢«è°ƒç”¨ã€‚ å®ƒæ¥å—è¿œç¨‹åˆ†æ”¯çš„åå­—å’Œä½ç½®ä½œä¸ºå‚æ•°ï¼ŒåŒæ—¶ä»æ ‡å‡†è¾“å…¥ä¸­è¯»å–ä¸€ç³»åˆ—å¾…æ›´æ–°çš„å¼•ç”¨ã€‚ ä½ å¯ä»¥åœ¨æ¨é€å¼€å§‹ä¹‹å‰ï¼Œç”¨å®ƒéªŒè¯å¯¹å¼•ç”¨çš„æ›´æ–°æ“ä½œï¼ˆä¸€ä¸ªéé›¶çš„é€€å‡ºç å°†ç»ˆæ­¢æ¨é€è¿‡ç¨‹ï¼‰ã€‚ 4. post-merge åœ¨ git merge æˆåŠŸè¿è¡Œåï¼Œpost-merge é’©å­ä¼šè¢«è°ƒç”¨ã€‚ ä½ å¯ä»¥ç”¨å®ƒæ¢å¤ Git æ— æ³•è·Ÿè¸ªçš„å·¥ä½œåŒºæ•°æ®ï¼Œæ¯”å¦‚æƒé™æ•°æ®ã€‚ è¿™ä¸ªé’©å­ä¹Ÿå¯ä»¥ç”¨æ¥éªŒè¯æŸäº›åœ¨ Git æ§åˆ¶ä¹‹å¤–çš„æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œè¿™æ ·ä½ å°±èƒ½åœ¨å·¥ä½œåŒºæ”¹å˜æ—¶ï¼ŒæŠŠè¿™äº›æ–‡ä»¶å¤åˆ¶è¿›æ¥ã€‚ 3. å®‰è£…composer-git-hooks  \"extra\": { \"hooks\": { \"pre-commit\": \"composer check-style\", \"pre-push\": [ \"composer test\", \"composer cs-fix\" ] } }, \"scripts\": { \"post-update-cmd\": [ \"cghooks update\" ], \"post-merge\": \"composer install\", \"post-install-cmd\": [ \"cghooks add --ignore-lock\", \"cghooks update\" ], \"check-style\": \"php-cs-fixer fix --using-cache=no --diff --config=.php_cs --dry-run --ansi\", \"cs-fix\": \"php-cs-fixer fix --using-cache=no --config=.php_cs --ansi\", \"test\": \"vendor/bin/phpunit --colors=always --testdox\" } 1  $ composer require --dev brainmaestro/composer-git-hooks   ","description":"","tags":["git","php","composer"],"title":"Composer Git Hooks","uri":"/php/composer-git-hooks/"},{"categories":["è®¡ç®—æœºåŸºç¡€"],"content":"åŸç   å¦‚æœæœºå™¨å­—é•¿ä¸ºnï¼Œé‚£ä¹ˆä¸€ä¸ªæ•°çš„åŸç å°±æ˜¯ç”¨ä¸€ä¸ªnä½çš„äºŒè¿›åˆ¶æ•°ï¼Œå…¶ä¸­æœ€é«˜ä½ä¸ºç¬¦å·ä½ï¼šæ­£æ•°ä¸º0ï¼Œè´Ÿæ•°ä¸º1ã€‚å‰©ä¸‹çš„n-1ä½è¡¨ç¤ºè¯¥æ•°çš„ç»å¯¹å€¼(æ­¤å¤„å‡è®¾æœºå™¨é•¿åº¦ä¸º8)ã€‚\n æ —å­ğŸŒ° ( ä½æ•°ä¸å¤Ÿçš„ç”¨0è¡¥å…¨ ) :\nX = +7 , [X]åŸ = 0000 0111 X = -7 , [X]åŸ = 1000 0111\næ³¨: æ­£æ•°çš„åŸåè¡¥ç éƒ½ä¸€æ ·ï¼Œ0çš„åŸç è·Ÿåç éƒ½æœ‰ä¸¤ä¸ªï¼Œå› ä¸ºè¿™é‡Œ0è¢«åˆ†ä¸º +0 å’Œ -0\nåç   åç å°±æ˜¯åœ¨åŸç åŸºç¡€ä¸Šï¼Œç¬¦å·ä½ä¸å˜å…¶ä»–ä½æŒ‰ä½å–åã€‚\n æ —å­ğŸŒ° :\nX = -7 , [X]åŸ = 1000 0111 , [X]å = 1111 1000\nè¡¥ç   è¡¥ç å°±æ˜¯åœ¨åç çš„åŸºç¡€ä¸Šå†åŠ 1\n æ —å­ğŸŒ° :\nX = -7 , [X]åŸ = 1000 0111 , [X]å = 1111 1000 , [X]è¡¥ = 1111 1001\næ³¨: 0çš„è¡¥ç æ˜¯å”¯ä¸€çš„ï¼Œå¦‚æœæœºå™¨å­—é•¿ä¸º8 é‚£ä¹ˆ[0]è¡¥ = 0000 0000\nä¸ºä»€ä¹ˆè®¡ç®—æœºé€šè¿‡è¡¥ç ä¿å­˜æ•°æ®? åœ¨æˆ‘ä»¬çš„è®¡ç®—ä¸­ï¼Œä½¿ç”¨æœ€åŸºç¡€çš„è¿ç®—å°±æ˜¯åŠ å‡ä¹˜é™¤äº†ï¼Œå› æ­¤æœ€å¥½è®¾è®¡å¾—å°½é‡ç®€å•ï¼Œè®¡ç®—æœºè¾¨åˆ«\"ç¬¦å·ä½\"ä¼šè®©è®¡ç®—æœºçš„åŸºç¡€ç”µè·¯è®¾è®¡å˜å¾—å¤æ‚ï¼Œäºæ˜¯ï¼Œäººä»¬æƒ³å‡ºäº†å°†ç¬¦å·ä½ä¹Ÿå‚ä¸è¿ç®—çš„æ–¹æ³•ã€‚\næ ¹æ®è¿ç®—æ³•åˆ™ï¼Œå‡å»ä¸€ä¸ªæ­£æ•°ç­‰äºåŠ ä¸Šä¸€ä¸ªè´Ÿæ•°ï¼Œå³ï¼š1 - 1 = 1 + (-1)ï¼Œæ‰€ä»¥æœºå™¨å¯ä»¥åªæœ‰åŠ æ³•è€Œæ²¡æœ‰å‡æ³•ï¼Œè¿™æ ·è®¡ç®—æœºè¿ç®—çš„è®¾è®¡å°±æ›´ç®€å•äº†ã€‚\n1. ä½†æ˜¯ï¼Œç”¨åŸç è®¡ç®—æ—¶æœ‰ä¸€äº›é—®é¢˜â€¦ 1 - 1 = 1 + (-1) = [0000 0001]åŸ + [1000 0001]åŸ = [1000 0010]åŸ = -2\nå¦‚æœç”¨åŸç è¡¨ç¤º, è®©ç¬¦å·ä½ä¹Ÿå‚ä¸è®¡ç®—ï¼Œæ˜¾ç„¶å¯¹äºå‡æ³•æ¥è¯´ç»“æœæ˜¯ä¸æ­£ç¡®çš„ã€‚\n2. äºæ˜¯ï¼Œåç å‡ºç°äº†ï¼Œä½†è¿˜æœ‰é—®é¢˜â€¦ 1 - 1 = 1 + (-1) = [0000 0001]åŸ + [1000 0001]åŸ = [0000 0001]å + [1111 1110]å = [1111 1111]å = [1000 0000]åŸ = -0\nå‘ç°ç”¨åç è®¡ç®—å‡æ³•ï¼Œç»“æœçš„çœŸå€¼éƒ¨åˆ†æ˜¯æ­£ç¡®çš„ï¼Œè€Œå”¯ä¸€çš„é—®é¢˜å…¶å®å°±å‡ºç°åœ¨\"0\"è¿™ä¸ªç‰¹æ®Šçš„æ•°å€¼ä¸Šã€‚è™½ç„¶äººä»¬ç†è§£ä¸Š +0 å’Œ -0 æ˜¯ä¸€æ ·çš„ï¼Œä½†æ˜¯0å¸¦ç¬¦å·æ˜¯æ²¡æœ‰ä»»ä½•æ„ä¹‰çš„ï¼Œè€Œä¸”ä¼šæœ‰[0000 0000]åŸå’Œ[1000 0000]åŸä¸¤ä¸ªç¼–ç è¡¨ç¤º0ã€‚\n3. è¡¥ç è§£å†³äº†é—ç•™çš„è¿™ä¸ªé—®é¢˜â€¦ 1 - 1 = 1 + (-1) = [0000 0001]åŸ + [1000 0001]åŸ = [0000 0001]å + [1111 1110]å = [0000 0001]è¡¥ + [1111 1111]è¡¥ = [0000 0000]è¡¥ = [0000 0000]åŸ = 0\nè¿™æ ·0ç”¨[0000 0000]è¡¨ç¤ºï¼Œè€Œä»¥å‰å‡ºç°é—®é¢˜çš„ -0 åˆ™ä¸å­˜åœ¨äº†ã€‚\n4. é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜å¯ä»¥ç”¨ [1000 0000]è¡¥ è¡¨ç¤º-128ï¼š (-1) + (-127) = [1000 0001]åŸ + [1111 1111]åŸ = [1111 1110]å + [1000 0000]å = [1111 1111]è¡¥ + [1000 0001]è¡¥ = [1000 0000]è¡¥ = -128\næ³¨: -128å¹¶æ²¡æœ‰åŸç å’Œåç è¡¨ç¤ºã€‚\nä½¿ç”¨è¡¥ç ä¸ä»…ä»…ä¿®å¤äº†0çš„ç¬¦å·ä»¥åŠå­˜åœ¨ä¸¤ä¸ªç¼–ç çš„é—®é¢˜ï¼Œè€Œä¸”è¿˜èƒ½å¤Ÿå¤šè¡¨ç¤ºä¸€ä¸ªæœ€ä½æ•°ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆ8ä½äºŒè¿›åˆ¶ä½¿ç”¨åŸç æˆ–åç è¡¨ç¤ºçš„èŒƒå›´ä¸º [-127, +127]ï¼Œè€Œä½¿ç”¨è¡¥ç è¡¨ç¤ºçš„èŒƒå›´ä¸º [-128, 127] çš„åŸå› ã€‚\nå› ä¸ºæœºå™¨ä½¿ç”¨è¡¥ç ï¼Œæ‰€ä»¥å¯¹äºç¼–ç¨‹ä¸­å¸¸ç”¨åˆ°çš„32ä½intç±»å‹å¯ä»¥è¡¨ç¤ºèŒƒå›´æ˜¯ [-2^31,2^31-1]ï¼Œå› ä¸ºç¬¬ä¸€ä½è¡¨ç¤ºçš„æ˜¯ç¬¦å·ä½ï¼Œè€Œä½¿ç”¨è¡¥ç è¡¨ç¤ºæ—¶åˆå¯ä»¥å¤šä¿å­˜ä¸€ä¸ªæœ€å°å€¼ã€‚\n5. è¡¥ç æ±‚åŸç  å¦‚æœè¡¥ç çš„ç¬¦å·ä½ä¸º 0ï¼Œè¡¥ç å°±æ˜¯è¯¥æ•°çš„åŸç ã€‚ å¦‚æœè¡¥ç çš„ç¬¦å·ä½ä¸º 1ï¼Œæ±‚åŸç çš„æ“ä½œå¯ä»¥æ˜¯ï¼šç¬¦å·ä½ä¸º1ï¼›å…¶ä½™å„ä½å–åï¼Œç„¶åå†åŠ 1ã€‚\n6. è¡¥ç åŠ ã€å‡è¿ç®—å…¬å¼ åœ¨åšè¡¥ç åŠ å‡æ³•æ—¶ï¼Œåªéœ€å°†ç¬¦å·ä½å’Œæ•°å€¼éƒ¨åˆ†ä¸€èµ·å‚ä¸è¿ç®—ï¼Œå¹¶ä¸”å°†ç¬¦å·ä½äº§ç”Ÿçš„è¿›ä½ä¸¢æ‰å³å¯ è¡¥ç åŠ æ³•å…¬å¼ [X+Y]è¡¥ ï¼ [X]è¡¥ + [Y]è¡¥ è¡¥ç å‡æ³•å…¬å¼ [X-Y]è¡¥ = [X]è¡¥-[Y]è¡¥ = [X]è¡¥ + [-Y]è¡¥ å…¶ä¸­ï¼š[-Y]è¡¥ç§°ä¸ºè´Ÿè¡¥,æ±‚è´Ÿè¡¥çš„åŠæ³•æ˜¯ï¼šå¯¹è¡¥ç çš„æ¯ä¸€ä½(åŒ…æ‹¬ç¬¦åˆä½)æ±‚åï¼Œä¸”æœªä½åŠ 1. å‡è®¾å­—é•¿ä¸º8çš„è®¡ç®—æœºsbyteç±»å‹æ‰€èƒ½è¡¨ç¤ºçš„æœ€å¤§æ•°æ˜¯11111111ï¼Œè‹¥å†åŠ 1ç§°ä¸º100000000(9ä½)ï¼Œä½†å› åªæœ‰8ä½ï¼Œæœ€é«˜ä½1è‡ªç„¶ä¸¢å¤±ã€‚åˆå›äº†00000000ï¼Œæ‰€ä»¥å­—é•¿ä¸º8çš„äºŒè¿›åˆ¶ç³»ç»Ÿçš„æ¨¡ä¸º2^8ã€‚\nå‚è€ƒæ–‡ç«  å‚è€ƒæ–‡ç« \n","description":"","tags":["è®¡ç®—æœºåŸºç¡€","åŸåè¡¥ç "],"title":"è¡¥ç çš„æ„ä¹‰æ˜¯ä»€ä¹ˆ?","uri":"/computer/complement/"},{"categories":["è®¡ç®—æœºåŸºç¡€"],"content":"1. æœºå™¨å­—é•¿  æœºå™¨å­—é•¿æ˜¯æŒ‡è®¡ç®—æœºè¿›è¡Œä¸€æ¬¡æ•´æ•°è¿ç®—æ‰€èƒ½å¤„ç†çš„äºŒè¿›åˆ¶æ•°æ®çš„ä½æ•°ï¼Œæœºå™¨å­—é•¿åæ˜ äº†è®¡ç®—æœºçš„è¿ç®—ç²¾åº¦ï¼Œå³å­—é•¿è¶Šé•¿ï¼Œæ•°çš„è¡¨ç¤ºèŒƒå›´ä¹Ÿè¶Šå¤§ï¼Œç²¾åº¦ä¹Ÿè¶Šé«˜ã€‚æœºå™¨çš„å­—é•¿ä¹Ÿä¼šå½±å“æœºå™¨çš„è¿ç®—é€Ÿåº¦ã€‚å€˜è‹¥CPUå­—é•¿è¾ƒçŸ­ï¼Œåˆè¦è¿ç®—ä½æ•°è¾ƒå¤šçš„æ•°æ®ï¼Œé‚£ä¹ˆéœ€è¦ç»è¿‡ä¸¤æ¬¡æˆ–å¤šæ¬¡çš„è¿ç®—æ‰èƒ½å®Œæˆï¼Œè¿™æ ·åŠ¿å¿…å½±å“æ•´æœºçš„è¿è¡Œé€Ÿåº¦ã€‚\n ä¸€èˆ¬å¤§å‹è®¡ç®—æœºå­—é•¿ä¸º32ä½æˆ–64ä½ï¼›å°å‹è®¡ç®—æœºå­—é•¿ä¸º16ä½æˆ–32ä½ã€‚å¸‚é¢ä¸Šè®¡ç®—æœºçš„å¤„ç†å™¨å¤§éƒ¨åˆ†å·²è¾¾åˆ°64ä½ï¼Œä½†å¯èƒ½ä¼šä»¥32ä½å­—é•¿è¿è¡Œï¼Œä¹Ÿæ²¡èƒ½å±•ç¤ºå®ƒçš„å­—é•¿çš„ä¼˜è¶Šæ€§ï¼Œå› ä¸ºå®ƒå¿…é¡»ä¸64ä½è½¯ä»¶ï¼ˆå¦‚64ä½çš„æ“ä½œç³»ç»Ÿç­‰ï¼‰ç›¸è¾…ç›¸æˆã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå­—é•¿å—è½¯ä»¶ç³»ç»Ÿçš„åˆ¶çº¦ï¼Œä¾‹å¦‚ï¼Œåœ¨32ä½è½¯ä»¶ç³»ç»Ÿä¸­64ä½å­—é•¿çš„åœ¨CPUåªèƒ½å½“32ä½ç”¨\n2. åŸç åç è¡¥ç   ä¸ºäº†ä¾¿äºè¿ç®—ï¼Œå¸¦ç¬¦å·çš„æœºå™¨æ•°å¯é‡‡ç”¨åŸç ã€åç å’Œè¡¥ç ç­‰ä¸åŒçš„ç¼–ç æ–¹å¼ã€‚ æ­£æ•°çš„åŸåè¡¥æ˜¯ä¸€è‡´çš„ï¼Œè´Ÿæ•°çš„åç ç­‰äºåŸç ç¬¦å·ä½ä¸å˜å…¶ä½™æŒ‰ä½å–åï¼Œè¡¥ç æ˜¯åœ¨åç çš„åŸºç¡€ä¸Šï¼Œå†åœ¨æœ€ä½ä½åŠ 1\n åœ¨åŸç è¡¨ç¤ºä¸­ï¼Œæœ€é«˜ä½æ˜¯ç¬¦å·ä½ï¼Œ0è¡¨ç¤ºæ­£å·ï¼Œ1è¡¨ç¤ºè´Ÿå·ï¼Œå…¶ä½™çš„ n-1 ä½è¡¨ç¤ºæ•°å€¼çš„ç»å¯¹å€¼\nåœ¨åç è¡¨ç¤ºä¸­ï¼Œæœ€é«˜ä½æ˜¯ç¬¦å·ä½ï¼Œ0è¡¨ç¤ºæ­£å·ï¼Œ1è¡¨ç¤ºè´Ÿå·ï¼Œæ­£æ•°çš„åç ä¸åŸç ç›¸åŒï¼Œè´Ÿæ•°çš„åç åˆ™æ˜¯å…¶ç»å¯¹å€¼æŒ‰ä½å–å\næ±‚è´Ÿè¡¥çš„åŠæ³•æ˜¯ï¼šå¯¹è¡¥ç çš„æ¯ä¸€ä½(åŒ…æ‹¬ç¬¦åˆä½)æ±‚åï¼Œä¸”æœªä½åŠ 1\nåœ¨è¡¥ç è¡¨ç¤ºä¸­ï¼Œæœ€é«˜ä½æ˜¯ç¬¦å·ä½ï¼Œ0è¡¨ç¤ºæ­£å·ï¼Œ1è¡¨ç¤ºè´Ÿå·ï¼Œæ­£æ•°çš„è¡¥ç ä¸å…¶åŸç å’ŒåŸç ç›¸åŒï¼Œè´Ÿæ•°çš„è¡¥ç åˆ™ç­‰äºå…¶åç çš„æœ«å°¾åŠ 1\n","description":"","tags":["è®¡ç®—æœºåŸºç¡€"],"title":"åè¯æ¦‚å¿µ","uri":"/computer/nonu/"},{"categories":["jenkins"],"content":"1. è·å–ç¯å¢ƒå˜é‡ printenv 2. Example pipeline { agent any // å®šä¹‰å¸¸é‡ environment { rebotId = 'c24f6255-8160-4587-859a-90fd1b393db5'// é’‰é’‰æœºå™¨äººç¼–å· repositoryUrl = 'http://*.git'// Gitlabä»“åº“åœ°å€ application = \"app\"// åº”ç”¨ä»“åº“åç§° namespace = \"back-code\"// å‘½åç©ºé—´ } stages { stage('æ‹‰å–ä»£ç '){ steps { echo \"æ‹‰å– ${gitlabBranch} åˆ†æ”¯çš„ä»£ç \" checkout([$class: 'GitSCM', branches: [[name: \"*/${gitlabBranch}\"]], doGenerateSubmoduleConfigurations: false, extensions: [], submoduleCfg: [], userRemoteConfigs: [[credentialsId: \"${credentialsId}\", url: \"${repositoryUrl}\"]]]) echo \"å­æ¨¡å—æ›´æ–° composerå®‰è£…\" sh \"\"\" git submodule init \u0026\u0026 git submodule update export COMPOSER_HOME=\"/root/.config/composer\" composer i --dev --ignore-platform-reqs \"\"\" } } stage('é•œåƒéƒ¨ç½²'){ steps { script { commitTemp = sh returnStdout: true, script: 'git describe --tags --always --dirty=\"-dev\"' commitTag = commitTemp.minus(\"\\n\") commitMsg = sh returnStdout: true, script: 'git log --pretty=format:\"%s\" -1' } sh \"\"\" docker build -t \"${IMAGE_REPO}/${namespace}/${application}:${commitTag}\" . docker login -u ${IMAGE_USER} -p \\\"${IMAGE_PASS}\\\" ${IMAGE_REPO} docker push ${IMAGE_REPO}/${namespace}/${application}:${commitTag} \"\"\" } } } // æµæ°´çº¿ç»“æŸé€šçŸ¥ post { // æˆåŠŸé€šçŸ¥ success { dingtalk ( robot: \"${rebotId}\", type: 'MARKDOWN', at: [''], atAll: false, text: [ \"# ğŸ³ ${application}\", '---', \"\u003e æ„å»ºä¿¡æ¯:\", \"\", \"æ„å»ºåº”ç”¨:\u003cfont color='#000000'\u003e${application}\u003c/font\u003e\", \"\", \"æ„å»ºç±»å‹:\u003cfont color='#000000'\u003e${gitlabActionType}\u003c/font\u003e\", \"\", \"æ„å»ºç¯å¢ƒ:\u003cfont color='#000000'\u003e${gitlabBranch}\u003c/font\u003e\", \"\", \"æ„å»ºåˆ†æ”¯:\u003cfont color='#000000'\u003e${commitTag}\u003c/font\u003e\", \"\", \"æ„å»ºç¼–å·:\u003cfont color='#000000'\u003e${BUILD_NUMBER}\u003c/font\u003e\", \"\", \"æ„å»ºç”¨æˆ·:\u003cfont color='#000000'\u003e${gitlabUserName}\u003c/font\u003e\", \"\", \"æ„å»ºè¯¦æƒ…:\u003cfont color='#000000'\u003e${commitMsg}\u003c/font\u003e\", \"\", \"ä»»åŠ¡æ—¥å¿—:[æ‰“å¼€æ§åˆ¶å°](${RUN_DISPLAY_URL})\" ], messageUrl: \"${env.BUILD_URL}\", ) } } } ","description":"","tags":["jenkins","gitlab"],"title":"Record","uri":"/jenkins/record/"},{"categories":["php"],"content":"æœ¬åœ°è°ƒè¯•ç»„ä»¶ 1. ç›®å½•ç»“æ„ åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»ºä¸€ä¸ªpackagiståŒ…ï¼Œç”¨æ¥æ”¾ç½®ç»„ä»¶åŒ…ï¼ŒåŠ å…¥åˆ°.gitignoreæ–‡ä»¶ä¸­ã€‚é€šè¿‡pathçš„æ–¹å¼ï¼Œè®©composerå°†testç»„ä»¶ä½œä¸ºä¾èµ–åŠ è½½åˆ°projectä¸­ 1 2 3 4 5 6 7 8 9  . â”œâ”€â”€ packagist â”‚ â””â”€â”€ test â”‚ â””â”€â”€ src â””â”€â”€ project â”œâ”€â”€ app â”œâ”€â”€ config â”œâ”€â”€ runtime â””â”€â”€ vendor   2. åˆ›å»ºæ–°çš„ç»„ä»¶ 1 2 3 4 5 6 7 8 9  $ cd packagist $ mkdir -p test/src \u0026\u0026 cd test $ composer init //åˆå§‹åŒ–gitä»“åº“,å¡«å†™å¯¹åº”çš„ä¿¡æ¯åä¼šç”Ÿæˆå¯¹åº”çš„composer.jsonæ–‡ä»¶ $ composer i $ vim composer.json   3. ä¿®æ”¹composerå†…å®¹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15  { \"name\": \"qjdata/test\", \"authors\": [ { \"name\": \"Huanglei\", \"email\": \"huanglei@quanjingshuju.com\" } ], \"require\": {}, \"autoload\": { \"psr-4\": { \"Qwertyuiop\\\\\": \"./src\" } } }   4. å¢åŠ æµ‹è¯•ç±» 1 2 3  $ cd src $ vim Test.php   1 2 3 4 5 6 7 8 9 10 11  \u003c?php namespace Qwertyuiop; class Test { public function test() { echo 'qwerty'; } }   5. åœ¨é¡¹ç›®ä¸­ä½¿ç”¨æœªå‘å¸ƒçš„ç»„ä»¶åŒ… 1 2 3 4 5 6  \"repositories\": { \"qjdata/test\": { \"type\": \"path\", \"url\": \"./packagist/test\" } }   1 2 3  $ composer require qjdata/test dev-master //ç°åœ¨å°±å®ç°äº†åœ¨å­é¡¹ç›®æ›´æ”¹ä»£ç ,ä¸»é¡¹ç›®ä»£ç ä¹ŸåŠ¨æ€æ”¹å˜çš„ç›®çš„ $ cd /var/www/html/yaoxiebang-php-skeleton/vendor/ \u0026\u0026 ls -l qjdata //test -\u003e ../../packagist/test   1  var_dump((new Test())-\u003etest()); //å¯ä»¥çœ‹åˆ°è¾“å‡ºäº†\"qwerty\"   ä¸Šä¼ ç»„ä»¶è‡³ç§æœ‰gitlab 1. åœ¨gitlabä¸­åˆ›å»ºä¸€ä¸ªé¡¹ç›®ï¼Œå‘½åä¸ºtest 2. æ¥ä¸‹æ¥æˆ‘ä»¬æŠŠä¸Šç¯‡packagistä¸‹çš„testç›®å½•ä¼ åˆ°gitlabä¸­ 1 2 3 4 5 6 7  $ cd /var/www/html/yaoxiebang-php-skeleton/packagist/test $ git init $ git remote add origin \u003cè¿œç¨‹åœ°å€\u003e $ git add . \u0026\u0026 git commit -m \"Initial commit\" \u0026\u0026 git push -u origin master   3. ä½¿ç”¨ç§æœ‰gitlabä½œä¸ºæº(ä¿®æ”¹composer.json) ä½¿ç”¨sshåœ°å€ï¼Œéœ€è¦å°†å…‹éš†ä»“åº“ç”¨æˆ·çš„id_rsa.pubæ–‡ä»¶æ·»åŠ åˆ°Gitlab 1 2 3 4 5 6  \"repositories\": { \"qjdata/test\": { \"type\": \"vcs\", \"url\": \"\u003curl\u003e\" } }   1  $ composer require qjdata/test dev-master   1  var_dump((new Test())-\u003etest()); //å¯ä»¥çœ‹åˆ°è¾“å‡ºäº†\"qwerty\"   ","description":"","tags":["php","composer","ç»„ä»¶åŒ–å¼€å‘","gitlab"],"title":"Composer ç»„ä»¶åŒ–å¼€å‘","uri":"/php/composer-component/"},{"categories":["git"],"content":" å­æ¨¡å—å…è®¸ä½ å°†ä¸€ä¸ª Git ä»“åº“ä½œä¸ºå¦ä¸€ä¸ª Git ä»“åº“çš„å­ç›®å½•ã€‚ å®ƒèƒ½è®©ä½ å°†å¦ä¸€ä¸ªä»“åº“å…‹éš†åˆ°è‡ªå·±çš„é¡¹ç›®ä¸­ï¼ŒåŒæ—¶è¿˜ä¿æŒæäº¤çš„ç‹¬ç«‹\n æ·»åŠ å­æ¨¡å— 1 2 3  # ä½ å¯ä»¥é€šè¿‡åœ¨ git submodule add å‘½ä»¤åé¢åŠ ä¸Šæƒ³è¦è·Ÿè¸ªçš„é¡¹ç›®çš„ç›¸å¯¹æˆ–ç»å¯¹URLæ¥æ·»åŠ æ–°çš„å­æ¨¡å— $ git submodule add ... //é»˜è®¤æƒ…å†µä¸‹,å­æ¨¡å—ä¼šå°†å­é¡¹ç›®æ”¾åˆ°ä¸€ä¸ªä¸ä»“åº“åŒåçš„ç›®å½•ä¸­,å¦‚æœä½ æƒ³è¦æ”¾åˆ°å…¶ä»–åœ°æ–¹,é‚£ä¹ˆå¯ä»¥åœ¨å‘½ä»¤ç»“å°¾æ·»åŠ ä¸€ä¸ªä¸åŒçš„è·¯å¾„   1 2 3  æ­¤æ—¶.gitmodulesæ–‡ä»¶ä¿å­˜äº†é¡¹ç›® URL ä¸å·²ç»æ‹‰å–çš„æœ¬åœ°ç›®å½•ä¹‹é—´çš„æ˜ å°„ã€‚ ä¿®æ”¹å­æ¨¡å—url: git config submodule.\u003cæ¨¡å—å\u003e.url \u003cç§æœ‰URL\u003e æ¥è¦†ç›–è¿™ä¸ªé€‰é¡¹çš„å€¼   å…‹éš†å«æœ‰å­æ¨¡å—çš„é¡¹ç›® 1 2 3 4 5  $ git clone \u003curl\u003e $ git submodule init //åˆå§‹åŒ–æœ¬åœ°é…ç½®æ–‡ä»¶ $ git submodule update //ä»è¯¥é¡¹ç›®ä¸­æŠ“å–æ‰€æœ‰æ•°æ®å¹¶æ£€å‡ºçˆ¶é¡¹ç›®ä¸­åˆ—å‡ºçš„åˆé€‚çš„æäº¤   1 2 3 4  $ git clone --recurse-submodules \u003curl\u003e //ä¼ é€’--recurse-submodulesé€‰é¡¹,å®ƒå°±ä¼šè‡ªåŠ¨åˆå§‹åŒ–å¹¶æ›´æ–°ä»“åº“ä¸­çš„æ¯ä¸€ä¸ªå­æ¨¡å—,åŒ…æ‹¬å¯èƒ½å­˜åœ¨çš„åµŒå¥—å­æ¨¡å— # å¦‚æœä½ å·²ç»å…‹éš†äº†é¡¹ç›®ä½†å¿˜è®°äº†--recurse-submodule,é‚£ä¹ˆå¯ä»¥è¿è¡Œgit submodule update --initå°†git submodule initå’Œgit submodule updateåˆå¹¶æˆä¸€æ­¥ # å¦‚æœè¿˜è¦åˆå§‹åŒ–ã€æŠ“å–å¹¶æ£€å‡ºä»»ä½•åµŒå¥—çš„å­æ¨¡å—,è¯·ä½¿ç”¨ç®€æ˜çš„git submodule update --init --recursive   åœ¨ä¸»é¡¹ç›®æ›´æ–°å­æ¨¡å— 1 2 3 4 5  $ git submodule update --remote \u003cæ¨¡å—å\u003e $ git config -f .gitmodules submodule.\u003cæ¨¡å—å\u003e.branch \u003cåˆ†æ”¯å\u003e //è®¾ç½®æ¨¡å—é»˜è®¤çš„åˆ†æ”¯ # å¦‚æœä¸ç”¨ -f .gitmodules é€‰é¡¹,é‚£ä¹ˆå®ƒåªä¼šä¸ºä½ åšä¿®æ”¹   æ›´æ–°åŒ…å«å­æ¨¡å—çš„é¡¹ç›® 1 2 3 4  $ git submodule update --init --recursive //å¦‚æœMainProjectæäº¤äº†ä½ åˆšæ‹‰å–çš„æ–°å­æ¨¡å—,åº”è¯¥åœ¨ git submodule update åé¢æ·»åŠ --inité€‰é¡¹,å¦‚æœå­æ¨¡å—æœ‰åµŒå¥—çš„å­æ¨¡å—,åˆ™åº”ä½¿ç”¨--recursiveé€‰é¡¹ # å¦‚æœä½ æƒ³è‡ªåŠ¨åŒ–æ­¤è¿‡ç¨‹,é‚£ä¹ˆå¯ä»¥ä¸º git pull å‘½ä»¤æ·»åŠ --recurse-submodulesé€‰é¡¹ # å¦‚æœä½ æƒ³è®©Gitæ€»æ˜¯ä»¥--recurse-submodulesæ‹‰å–,å¯ä»¥å°†é…ç½®é€‰é¡¹submodule.recurseè®¾ç½®ä¸ºtrue.æ­¤é€‰é¡¹ä¼šè®©Gitä¸ºæ‰€æœ‰æ”¯æŒ--recurse-submodulesçš„å‘½ä»¤ä½¿ç”¨è¯¥é€‰é¡¹(é™¤cloneä»¥å¤–)   å­æ¨¡å—éå† 1 2 3  # æœ‰ä¸€ä¸ªforeachå­æ¨¡å—å‘½ä»¤,å®ƒèƒ½åœ¨æ¯ä¸€ä¸ªå­æ¨¡å—ä¸­è¿è¡Œä»»æ„å‘½ä»¤ $ git submodule foreach 'git stash'   å¢åŠ å­æ¨¡å—åˆ«å 1 2 3  $ git config alias.sdiff '!'\"git diff \u0026\u0026 git submodule foreach 'git diff'\" $ git config alias.spush 'push --recurse-submodules=on-demand' $ git config alias.supdate 'submodule update --remote --merge'   åˆ é™¤å­æ¨¡å— 1 2 3  $ git submodule deinit \u003cå­æ¨¡å—\u003e //é€†åˆå§‹åŒ–æ¨¡å— $ git rm --cached \u003cå­æ¨¡å—\u003e //åˆ é™¤.gitmodulesä¸­è®°å½•çš„æ¨¡å—ä¿¡æ¯(--cachedé€‰é¡¹æ¸…é™¤.git/modulesä¸­çš„ç¼“å­˜) $ git commit -m 'comment'   gitå®˜æ–¹æ–‡æ¡£\n","description":"","tags":["git"],"title":"Git å­æ¨¡å—","uri":"/git/submodule/"},{"categories":["php"],"content":"1. è®¾ç½®æ—¶åŒº  date_default_timezone_set â€” è®¾å®šç”¨äºä¸€ä¸ªè„šæœ¬ä¸­æ‰€æœ‰æ—¥æœŸæ—¶é—´å‡½æ•°çš„é»˜è®¤æ—¶åŒº\n date_default_timezone_set ( string $timezone_identifier ) : bool ç”¨æ³• 1  date_default_timezone_set('Asia/Shanghai');    ini_set â€” ä¸ºä¸€ä¸ªé…ç½®é€‰é¡¹è®¾ç½®å€¼ï¼Œè¿™ä¸ªé€‰é¡¹ä¼šåœ¨è„šæœ¬è¿è¡Œæ—¶ä¿æŒæ–°çš„å€¼ï¼Œå¹¶åœ¨è„šæœ¬ç»“æŸæ—¶æ¢å¤ã€‚\n ç”¨æ³• 1  ini_set('date.timezone','Asia/Shanghai');   æ”¯æŒä½¿ç”¨ini_setä¿®æ”¹çš„å‚æ•°é™„å½•\n2. ç”Ÿæˆä¸€ä¸ªæ ¼å¼åŒ–çš„æ—¶é—´  date â€” æ ¼å¼åŒ–ä¸€ä¸ªæœ¬åœ°æ—¶é—´ï¼æ—¥æœŸ\n date ( string $format [, int $timestamp ] ) : string    format å­—ç¬¦ æè¿° è¿”å›å€¼ç¤ºä¾‹     å¤© â€” â€”   d ä¸€ä¸ªæœˆä¸­çš„ç¬¬å‡ å¤©ï¼Œæœ‰å‰å¯¼0çš„2ä½æ•°å­— ä»01åˆ°31   D 3ä¸ªå­—ç¬¦è¡¨ç¤ºçš„æ˜ŸæœŸå‡  3ä¸ªå­—ç¬¦è¡¨ç¤ºçš„æ˜ŸæœŸå‡ ï¼Œä»Monåˆ°Sun   j ä¸€ä¸ªæœˆä¸­çš„ç¬¬å‡ å¤©ï¼Œæ— å‰å¯¼0 ä»1åˆ°31   N ISO-8601 è§„å®šçš„æ•°å­—è¡¨ç¤ºçš„æ˜ŸæœŸå‡  ä»1(è¡¨ç¤ºæ˜ŸæœŸä¸€)åˆ°7(è¡¨ç¤ºæ˜ŸæœŸæ—¥)   w æ•°å­—è¡¨ç¤ºçš„æ˜ŸæœŸå‡  ä»0(æ˜ŸæœŸæ—¥)åˆ°6(æ˜ŸæœŸå…­)   z ä¸€å¹´ä¸­çš„ç¬¬å‡ å¤©ï¼Œä»0å¼€å§‹è®¡æ•° ä» 0 åˆ° 365   å‘¨ â€” â€”   W ISO-8601è§„èŒƒçš„ä¸€å¹´ä¸­çš„ç¬¬å‡ å‘¨ï¼Œå‘¨ä¸€è§†ä¸ºä¸€å‘¨å¼€å§‹ã€‚ 42(æœ¬å¹´ç¬¬42å‘¨)   æœˆ â€” â€”   m å¸¦æœ‰0å‰å¯¼çš„æ•°å­—è¡¨ç¤ºçš„æœˆä»½ ä»01åˆ°12   n æœˆä»½çš„æ•°å­—è¡¨ç¤ºï¼Œæ— å‰å¯¼0 ä»1åˆ°12   t ç»™å®šæœˆä»½ä¸­åŒ…å«å¤šå°‘å¤© ä»28åˆ°31   å¹´ â€” â€”   Y 4ä½æ•°å­—çš„å¹´ä»½ 1999æˆ–2003   y 2ä½æ•°å­—çš„å¹´ä»½ 99æˆ–03   æ—¶é—´ â€” â€”   a ä¸Šåˆè¿˜æ˜¯ä¸‹åˆï¼Œ2ä½å°å†™å­—ç¬¦ amæˆ–pm   A ä¸Šåˆè¿˜æ˜¯ä¸‹åˆï¼Œ2ä½å¤§å†™å­—ç¬¦ AMæˆ–PM   g å°æ—¶ï¼Œ12æ—¶åˆ¶ï¼Œæ— å‰å¯¼0 ä»1åˆ°12   G å°æ—¶ï¼Œ24æ—¶åˆ¶ï¼Œæ— å‰å¯¼0 ä»0åˆ°23   h å°æ—¶ï¼Œ12æ—¶åˆ¶ï¼Œæœ‰å‰å¯¼0çš„2ä½æ•°å­— ä»01åˆ°12   H å°æ—¶ï¼Œ24æ—¶åˆ¶ï¼Œæœ‰å‰å¯¼0çš„2ä½æ•°å­— ä»00åˆ°23   i åˆ†é’Ÿï¼Œæœ‰å‰å¯¼0çš„2ä½æ•°å­— ä»00åˆ°59   s ç§’ï¼Œæœ‰å‰å¯¼0çš„2ä½æ•°å­— ä»00åˆ°59   å®Œæ•´çš„æ—¥æœŸ/æ—¶é—´ â€” â€”   c ISO 8601æ—¥æœŸåŠæ—¶é—´ 2004-02-12T15:19:21+00:00   U æ—¶é—´æˆ³ï¼Œä»¥ç§’ä¸ºå•ä½ 1539100800    å‚è€ƒphpæ‰‹å†Œ\n3. å°†æ—¶é—´è½¬æ¢ä¸ºæ—¶é—´æˆ³  strtotime â€” å°†ä»»ä½•å­—ç¬¦ä¸²çš„æ—¥æœŸæ—¶é—´æè¿°è§£æä¸º Unix æ—¶é—´æˆ³\n ç”¨æ³• 1 2 3 4  strtotime('+1 day'); strtotime(\"+1 week 2 days 4 hours 2 seconds\"); strtotime(\"next Thursday\"); strtotime(\"last Monday\");   å¸¸ç”¨ç”¨æ³• 1 2 3 4  strtotime(date('Y-m-d')); strtotime('+1 day', strtotime(date('Y-m-d'))); strtotime(\"first day of next month\", strtotime(\"2017-01-31\")); strtotime(\"last day of last month\", strtotime(\"2017-03-31\"));   æ³¨æ„ 1 2 3 4 5 6 7 8  var_dump(date(\"Y-m-d\", strtotime(\"-1 month\", strtotime(\"2017-03-31\")))); //è¾“å‡º2017-03-03 var_dump(date(\"Y-m-d\", strtotime(\"+1 month\", strtotime(\"2017-08-31\")))); //è¾“å‡º2017-10-01 var_dump(date(\"Y-m-d\", strtotime(\"next month\", strtotime(\"2017-01-31\")))); //è¾“å‡º2017-03-03 var_dump(date(\"Y-m-d\", strtotime(\"last month\", strtotime(\"2017-03-31\")))); //è¾“å‡º2017-03-03   è§£å†³æ–¹æ¡ˆ 1 2 3 4 5 6 7 8  var_dump(date(\"Y-m-d\", strtotime(\"last day of -1 month\", strtotime(\"2017-03-31\")))); //è¾“å‡º2017-02-28 var_dump(date(\"Y-m-d\", strtotime(\"first day of +1 month\", strtotime(\"2017-08-31\")))); //è¾“å‡º2017-09-01 var_dump(date(\"Y-m-d\", strtotime(\"first day of next month\", strtotime(\"2017-01-31\")))); //è¾“å‡º2017-02-01 var_dump(date(\"Y-m-d\", strtotime(\"last day of last month\", strtotime(\"2017-03-31\")))); //è¾“å‡º2017-02-28   ä»¤äººå›°æƒ‘çš„strtotime\n","description":"","tags":["php"],"title":"Php éƒ¨åˆ†æ—¶é—´å‡½æ•°","uri":"/php/time/"},{"categories":["docker"],"content":"1. FROM FROM å¿…é¡» æ˜¯ Dockerfile ä¸­ç¬¬ä¸€æ¡éæ³¨é‡Šå‘½ä»¤, tag æˆ– digest æ˜¯å¯é€‰çš„ 2. RUN RUN æŒ‡ä»¤åˆ›å»ºçš„ä¸­é—´é•œåƒä¼šè¢«ç¼“å­˜ï¼Œå¹¶ä¼šåœ¨ä¸‹æ¬¡æ„å»ºä¸­ä½¿ç”¨ã€‚å¦‚æœä¸æƒ³ä½¿ç”¨è¿™äº›ç¼“å­˜é•œåƒï¼Œå¯ä»¥åœ¨æ„å»ºæ—¶æŒ‡å®š --no-cache å‚æ•° 3. COPY COPY æŒ‡ä»¤å°†ä»æ„å»ºä¸Šä¸‹æ–‡ç›®å½•ä¸­ \u003cæºè·¯å¾„\u003e çš„æ–‡ä»¶/ç›®å½•å¤åˆ¶åˆ°æ–°çš„ä¸€å±‚çš„é•œåƒå†…çš„`\u003cç›®æ ‡è·¯å¾„\u003e`ä½ç½® \u003cç›®æ ‡è·¯å¾„\u003eå¯ä»¥æ˜¯å®¹å™¨å†…çš„ç»å¯¹è·¯å¾„ï¼Œä¹Ÿå¯ä»¥æ˜¯ç›¸å¯¹äºå·¥ä½œç›®å½•çš„ç›¸å¯¹è·¯å¾„(å·¥ä½œç›®å½•å¯ä»¥ç”¨ WORKDIR æŒ‡ä»¤æ¥æŒ‡å®š) ä½¿ç”¨ COPY æŒ‡ä»¤ï¼Œæºæ–‡ä»¶çš„å„ç§å…ƒæ•°æ®éƒ½ä¼šä¿ç•™ã€‚æ¯”å¦‚è¯»ã€å†™ã€æ‰§è¡Œæƒé™ã€æ–‡ä»¶å˜æ›´æ—¶é—´ç­‰ã€‚è¿™ä¸ªç‰¹æ€§å¯¹äºé•œåƒå®šåˆ¶å¾ˆæœ‰ç”¨ã€‚ç‰¹åˆ«æ˜¯æ„å»ºç›¸å…³æ–‡ä»¶éƒ½åœ¨ä½¿ç”¨ Git è¿›è¡Œç®¡ç†çš„æ—¶å€™ COPY å‘½ä»¤åŒºåˆ«äº ADD å‘½ä»¤çš„ä¸€ä¸ªç”¨æ³•æ˜¯åœ¨ multistage åœºæ™¯ä¸‹ 4. Add é™¤äº†ä¸èƒ½ç”¨åœ¨ multistage çš„åœºæ™¯ä¸‹ï¼ŒADD å‘½ä»¤å¯ä»¥å®Œæˆ COPY å‘½ä»¤çš„æ‰€æœ‰åŠŸèƒ½ è§£å‹å‹ç¼©æ–‡ä»¶å¹¶æŠŠå®ƒä»¬æ·»åŠ åˆ°é•œåƒä¸­ WORKDIR /app ADD nickdir.tar.gz . 5. Env è®¾ç½®ç¯å¢ƒå˜é‡, åé¢çš„å…¶å®ƒæŒ‡ä»¤éƒ½å¯ä»¥ç›´æ¥ä½¿ç”¨è¿™é‡Œå®šä¹‰çš„ç¯å¢ƒå˜é‡ ENV VERSION=1.0 DEBUG=on \\ NAME=\"Happy Feet\" // .env # Port PHP_CONTAINER_NAME=php PHP_VERSION={???}-fpm-alpine // docker-compose services: php: container_name: ${PHP_CONTAINER_NAME} build: context: .docker/php args: - PHP_VERSION=${PHP_VERSION} ... // Dockerfile ARG PHP_VERSION FROM php:${PHP_VERSION} 6. EXPOSE EXPOSE æŒ‡ä»¤å¹¶ä¸ä¼šè®©å®¹å™¨ç›‘å¬ host çš„ç«¯å£ï¼Œå¦‚æœéœ€è¦ï¼Œéœ€è¦åœ¨ docker run æ—¶ä½¿ç”¨ -pã€-P å‚æ•°æ¥å‘å¸ƒå®¹å™¨ç«¯å£åˆ° host çš„æŸä¸ªç«¯å£ä¸Šã€‚ å¥½å¤„: ä¸€ä¸ªæ˜¯å¸®åŠ©é•œåƒä½¿ç”¨è€…ç†è§£è¿™ä¸ªé•œåƒæœåŠ¡çš„å®ˆæŠ¤ç«¯å£ï¼Œä»¥æ–¹ä¾¿é…ç½®æ˜ å°„ï¼› å¦ä¸€ä¸ªç”¨å¤„åˆ™æ˜¯åœ¨è¿è¡Œæ—¶ä½¿ç”¨éšæœºç«¯å£æ˜ å°„æ—¶ï¼Œä¹Ÿå°±æ˜¯ docker run -P æ—¶ï¼Œä¼šè‡ªåŠ¨éšæœºæ˜ å°„ EXPOSE çš„ç«¯å£ è¦å°† EXPOSE å’Œåœ¨è¿è¡Œæ—¶ä½¿ç”¨ -p \u003cå®¿ä¸»ç«¯å£\u003e:\u003cå®¹å™¨ç«¯å£\u003e åŒºåˆ†å¼€æ¥ã€‚ -pï¼Œæ˜¯æ˜ å°„å®¿ä¸»ç«¯å£å’Œå®¹å™¨ç«¯å£, æ¢å¥è¯è¯´ï¼Œå°±æ˜¯å°†å®¹å™¨çš„å¯¹åº”ç«¯å£æœåŠ¡å…¬å¼€ç»™å¤–ç•Œè®¿é—®ã€‚ è€Œ EXPOSE ä»…ä»…æ˜¯å£°æ˜å®¹å™¨æ‰“ç®—ä½¿ç”¨ä»€ä¹ˆç«¯å£è€Œå·²ï¼Œå¹¶ä¸ä¼šè‡ªåŠ¨åœ¨å®¿ä¸»è¿›è¡Œç«¯å£æ˜ å°„ã€‚ 7. VOLUME æ ¼å¼ä¸ºï¼š VOLUME [\"\u003cè·¯å¾„ 1\u003e\", \"\u003cè·¯å¾„ 2\u003e\"...] VOLUME \u003cè·¯å¾„\u003e å®¹å™¨è¿è¡Œæ—¶åº”è¯¥å°½é‡ä¿æŒå®¹å™¨å­˜å‚¨å±‚ä¸å‘ç”Ÿå†™æ“ä½œï¼Œå¯¹äºæ•°æ®åº“ç±»éœ€è¦ä¿å­˜åŠ¨æ€æ•°æ®çš„åº”ç”¨ï¼Œå…¶æ•°æ®åº“æ–‡ä»¶åº”è¯¥ä¿å­˜äºå·(volume)ä¸­ åœ¨ Dockerfile ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥äº‹å…ˆæŒ‡å®šæŸäº›ç›®å½•æŒ‚è½½ä¸ºåŒ¿åå·ï¼Œè¿™æ ·åœ¨è¿è¡Œæ—¶å¦‚æœç”¨æˆ·ä¸æŒ‡å®šæŒ‚è½½ï¼Œå…¶åº”ç”¨ä¹Ÿå¯ä»¥æ­£å¸¸è¿è¡Œï¼Œä¸ä¼šå‘å®¹å™¨å­˜å‚¨å±‚å†™å…¥å¤§é‡æ•°æ®ã€‚ # è¿™é‡Œçš„ /data ç›®å½•å°±ä¼šåœ¨è¿è¡Œæ—¶è‡ªåŠ¨æŒ‚è½½ä¸ºåŒ¿åå·ï¼Œä»»ä½•å‘ /data ä¸­å†™å…¥çš„ä¿¡æ¯éƒ½ä¸ä¼šè®°å½•è¿›å®¹å™¨å­˜å‚¨å±‚ï¼Œä»è€Œä¿è¯äº†å®¹å™¨å­˜å‚¨å±‚çš„æ— çŠ¶æ€åŒ– VOLUME /data # å½“ç„¶ï¼Œè¿è¡Œæ—¶å¯ä»¥è¦†ç›–è¿™ä¸ªæŒ‚è½½è®¾ç½®ï¼Œåœ¨è¿™è¡Œå‘½ä»¤ä¸­ï¼Œå°±ä½¿ç”¨äº† mydata è¿™ä¸ªå‘½åå·æŒ‚è½½åˆ°äº† /data è¿™ä¸ªä½ç½®ï¼Œæ›¿ä»£äº† Dockerfile ä¸­å®šä¹‰çš„åŒ¿åå·çš„æŒ‚è½½é…ç½®ã€‚ docker run -d -v mydata:/data xxxx 8. WORKDIR ä½¿ç”¨ WORKDIR æŒ‡ä»¤å¯ä»¥æ¥æŒ‡å®šå·¥ä½œç›®å½•ï¼ˆæˆ–è€…ç§°ä¸ºå½“å‰ç›®å½•ï¼‰ï¼Œä»¥åå„å±‚çš„å½“å‰ç›®å½•å°±è¢«æ”¹ä¸ºæŒ‡å®šçš„ç›®å½•ï¼Œå¦‚è¯¥ç›®å½•ä¸å­˜åœ¨ï¼ŒWORKDIR ä¼šå¸®ä½ å»ºç«‹ç›®å½•ã€‚ RUN cd /app RUN echo \"hello\" \u003e world.txt ç¬¬ä¸€å±‚ RUN cd /app çš„æ‰§è¡Œä»…ä»…æ˜¯å½“å‰è¿›ç¨‹çš„å·¥ä½œç›®å½•å˜æ›´ï¼Œä¸€ä¸ªå†…å­˜ä¸Šçš„å˜åŒ–è€Œå·²ï¼Œå…¶ç»“æœä¸ä¼šé€ æˆä»»ä½•æ–‡ä»¶å˜æ›´ã€‚ è€Œåˆ°ç¬¬äºŒå±‚çš„æ—¶å€™ï¼Œå¯åŠ¨çš„æ˜¯ä¸€ä¸ªå…¨æ–°çš„å®¹å™¨ï¼Œè·Ÿç¬¬ä¸€å±‚çš„å®¹å™¨æ›´å®Œå…¨æ²¡å…³ç³»ï¼Œè‡ªç„¶ä¸å¯èƒ½ç»§æ‰¿å‰ä¸€å±‚æ„å»ºè¿‡ç¨‹ä¸­çš„å†…å­˜å˜åŒ–ã€‚ å› æ­¤å¦‚æœéœ€è¦æ”¹å˜ä»¥åå„å±‚çš„å·¥ä½œç›®å½•çš„ä½ç½®ï¼Œé‚£ä¹ˆåº”è¯¥ä½¿ç”¨ WORKDIR æŒ‡ä»¤ 9. LABEL LABEL æŒ‡ä»¤ç”¨æ¥ç»™é•œåƒä»¥é”®å€¼å¯¹çš„å½¢å¼æ·»åŠ ä¸€äº›å…ƒæ•°æ® LABEL \u003ckey\u003e=\u003cvalue\u003e \u003ckey\u003e=\u003cvalue\u003e \u003ckey\u003e=\u003cvalue\u003e ... æŒ‡å®šåå¯ä»¥é€šè¿‡docker inspectæŸ¥çœ‹ï¼š docker inspect ($images) \"Labels\": { }, 10. CMD ä¸ RUN æŒ‡ä»¤çš„åŒºåˆ«ï¼šRUN åœ¨æ„å»ºçš„æ—¶å€™æ‰§è¡Œï¼Œå¹¶ç”Ÿæˆä¸€ä¸ªæ–°çš„é•œåƒï¼ŒCMD åœ¨å®¹å™¨è¿è¡Œçš„æ—¶å€™æ‰§è¡Œï¼Œåœ¨æ„å»ºæ—¶ä¸è¿›è¡Œä»»ä½•æ“ä½œã€‚ Docker ä¸æ˜¯è™šæ‹Ÿæœºï¼Œå®¹å™¨ä¸­çš„åº”ç”¨éƒ½åº”è¯¥ä»¥å‰å°æ‰§è¡Œï¼Œè€Œä¸æ˜¯åƒè™šæ‹Ÿæœºã€ç‰©ç†æœºé‡Œé¢é‚£æ ·ï¼Œç”¨ systemd å»å¯åŠ¨åå°æœåŠ¡ï¼Œå®¹å™¨å†…æ²¡æœ‰åå°æœåŠ¡çš„æ¦‚å¿µã€‚ å¯¹äºå®¹å™¨è€Œè¨€ï¼Œå…¶å¯åŠ¨ç¨‹åºå°±æ˜¯å®¹å™¨åº”ç”¨è¿›ç¨‹ï¼Œå®¹å™¨å°±æ˜¯ä¸ºäº†ä¸»è¿›ç¨‹è€Œå­˜åœ¨çš„ï¼Œä¸»è¿›ç¨‹é€€å‡ºï¼Œå®¹å™¨å°±å¤±å»äº†å­˜åœ¨çš„æ„ä¹‰ï¼Œä»è€Œé€€å‡ºï¼Œå…¶å®ƒè¾…åŠ©è¿›ç¨‹ä¸æ˜¯å®ƒéœ€è¦å…³å¿ƒçš„ä¸œè¥¿ã€‚ 11. ENTRYPOINT å½“æŒ‡å®šäº† ENTRYPOINT åï¼ŒCMD çš„å«ä¹‰å°±å‘ç”Ÿäº†æ”¹å˜ï¼Œä¸å†æ˜¯ç›´æ¥çš„è¿è¡Œå…¶å‘½ä»¤ï¼Œè€Œæ˜¯å°† CMD çš„å†…å®¹ä½œä¸ºå‚æ•°ä¼ ç»™ ENTRYPOINT æŒ‡ä»¤ï¼Œæ¢å¥è¯è¯´å®é™…æ‰§è¡Œæ—¶ï¼Œå°†å˜ä¸ºï¼š \u003cENTRYPOINT\u003e \"\u003cCMD\u003e\" å‚è€ƒæ–‡ç« \nå‚è€ƒæ–‡ç« \n","description":"","tags":["docker","Dockerfile"],"title":"DockerFile æŒ‡ä»¤","uri":"/docker/docker-file/"},{"categories":["nginx"],"content":"1. location é…ç½®  è¯­æ³•è§„åˆ™ï¼š location [=|~|~*|^~] /uri/ { â€¦ }\n 1 2 3 4 5 6  = å¼€å¤´è¡¨ç¤ºç²¾ç¡®åŒ¹é… ^~ å¼€å¤´è¡¨ç¤ºuriä»¥æŸä¸ªå¸¸è§„å­—ç¬¦ä¸²å¼€å¤´ï¼Œç†è§£ä¸ºåŒ¹é… urlè·¯å¾„å³å¯ã€‚nginxä¸å¯¹urlåšç¼–ç ï¼Œå› æ­¤è¯·æ±‚ä¸º/static/20%/aaï¼Œå¯ä»¥è¢«è§„åˆ™^~ /static/ /aaåŒ¹é…åˆ° ~ å¼€å¤´è¡¨ç¤ºåŒºåˆ†å¤§å°å†™çš„æ­£åˆ™åŒ¹é… ~* å¼€å¤´è¡¨ç¤ºä¸åŒºåˆ†å¤§å°å†™çš„æ­£åˆ™åŒ¹é… !~å’Œ!~*åˆ†åˆ«ä¸ºåŒºåˆ†å¤§å°å†™ä¸åŒ¹é…åŠä¸åŒºåˆ†å¤§å°å†™ä¸åŒ¹é… çš„æ­£åˆ™ / é€šç”¨åŒ¹é…ï¼Œä»»ä½•è¯·æ±‚éƒ½ä¼šåŒ¹é…åˆ°   2. é˜²æ­¢ç”¨æˆ·è®¿é—®æŸäº›éšç§æ–‡ä»¶ # ç¦æ­¢ç”¨æˆ·è®¿é—®.envæˆ–å…¶ä»–æ–‡ä»¶ location ~ /\\. { deny all; } # ç¦æ­¢ç”¨æˆ·è®¿é—®æŸäº›åç¼€çš„æ–‡ä»¶ location ~\\.(json|lock|yml|yaml) { deny all; } 3. åå‘ä»£ç† location / { proxy_pass https://www.baidu.com; } 4. è´Ÿè½½å‡è¡¡ å®ç°è´Ÿè½½å‡è¡¡ï¼š\n è½®è¯¢ RR - é»˜è®¤ æ¯ä¸ªè¯·æ±‚æŒ‰æ—¶é—´é¡ºåºé€ä¸€åˆ†é…åˆ°ä¸åŒçš„åç«¯æœåŠ¡å™¨, å¦‚æœåç«¯æœåŠ¡å™¨ down æ‰, èƒ½è‡ªåŠ¨å‰”é™¤.  upstream balanceServer { server balance1.com; server balance2.com; } server { listen 80; server_name test.me; location / { proxy_pass http://balanceServer; } } æƒé‡ æŒ‡å®šè½®è¯¢å‡ ç‡, weight å’Œè®¿é—®æ¯”ç‡æˆæ­£æ¯”, ç”¨äºåç«¯æœåŠ¡å™¨æ€§èƒ½ä¸å‡çš„æƒ…å†µ  upstream balanceServer { server balance1.com weight=3; server balance2.com weight=7; } server { listen 80; server_name test.me; location / { proxy_pass http://balanceServer; } } IP hash å½“æˆ‘ä»¬çš„ç¨‹åºä¸æ˜¯æ— çŠ¶æ€çš„æ—¶å€™(é‡‡ç”¨ session ä¿å­˜æ•°æ®), é‚£ä¹ˆè·³è½¬åˆ°å¦å¤–ä¸€å°æœåŠ¡å™¨çš„æ—¶å€™å°±éœ€è¦é‡æ–°ç™»å½•äº†, IP hash çš„æ¯ä¸ªè¯·æ±‚æŒ‰è®¿é—® ip çš„ hash ç»“æœåˆ†é…ï¼Œè¿™æ ·æ¯ä¸ªè®¿å®¢å›ºå®šè®¿é—®ä¸€ä¸ªåç«¯æœåŠ¡å™¨ï¼Œå¯ä»¥è§£å†³ session çš„é—®é¢˜ã€‚  upstream balanceServer { ip_hash; server balance1.com; server balance2.com; } server { listen 80; server_name test.me; location / { proxy_pass http://balanceServer; } } 5. è·å–åå‘ä»£ç†çœŸå® ip # é€šè¿‡è®¾ç½®header, ä¹‹åå°±å¯ä»¥åœ¨è¯·æ±‚å¤´x-real-ipè·å–çœŸå®ip proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; 6. 504 Gateway Time-out # è°ƒèŠ‚ proxy_read_timeout å’Œ proxy_send_timeout è‡³åˆé€‚æ•°å€¼å³å¯ 7. è°ƒæ•´è¿è¡Œå·¥ä½œè¿›ç¨‹æ•°é‡ # è¿è¡Œå·¥ä½œè¿›ç¨‹ä¸ªæ•°ä¸€èˆ¬è®¾ç½®CPUçš„æ ¸å¿ƒæˆ–è€…æ ¸å¿ƒæ•°x2 worker_processes 2; ","description":"","tags":["nginx"],"title":"Nginxé…ç½®","uri":"/nginx/configuration/"},{"categories":["linux"],"content":" ä¸ºäº†é«˜æ•ˆçš„ä½¿ç”¨Linuxç³»ç»Ÿï¼Œä½¿ç”¨Linuxå‘½ä»¤æ˜¯å¿…ä¸å¯å°‘çš„ï¼Œæœ‰å¾ˆå¤šå¸¸ç”¨çš„Linuxå‘½ä»¤æ›´æ˜¯è¦å¿…é¡»æŒæ¡çš„\n 1. uptime  uptime(é€‰é¡¹)\n 1 2 3 4 5 6 7  # uptimeå‘½ä»¤å¯ä»¥æ˜¾ç¤ºçš„ä¿¡æ¯æ˜¾ç¤ºä¾æ¬¡ä¸º:ç°åœ¨æ—¶é—´ã€ç³»ç»Ÿå·²ç»è¿è¡Œäº†å¤šé•¿æ—¶é—´ã€ç›®å‰æœ‰å¤šå°‘ç™»é™†ç”¨æˆ·ã€ç³»ç»Ÿåœ¨è¿‡å»çš„1åˆ†é’Ÿã€5åˆ†é’Ÿå’Œ15åˆ†é’Ÿå†…çš„å¹³å‡è´Ÿè½½ $ uptime 7:41 up 17:20, //ç³»ç»Ÿå½“å‰æ—¶é—´,ä¸»æœºå·²è¿è¡Œæ—¶é—´,æ—¶é—´è¶Šå¤§,è¯´æ˜ä½ çš„æœºå™¨è¶Šç¨³å®š 2 users, //ç”¨æˆ·æ€»è¿æ¥æ•° load averages: 3.86 3.73 3.33 //ç»Ÿè®¡æœ€è¿‘1,5,15åˆ†é’Ÿçš„ç³»ç»Ÿå¹³å‡è´Ÿè½½(ç»Ÿè®¡æœ€è¿‘1,5,15åˆ†é’Ÿçš„ç³»ç»Ÿå¹³å‡è´Ÿè½½)   2. tail  tail(é€‰é¡¹)(æŒ‡å®šè¦æ˜¾ç¤ºå°¾éƒ¨å†…å®¹çš„æ–‡ä»¶åˆ—è¡¨)\n 1 2 3 4 5 6 7  $ tail -n 3 \u003cfile\u003e //-n æŒ‡å®šæ˜¾ç¤ºæœ«å°¾çš„nè¡Œ,é»˜è®¤ä¸º10è¡Œ $ tail +20 \u003cfile\u003e //æ˜¾ç¤ºæ–‡ä»¶fileçš„å†…å®¹,ä»ç¬¬20è¡Œè‡³æ–‡ä»¶æœ«å°¾ $ tail -c 10 \u003cfile\u003e //-c æŒ‡å®šæ˜¾ç¤ºçš„å­—ç¬¦ $ tail -f \u003cfile\u003e //æ˜¾ç¤ºæ–‡ä»¶æœ€æ–°è¿½åŠ çš„å†…å®¹   3. find  find(é€‰é¡¹)(æŸ¥æ‰¾æ–‡ä»¶çš„èµ·å§‹ç›®å½•)\n 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15  $ find . -name *.md //æŸ¥æ‰¾å½“å‰ç›®å½•ä¸‹ä»¥mdç»“å°¾çš„æ–‡ä»¶ $ find . -name 'linux' //æŸ¥æ‰¾å½“å‰ç›®å½•ä¸‹æ‰€æœ‰åŒ…å«'linux'å…³é”®å­—çš„æ–‡ä»¶ $ find / ! -name \"*.txt\" //æ‰¾å‡º/ä¸‹ä¸æ˜¯ä»¥.txtç»“å°¾çš„æ–‡ä»¶ $ find . -type ç±»å‹å‚æ•°(f æ™®é€šæ–‡ä»¶,l ç¬¦å·è¿æ¥,d ç›®å½•,c å­—ç¬¦è®¾å¤‡,b å—è®¾å¤‡,s å¥—æ¥å­—,p Fifo) $ find . -type f -name \"*.txt\" -delete //åˆ é™¤å½“å‰ç›®å½•ä¸‹æ‰€æœ‰.txtæ–‡ä»¶ $ find . -type f -perm 777 //å½“å‰ç›®å½•ä¸‹æœç´¢å‡ºæƒé™ä¸º777çš„æ–‡ä»¶ $ find . -type f -user \u003cuser\u003e //æ‰¾å‡ºå½“å‰ç›®å½•ç”¨æˆ·æ‹¥æœ‰çš„æ‰€æœ‰æ–‡ä»¶ $ find . -type f -group \u003cgroup\u003e //æ‰¾å‡ºå½“å‰ç›®å½•ç”¨æˆ·ç»„æ‹¥æœ‰çš„æ‰€æœ‰æ–‡ä»¶   4. wc  wc(é€‰é¡¹)(æ–‡ä»¶åˆ—è¡¨)\n 1 2 3 4 5 6 7 8 9 10 11  # åˆ©ç”¨wcæŒ‡ä»¤æˆ‘ä»¬å¯ä»¥è®¡ç®—æ–‡ä»¶çš„Byteæ•°ã€å­—æ•°æˆ–æ˜¯åˆ—æ•°ï¼Œè‹¥ä¸æŒ‡å®šæ–‡ä»¶åç§°,æˆ–æ˜¯æ‰€ç»™äºˆçš„æ–‡ä»¶åä¸ºâ€œ-â€,åˆ™wcæŒ‡ä»¤ä¼šä»æ ‡å‡†è¾“å…¥è®¾å¤‡è¯»å–æ•°æ® $ wc -c \u003cfiles\u003e //æ˜¾ç¤ºBytesæ•° $ wc -l \u003cfiles\u003e //æ˜¾ç¤ºåˆ—æ•° $ wc -w \u003cfiles\u003e //æ˜¾ç¤ºå­—æ•° # wc -l å¯ä»¥é…åˆï½œè¿›è¡Œç»Ÿè®¡ï¼ˆä¾‹å¦‚å¯ä»¥ç»Ÿè®¡æ–‡ä»¶çš„è¡Œæ•°ï¼Œè¿›ç¨‹çš„ä¸ªæ•°ï¼‰ # ps -ef | grep php | wc -l # cat test.txt | grep 90 | wc -l   5. grep  grepæ˜¯ä¸€ç§å¼ºå¤§çš„æ–‡æœ¬æœç´¢å·¥å…·,å®ƒèƒ½ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æœç´¢æ–‡æœ¬,å¹¶æŠŠåŒ¹é…çš„è¡Œæ‰“å°å‡ºæ¥,æ–‡ä»¶å¤¹çš„è¯éœ€è¦é€’å½’æœç´¢-R\n 1 2 3 4 5 6 7  $ grep \"match_pattern\" \u003cfile1\u003e \u003cfile2\u003e //æ–‡ä»¶ä¸­æŸ¥æ‰¾ $ grep -c \"match_pattern\" \u003cfile1\u003e \u003cfile2\u003e //ç»Ÿè®¡æ–‡ä»¶æˆ–è€…æ–‡æœ¬ä¸­åŒ…å«åŒ¹é…å­—ç¬¦ä¸²çš„è¡Œæ•° $ grep -E \"[1-9]+\" //ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼ -E åŒ¹é… $ grep -n \"match_pattern\" \u003cfile1\u003e \u003cfile2\u003e //åœ¨æ˜¾ç¤ºç¬¦åˆèŒƒæœ¬æ ·å¼çš„é‚£ä¸€åˆ—ä¹‹å‰,æ ‡ç¤ºå‡ºè¯¥åˆ—çš„ç¼–å·   6. lsof  lsofå‘½ä»¤ç”¨äºæŸ¥çœ‹ä½ è¿›ç¨‹æ‰“å¼€çš„æ–‡ä»¶ï¼Œæ‰“å¼€æ–‡ä»¶çš„è¿›ç¨‹ï¼Œè¿›ç¨‹æ‰“å¼€çš„ç«¯å£(TCPã€UDP)ã€‚æ‰¾å›/æ¢å¤åˆ é™¤çš„æ–‡ä»¶ã€‚æ˜¯ååˆ†æ–¹ä¾¿çš„ç³»ç»Ÿç›‘è§†å·¥å…·ï¼Œå› ä¸ºlsofå‘½ä»¤éœ€è¦è®¿é—®æ ¸å¿ƒå†…å­˜å’Œå„ç§æ–‡ä»¶ï¼Œæ‰€ä»¥éœ€è¦rootç”¨æˆ·æ‰§è¡Œ\n 1 2 3 4 5 6 7  $ lsof -i:\u003cport\u003e //åˆ—å‡ºè°åœ¨ä½¿ç”¨æŸä¸ªç«¯å£ $ lsof -i udp:\u003cport\u003e //åˆ—å‡ºè°åœ¨ä½¿ç”¨æŸä¸ªç‰¹å®šçš„udpç«¯å£ $ lsof -i tcp:\u003cport\u003e //åˆ—å‡ºè°åœ¨ä½¿ç”¨æŸä¸ªç‰¹å®šçš„tcpç«¯å£ $ lsof -u \u003cusername\u003e //åˆ—å‡ºæŸä¸ªç”¨æˆ·æ‰“å¼€çš„æ–‡ä»¶ä¿¡æ¯   7. ps  pså‘½ä»¤ç”¨äºæŠ¥å‘Šå½“å‰ç³»ç»Ÿçš„è¿›ç¨‹çŠ¶æ€ã€‚å¯ä»¥æ­é…killæŒ‡ä»¤éšæ—¶ä¸­æ–­ã€åˆ é™¤ä¸å¿…è¦çš„ç¨‹åºã€‚pså‘½ä»¤æ˜¯æœ€åŸºæœ¬åŒæ—¶ä¹Ÿæ˜¯éå¸¸å¼ºå¤§çš„è¿›ç¨‹æŸ¥çœ‹å‘½ä»¤ï¼Œä½¿ç”¨è¯¥å‘½ä»¤å¯ä»¥ç¡®å®šæœ‰å“ªäº›è¿›ç¨‹æ­£åœ¨è¿è¡Œå’Œè¿è¡Œçš„çŠ¶æ€ã€è¿›ç¨‹æ˜¯å¦ç»“æŸã€è¿›ç¨‹æœ‰æ²¡æœ‰åƒµæ­»ã€å“ªäº›è¿›ç¨‹å ç”¨äº†è¿‡å¤šçš„èµ„æºç­‰ç­‰ï¼Œæ€»ä¹‹å¤§éƒ¨åˆ†ä¿¡æ¯éƒ½æ˜¯å¯ä»¥é€šè¿‡æ‰§è¡Œè¯¥å‘½ä»¤å¾—åˆ°çš„\n 1 2 3 4 5  $ ps -A //æ˜¾ç¤ºæ‰€æœ‰è¿›ç¨‹ä¿¡æ¯ $ ps -u root //æ˜¾ç¤ºæŒ‡å®šç”¨æˆ·ä¿¡æ¯ $ ps -ef //æ˜¾ç¤ºæ‰€æœ‰è¿›ç¨‹ä¿¡æ¯,è¿åŒå‘½ä»¤è¡Œ   8. df  dfå‘½ä»¤ç”¨äºæ˜¾ç¤ºç£ç›˜åˆ†åŒºä¸Šçš„å¯ä½¿ç”¨çš„ç£ç›˜ç©ºé—´ã€‚é»˜è®¤æ˜¾ç¤ºå•ä½ä¸ºKBã€‚å¯ä»¥åˆ©ç”¨è¯¥å‘½ä»¤æ¥è·å–ç¡¬ç›˜è¢«å ç”¨äº†å¤šå°‘ç©ºé—´ï¼Œç›®å‰è¿˜å‰©ä¸‹å¤šå°‘ç©ºé—´ç­‰ä¿¡æ¯\n 1 2 3  $ df -h //ä½¿ç”¨-h[--human-readable]é€‰é¡¹ä»¥K,M,Gä¸ºå•ä½æ¥æ˜¾ç¤º,å¯è¯»æ€§é«˜ $ df -a //æŸ¥çœ‹å…¨éƒ¨æ–‡ä»¶ç³»ç»Ÿ   9. du  duå‘½ä»¤ä¹Ÿæ˜¯æŸ¥çœ‹ä½¿ç”¨ç©ºé—´çš„ï¼Œä½†æ˜¯ä¸dfå‘½ä»¤ä¸åŒçš„æ˜¯Linux duå‘½ä»¤æ˜¯å¯¹æ–‡ä»¶å’Œç›®å½•ç£ç›˜ä½¿ç”¨çš„ç©ºé—´çš„æŸ¥çœ‹ï¼Œè¿˜æ˜¯å’Œdfå‘½ä»¤æœ‰ä¸€äº›åŒºåˆ«çš„\n 1 2 3 4 5 6 7 8 9  $ du -h \u003cfile\u003e //ä½¿ç”¨-h[--human-readable]é€‰é¡¹ä»¥K,M,Gä¸ºå•ä½æ¥æ˜¾ç¤º,å¯è¯»æ€§é«˜ $ du -c \u003cfile\u003e //ä½¿ç”¨-c[--total]é™¤äº†æ˜¾ç¤ºä¸ªåˆ«ç›®å½•æˆ–æ–‡ä»¶çš„å¤§å°å¤–,åŒæ—¶ä¹Ÿæ˜¾ç¤ºæ‰€æœ‰ç›®å½•æˆ–æ–‡ä»¶çš„æ€»å’Œ $ du --max-depth=\u003cnum\u003e \u003cfile\u003e //è®¾ç½®æœ€å¤§æ·±åº¦ $ du -sh \u003cfile\u003e //ä»…æ˜¾ç¤ºæ€»è®¡,åªåˆ—å‡ºæœ€ååŠ æ€»çš„å€¼ $ du --exclude=\u003cdir\u003e //--exclude=\u003cç›®å½•æˆ–æ–‡ä»¶\u003e ç•¥è¿‡æŒ‡å®šçš„ç›®å½•æˆ–æ–‡ä»¶   10. ln  lnå‘½ä»¤ç”¨æ¥ä¸ºæ–‡ä»¶åˆ›ä»¶è¿æ¥ï¼Œè¿æ¥ç±»å‹åˆ†ä¸ºç¡¬è¿æ¥å’Œç¬¦å·è¿æ¥ä¸¤ç§ï¼Œé»˜è®¤çš„è¿æ¥ç±»å‹æ˜¯ç¡¬è¿æ¥ã€‚å¦‚æœè¦åˆ›å»ºç¬¦å·è¿æ¥å¿…é¡»ä½¿ç”¨\"-s\"é€‰é¡¹\n 1 2 3 4 5 6 7 8 9 10  # Linuxé“¾æ¥åˆ†ä¸¤ç§,ä¸€ç§è¢«ç§°ä¸ºç¡¬é“¾æ¥(Hard Link),å¦ä¸€ç§è¢«ç§°ä¸ºç¬¦å·é“¾æ¥(Symbolic Link).é»˜è®¤æƒ…å†µä¸‹,lnå‘½ä»¤äº§ç”Ÿç¡¬é“¾æ¥ $ ln -s //å¯¹æºæ–‡ä»¶å»ºç«‹ç¬¦å·è¿æ¥,è€Œéç¡¬è¿æ¥ # å¯¹ç¡¬é“¾æ¥æœ‰å¦‚ä¸‹é™åˆ¶: # 1. ä¸èƒ½å¯¹ç›®å½•æ–‡ä»¶åšç¡¬é“¾æ¥ # 2. ä¸èƒ½åœ¨ä¸åŒçš„æ–‡ä»¶ç³»ç»Ÿä¹‹é—´åšç¡¬é“¾æ¥,é“¾æ¥æ–‡ä»¶å’Œè¢«é“¾æ¥æ–‡ä»¶å¿…é¡»ä½äºåŒä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿä¸­ # ç¬¦å·é“¾æ¥æ²¡æœ‰ç¡¬é“¾æ¥çš„é™åˆ¶,å¯ä»¥å¯¹ç›®å½•æ–‡ä»¶åšç¬¦å·é“¾æ¥,ä¹Ÿå¯ä»¥åœ¨ä¸åŒæ–‡ä»¶ç³»ç»Ÿä¹‹é—´åšç¬¦å·é“¾æ¥ # ç”¨ln -så‘½ä»¤å»ºç«‹ç¬¦å·é“¾æ¥æ—¶,æºæ–‡ä»¶æœ€å¥½ç”¨ç»å¯¹è·¯å¾„å,è¿™æ ·å¯ä»¥åœ¨ä»»ä½•å·¥ä½œç›®å½•ä¸‹è¿›è¡Œç¬¦å·é“¾æ¥.è€Œå½“æºæ–‡ä»¶ç”¨ç›¸å¯¹è·¯å¾„æ—¶,å¦‚æœå½“å‰çš„å·¥ä½œè·¯å¾„ä¸è¦åˆ›å»ºçš„ç¬¦å·é“¾æ¥æ–‡ä»¶æ‰€åœ¨è·¯å¾„ä¸åŒ,å°±ä¸èƒ½è¿›è¡Œé“¾æ¥   å¯ä»¥å‚è€ƒè¿™ç¯‡æ–‡ç« â€™è½¯é“¾æ¥â€™å’Œâ€™ç¡¬é“¾æ¥â€™çš„åŒºåˆ«\n11. ls  lså‘½ä»¤ç”¨æ¥æ˜¾ç¤ºç›®æ ‡åˆ—è¡¨\n 1 2 3 4 5  $ ls -a //æ˜¾ç¤ºæ‰€æœ‰æ¡£æ¡ˆåŠç›®å½•(æ˜¾ç¤ºéšè—æ–‡ä»¶) $ ls -i //æ˜¾ç¤ºæ–‡ä»¶ç´¢å¼•èŠ‚ç‚¹å·(inode).ä¸€ä¸ªç´¢å¼•èŠ‚ç‚¹ä»£è¡¨ä¸€ä¸ªæ–‡ä»¶[å…·æœ‰ç›¸åŒçš„ç´¢å¼•èŠ‚ç‚¹(inode)å·çš„ä¸¤ä¸ªæ–‡æœ¬æœ¬è´¨ä¸Šæ˜¯åŒä¸€ä¸ªæ–‡ä»¶(é™¤æ–‡ä»¶åä¸åŒå¤–)] $ ls -l //ä»¥é•¿æ ¼å¼æ˜¾ç¤ºç›®å½•ä¸‹çš„å†…å®¹åˆ—è¡¨.è¾“å‡ºçš„ä¿¡æ¯ä»å·¦åˆ°å³ä¾æ¬¡åŒ…æ‹¬æ–‡ä»¶å,æ–‡ä»¶ç±»å‹,æƒé™æ¨¡å¼,ç¡¬è¿æ¥æ•°,æ‰€æœ‰è€…,ç»„,æ–‡ä»¶å¤§å°å’Œæ–‡ä»¶çš„æœ€åä¿®æ”¹æ—¶é—´ç­‰ $ ls -t //æœ€è¿‘ä¿®æ”¹çš„æ–‡ä»¶æ˜¾ç¤ºåœ¨æœ€ä¸Šé¢ $ ls -h //ä½¿ç”¨-h[--human-readable]é€‰é¡¹ä»¥K,M,Gä¸ºå•ä½æ¥æ˜¾ç¤º,å¯è¯»æ€§é«˜   12. mkdir  mkdirå‘½ä»¤ç”¨æ¥åˆ›å»ºç›®å½•ã€‚è¯¥å‘½ä»¤åˆ›å»ºç”±dirnameå‘½åçš„ç›®å½•ã€‚å¦‚æœåœ¨ç›®å½•åçš„å‰é¢æ²¡æœ‰åŠ ä»»ä½•è·¯å¾„åï¼Œåˆ™åœ¨å½“å‰ç›®å½•ä¸‹åˆ›å»ºç”±dirnameæŒ‡å®šçš„ç›®å½•ï¼›å¦‚æœç»™å‡ºäº†ä¸€ä¸ªå·²ç»å­˜åœ¨çš„è·¯å¾„ï¼Œå°†ä¼šåœ¨è¯¥ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªæŒ‡å®šçš„ç›®å½•ã€‚åœ¨åˆ›å»ºç›®å½•æ—¶ï¼Œåº”ä¿è¯æ–°å»ºçš„ç›®å½•ä¸å®ƒæ‰€åœ¨ç›®å½•ä¸‹çš„æ–‡ä»¶æ²¡æœ‰é‡å\n 1 2  $ mkdir -m 755 /usr/test //å»ºç«‹ç›®å½•çš„åŒæ—¶è®¾ç½®ç›®å½•çš„æƒé™ $ mkdir -p /usr/test //è‹¥æ‰€è¦å»ºç«‹ç›®å½•çš„ä¸Šå±‚ç›®å½•ç›®å‰å°šæœªå»ºç«‹,åˆ™ä¼šä¸€å¹¶å»ºç«‹ä¸Šå±‚ç›®å½•   13. scp  scp [å‚æ•°] [åŸè·¯å¾„] [ç›®æ ‡è·¯å¾„]\n -1 å¼ºåˆ¶scpå‘½ä»¤ä½¿ç”¨åè®®ssh1 -2 å¼ºåˆ¶scpå‘½ä»¤ä½¿ç”¨åè®®ssh2 -4 å¼ºåˆ¶scpå‘½ä»¤åªä½¿ç”¨IPv4å¯»å€ -6 å¼ºåˆ¶scpå‘½ä»¤åªä½¿ç”¨IPv6å¯»å€ -B ä½¿ç”¨æ‰¹å¤„ç†æ¨¡å¼ï¼ˆä¼ è¾“è¿‡ç¨‹ä¸­ä¸è¯¢é—®ä¼ è¾“å£ä»¤æˆ–çŸ­è¯­ï¼‰ -C å…è®¸å‹ç¼©ã€‚ï¼ˆå°†-Cæ ‡å¿—ä¼ é€’ç»™sshï¼Œä»è€Œæ‰“å¼€å‹ç¼©åŠŸèƒ½ï¼‰ -p ç•™åŸæ–‡ä»¶çš„ä¿®æ”¹æ—¶é—´ï¼Œè®¿é—®æ—¶é—´å’Œè®¿é—®æƒé™ã€‚ -q ä¸æ˜¾ç¤ºä¼ è¾“è¿›åº¦æ¡ã€‚ -r é€’å½’å¤åˆ¶æ•´ä¸ªç›®å½•ã€‚ -v è¯¦ç»†æ–¹å¼æ˜¾ç¤ºè¾“å‡ºã€‚scpå’Œssh(1)ä¼šæ˜¾ç¤ºå‡ºæ•´ä¸ªè¿‡ç¨‹çš„è°ƒè¯•ä¿¡æ¯ã€‚è¿™äº›ä¿¡æ¯ç”¨äºè°ƒè¯•è¿æ¥ï¼ŒéªŒè¯å’Œé…ç½®é—®é¢˜ã€‚ -c cipher ä»¥cipherå°†æ•°æ®ä¼ è¾“è¿›è¡ŒåŠ å¯†ï¼Œè¿™ä¸ªé€‰é¡¹å°†ç›´æ¥ä¼ é€’ç»™sshã€‚ -F ssh_config æŒ‡å®šä¸€ä¸ªæ›¿ä»£çš„sshé…ç½®æ–‡ä»¶ï¼Œæ­¤å‚æ•°ç›´æ¥ä¼ é€’ç»™sshã€‚ -i identity_file ä»æŒ‡å®šæ–‡ä»¶ä¸­è¯»å–ä¼ è¾“æ—¶ä½¿ç”¨çš„å¯†é’¥æ–‡ä»¶ï¼Œæ­¤å‚æ•°ç›´æ¥ä¼ é€’ç»™sshã€‚ -l limit é™å®šç”¨æˆ·æ‰€èƒ½ä½¿ç”¨çš„å¸¦å®½ï¼Œä»¥Kbit/sä¸ºå•ä½ã€‚ -o ssh_option å¦‚æœä¹ æƒ¯äºä½¿ç”¨ssh_config(5)ä¸­çš„å‚æ•°ä¼ é€’æ–¹å¼ï¼Œ -P port æ³¨æ„æ˜¯å¤§å†™çš„P, portæ˜¯æŒ‡å®šæ•°æ®ä¼ è¾“ç”¨åˆ°çš„ç«¯å£å· -S program æŒ‡å®šåŠ å¯†ä¼ è¾“æ—¶æ‰€ä½¿ç”¨çš„ç¨‹åºã€‚æ­¤ç¨‹åºå¿…é¡»èƒ½å¤Ÿç†è§£ssh(1)çš„é€‰é¡¹ã€‚ ä»è¿œå¤„å¤åˆ¶æ–‡ä»¶åˆ°æœ¬åœ°ç›®å½• 1  $ scp root@10.6.159.147:/opt/soft/demo.tar /opt/soft/   ä»è¿œå¤„å¤åˆ¶åˆ°æœ¬åœ° $ scp -r root@10.6.159.147:/opt/soft/test /opt/soft/ ä¸Šä¼ æœ¬åœ°æ–‡ä»¶åˆ°è¿œç¨‹æœºå™¨æŒ‡å®šç›®å½• $ scp /opt/soft/demo.tar root@10.6.159.147:/opt/soft/scptest ä¸Šä¼ æœ¬åœ°ç›®å½•åˆ°è¿œç¨‹æœºå™¨æŒ‡å®šç›®å½• $ scp -r /opt/soft/test root@10.6.159.147:/opt/soft/scptest ","description":"","tags":["linux"],"title":"Linux å¸¸ç”¨å‘½ä»¤","uri":"/linux/scripts/"},{"categories":["mysql"],"content":"1 2 3 4 5 6  binlogæ˜¯Mysql severå±‚ç»´æŠ¤çš„ä¸€ç§äºŒè¿›åˆ¶æ—¥å¿—ï¼Œä¸innodbå¼•æ“ä¸­çš„redo/undo logæ˜¯å®Œå…¨ä¸åŒçš„æ—¥å¿—ï¼›å…¶ä¸»è¦æ˜¯ç”¨æ¥è®°å½•å¯¹mysqlæ•°æ®æ›´æ–°æˆ–æ½œåœ¨å‘ç”Ÿæ›´æ–°çš„SQLè¯­å¥ï¼Œå¹¶ä»¥\"äº‹åŠ¡\"çš„å½¢å¼ä¿å­˜åœ¨ç£ç›˜ä¸­ ä½œç”¨ä¸»è¦æœ‰ï¼š 1. å¤åˆ¶ï¼šMySQL Replicationåœ¨Masterç«¯å¼€å¯binlogï¼ŒMasteræŠŠå®ƒçš„äºŒè¿›åˆ¶æ—¥å¿—ä¼ é€’ç»™slaveså¹¶å›æ”¾æ¥è¾¾åˆ°master-slaveæ•°æ®ä¸€è‡´çš„ç›®çš„ 2. æ•°æ®æ¢å¤ï¼šé€šè¿‡mysqlbinlogå·¥å…·æ¢å¤æ•°æ® 3. å¢é‡å¤‡ä»½   1  å®ƒåŒ…å«æ‰€æœ‰æ›´æ–°æ•°æ®çš„è¯­å¥ï¼Œä»–è¿˜åŒ…å«è¯­å¥é‚£äº›æ‰€æœ‰æ½œåœ¨çš„å¯èƒ½æ›´æ–°çš„è¯­å¥(ä¾‹å¦‚ä¸€ä¸ªä¸åŒ¹é…ä»»ä½•è¡Œçš„åˆ é™¤è¯­å¥)ã€‚äºŒè¿›åˆ¶æ—¥å¿—è¿˜åŒ…å«ä¿¡æ¯æ›´æ–°æ•°æ®çš„æ¯ä¸ªè¯­å¥éœ€è¦å¤šé•¿æ—¶é—´   è·å–å½“å‰äºŒè¿›åˆ¶æ—¥å¿—åˆ—è¡¨ 1  $ SHOW BINARY LOGS;   æŒ‡å®šæ•°æ®åº“ 1  é»˜è®¤æƒ…å†µä¸‹ï¼Œbinlogä¼šæ˜¾ç¤ºæ‰€æœ‰çš„å†…å®¹ï¼Œå¤ªè¿‡äºæ‚ä¹±ã€‚ä½¿ç”¨ -d(--database) é€‰é¡¹ï¼Œå¯ä»¥æŒ‡å®šä¸€ä¸ªæ•°æ®åº“åç§°ï¼Œå°†åªæ˜¾ç¤ºåœ¨è¯¥æ•°æ®åº“ä¸Šæ‰€å‘ç”Ÿçš„äº‹ä»¶   æŸ¥çœ‹ç‰¹å®šå¼€å§‹æ—¶é—´ 1  --start-datetime   æŸ¥çœ‹ç‰¹å®šç»“æŸæ—¶é—´ 1  --stop-datetime   å°†æ¡ç›®æˆªæ­¢åˆ°ä¸€ä¸ªç‰¹å®šçš„ä½ç½® 1  --stop-position   1 2 3 4 5 6 7 8  ä½¿ç”¨base64-outputé€‰é¡¹ï¼Œå¯ä»¥æ§åˆ¶è¾“å‡ºè¯­å¥ä½•æ—¶æ˜¯è¾“å‡ºbase64ç¼–ç çš„BINLOGè¯­å¥ã€‚ä»¥ä¸‹æ˜¯base64è¾“å‡ºè®¾ç½®çš„å¯èƒ½å€¼ï¼š 1. never 2. always 3. decode-rows 4. autoï¼ˆé»˜è®¤ï¼‰ 5. neverï¼šå½“æŒ‡å®šå¦‚ä¸‹æ‰€ç¤ºçš„â€œneverâ€æ—¶ï¼Œå®ƒå°†åœ¨è¾“å‡ºä¸­æ˜¾ç¤ºbase64ç¼–ç çš„BINLOGè¯­å¥ã€‚ decode-rowsï¼šè¿™ä¸ªé€‰é¡¹å°†æŠŠåŸºäºè¡Œçš„äº‹ä»¶è§£ç æˆä¸€ä¸ªSQLè¯­å¥ï¼Œç‰¹åˆ«æ˜¯å½“æŒ‡å®š-verboseé€‰é¡¹(-v)æ—¶ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚   ç¤ºä¾‹: 1 2 3  $ mysqlbinlog --database \u003cdb\u003e --base64-output=decode-rows --start-datetime='2019-05-18 05:17:35' --stop-datetime='2019-05-18 05:55:55' --stop-position=177687190 -v mysql-bin.005061 \u003e 1.sql $ mysqlbinlog -R -h \u003chost\u003e\u003e -u \u003cuser\u003e -p --database \u003cdb\u003e --base64-output=decode-rows --start-datetime='2019-05-18 05:17:35' --stop-datetime='2019-05-18 05:55:55' --stop-position=177687190 -v mysql-bin.005061   å‚è€ƒæ–‡ç« \n","description":"","tags":["mysql"],"title":"Mysql Binlog","uri":"/mysql/binlog/"},{"categories":["php"],"content":" å®šä¹‰: åŒ¿åå‡½æ•°å°±æ˜¯æ²¡æœ‰åç§°çš„å‡½æ•°ï¼ŒåŒ¿åå‡½æ•°å¯ä»¥èµ‹å€¼ç»™å˜é‡ã€‚\n 1 2 3 4 5 6 7  \u003c?php $closure = function ($country) { return 'Welcome to ' . $country; }; echo $closure('China');   æˆ‘ä»¬ä¹‹æ‰€ä»¥å¯ä»¥è°ƒç”¨ $closure å˜é‡ï¼Œæ˜¯å› ä¸ºè¿™ä¸ªå˜é‡çš„å€¼æ˜¯ä¸€ä¸ªé—­åŒ…ï¼Œè€Œä¸”é—­åŒ…å¯¹è±¡å®ç°äº†__invoke() é­”æœ¯æ–¹æ³•ï¼Œåªè¦åé¢è·Ÿç€ ()ï¼ŒPHP å°±ä¼šæŸ¥æ‰¾__invoke() æ–¹æ³•ã€‚å½“å°è¯•ä»¥è°ƒç”¨å‡½æ•°çš„æ–¹å¼è°ƒç”¨ä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œ__invoke() æ–¹æ³•ä¼šè¢«è‡ªåŠ¨è°ƒç”¨ã€‚ 1 2 3 4 5 6 7 8 9 10 11 12  \u003c?php class Example() { public function __invoke() { echo 'Example.'; } } $obj = new Example; $obj();   1 2 3 4 5 6 7 8 9 10 11  function enclosePerson($name) { return function ($doCommand) use ($name) { return sprintf('%s , %s', $name, $doCommand); }; } //æŠŠå­—ç¬¦ä¸²â€œClayâ€å°è£…åœ¨é—­åŒ…ä¸­ $clay = enclosePerson('Clay'); //ä¼ å…¥å‚æ•°ï¼Œè°ƒç”¨é—­åŒ… echo $clay('get me sweat tea!'); // Clay, get me sweat tea!   åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå‡½æ•° enclosePerson() æœ‰ä¸€ä¸ª $name å‚æ•°ï¼Œè¿™ä¸ªå‡½æ•°è¿”å›ä¸€ä¸ªé—­åŒ…å¯¹è±¡ï¼Œè¿™ä¸ªé—­åŒ…å°è£…äº† $name å‚æ•°ï¼Œå³ä¾¿è¿”å›çš„å¯¹è±¡è·³å‡ºäº† enclosePerson() å‡½æ•°çš„ä½œç”¨åŸŸï¼Œå®ƒä¹Ÿä¼šè®°ä½ $name å‚æ•°çš„å€¼ï¼Œå› ä¸º $name å˜é‡ä»ç„¶åœ¨é—­åŒ…ä¸­ ä½¿ç”¨ use å…³é”®å­—å¯ä»¥æŠŠå¤šä¸ªå…³é”®å­—ä¼ å…¥é—­åŒ…ï¼Œæ­¤æ—¶è¦æƒ³åƒ PHP å‡½æ•°æˆ–æ–¹æ³•çš„å‚æ•°ä¸€æ ·ï¼Œä½¿ç”¨é€—å·åˆ†å‰²å¤šä¸ªå‚æ•°ã€‚ PHP é—­åŒ…ä»ç„¶æ˜¯å¯¹è±¡ï¼Œå¯ä»¥ä½¿ç”¨ $this å…³é”®å­—è·å–é—­åŒ…çš„å†…éƒ¨çŠ¶æ€ã€‚é—­åŒ…çš„é»˜è®¤çŠ¶æ€é‡Œé¢æœ‰ä¸€ä¸ª__invoke() é­”æœ¯æ–¹æ³•å’Œ bindTo() æ–¹æ³•ã€‚ bindTo() æ–¹æ³•ä¸ºé—­åŒ…å¢åŠ äº†ä¸€äº›æœ‰è¶£çš„ä¸œè¥¿ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™ä¸ªæ–¹æ³•æŠŠ Closure å¯¹è±¡å†…éƒ¨çŠ¶æ€ç»‘å®šåˆ°å…¶ä»–å¯¹è±¡ä¸Šã€‚bindTo() æ–¹æ³•çš„ç¬¬äºŒä¸ªå‚æ•°å¯ä»¥æŒ‡å®šç»‘å®šé—­åŒ…çš„é‚£ä¸ªå¯¹è±¡æ‰€å±çš„ PHP ç±»ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥è®¿é—®è¿™ä¸ªç±»çš„å—ä¿æŠ¤å’Œç§æœ‰çš„æˆå‘˜å˜é‡ã€‚ åŒ¿åå‡½æ•°çš„å¥½å¤„ 1ã€éåŒ¿åå‡½æ•°åœ¨å®šä¹‰æ—¶å°±åˆ›å»ºå‡½æ•°å¯¹è±¡å’Œä½œç”¨åŸŸå¯¹è±¡ï¼Œä»¥åå³ä½¿æœªè°ƒç”¨ï¼Œä¹Ÿå ç©ºé—´ 2ã€åŒ¿åå‡½æ•°åªæœ‰åœ¨è°ƒç”¨æ—¶ï¼Œæ‰ä¼šåˆ›å»ºå‡½æ•°å¯¹è±¡å’Œä½œç”¨åŸŸå¯¹è±¡ã€‚è°ƒç”¨å®Œåç«‹å³é‡Šæ”¾ï¼ŒèŠ‚çœå†…å­˜ 3ã€å½“æˆ‘ä»¬çš„ç¨‹åºè¿è¡Œçš„æ—¶å€™ï¼ŒBå¯¹è±¡æ˜¯ä¸ä¼šåˆ›å»ºçš„ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™æ—¶å®ƒè¿˜ä¸ä¼šå ç”¨èµ„æºå ç”¨å†…å­˜ã€‚è€Œå½“æˆ‘ä»¬éœ€è¦çš„æ—¶å€™ï¼Œä»æœåŠ¡å®¹å™¨ä¸­æ‹¿å‡ºæ¥çš„æ—¶å€™æ‰åˆ©ç”¨é—­åŒ…çœŸæ­£çš„å»åˆ›å»ºå¯¹è±¡ã€‚åŒç†ï¼Œäº‹ä»¶çš„å›è°ƒä¹Ÿæ˜¯ä¸€æ ·çš„æ¦‚å¿µã€‚äº‹ä»¶å‘ç”Ÿæ—¶åœ¨æˆ‘ä»¬éœ€è¦å¤„ç†çš„æ—¶å€™æ‰å»æ‰§è¡Œå›è°ƒé‡Œé¢çš„ä»£ç  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16  \u003c?php class Hen { public $name = 'hen~'; public function play(Closure $call) : string { $call = $call-\u003ebindTo($this); return call_user_func($call); } } $hen = new Hen(); echo $hen-\u003eplay(function(){ return $this-\u003ename; }), PHP_EOL;   å‚è€ƒèµ„æ–™\n","description":"","tags":["php","closure"],"title":"é—­åŒ…å’ŒåŒ¿åå‡½æ•°","uri":"/php/closure/"},{"categories":["linux"],"content":" vim ä¸€å…±æœ‰å››ç§æ¨¡å¼ï¼Œåˆ†åˆ«æ˜¯æ­£å¸¸æ¨¡å¼ã€æ’å…¥æ¨¡å¼ã€å‘½ä»¤æ¨¡å¼ã€å¯è§†æ¨¡å¼\n 1. æ­£å¸¸æ¨¡å¼ å¯åŠ¨vimåé»˜è®¤å¤„äºæ­£å¸¸æ¨¡å¼ã€‚ä¸è®ºä½äºä»€ä¹ˆæ¨¡å¼ï¼ŒæŒ‰ä¸‹\u003cEsc\u003eé”®(æœ‰æ—¶éœ€è¦æŒ‰ä¸¤ä¸‹ï¼‰éƒ½ä¼šè¿›å…¥æ­£å¸¸æ¨¡å¼ã€‚ 2. æ’å…¥æ¨¡å¼ åœ¨æ­£å¸¸æ¨¡å¼ä¸­æŒ‰ä¸‹i, I, a, Aç­‰é”®ï¼Œä¼šè¿›å…¥æ’å…¥æ¨¡å¼ã€‚ç°åœ¨åªç”¨è®°ä½æŒ‰ié”®ä¼šè¿›è¡Œæ’å…¥æ¨¡å¼ã€‚åœ¨æ’å…¥æ¨¡å¼ä¸­ï¼Œå‡»é”®æ—¶ä¼šå†™å…¥ç›¸åº”çš„å­—ç¬¦ã€‚ 3. å‘½ä»¤æ¨¡å¼ åœ¨æ­£å¸¸æ¨¡å¼ä¸­ï¼ŒæŒ‰ä¸‹:ï¼ˆè‹±æ–‡å†’å·ï¼‰é”®ï¼Œä¼šè¿›å…¥å‘½ä»¤æ¨¡å¼ã€‚åœ¨å‘½ä»¤æ¨¡å¼ä¸­å¯ä»¥æ‰§è¡Œä¸€äº›è¾“å…¥å¹¶æ‰§è¡Œä¸€äº›vimæˆ–æ’ä»¶æä¾›çš„æŒ‡ä»¤ï¼Œå°±åƒåœ¨shellé‡Œä¸€æ ·ã€‚è¿™äº›æŒ‡ä»¤åŒ…æ‹¬è®¾ç½®ç¯å¢ƒã€æ–‡ä»¶æ“ä½œã€è°ƒç”¨æŸä¸ªåŠŸèƒ½ç­‰ç­‰ã€‚ å¸¸ç”¨çš„å‘½ä»¤æœ‰ï¼šqï¼ˆé€€å‡ºï¼‰ã€q!ï¼ˆå¼ºåˆ¶é€€å‡ºï¼‰ã€wï¼ˆä¿å­˜ï¼‰ã€wqï¼ˆä¿å­˜å¹¶é€€å‡ºï¼‰ã€‚ 4. å¯è§†æ¨¡å¼ åœ¨æ­£å¸¸æ¨¡å¼ä¸­æŒ‰ä¸‹v, V, \u003cCtrl\u003e+vï¼Œå¯ä»¥è¿›å…¥å¯è§†æ¨¡å¼ã€‚å¯è§†æ¨¡å¼ä¸­çš„æ“ä½œæœ‰ç‚¹åƒæ‹¿é¼ æ ‡è¿›è¡Œæ“ä½œï¼Œé€‰æ‹©æ–‡æœ¬çš„æ—¶å€™æœ‰ä¸€ç§é¼ æ ‡é€‰æ‹©çš„å³è§†æ„Ÿï¼Œæœ‰æ—¶å€™ä¼šå¾ˆæ–¹ä¾¿ã€‚  å¸¸ç”¨å‘½ä»¤\n 1. å›åˆ°å½“å‰è¡Œçš„è¡Œé¦– 0 2. å›åˆ°å½“å‰è¡Œçš„è¡Œå°¾ $ 3. å¤åˆ¶ä¸€è¡Œ yy 8yy //å‘ä¸‹å¤åˆ¶8è¡Œ 4. ç²˜è´´å†…å®¹ p 5p //ç²˜è´´5æ¬¡ 5. åˆ é™¤æ¸¸æ ‡æ‰€åœ¨è¡Œï¼Œå¹¶è¿›å…¥æ’å…¥æ¨¡å¼ cc 6. æ’å…¥ i æ’å…¥åˆ°å…‰æ ‡å‰é¢ I æ’å…¥åˆ°è¡Œçš„å¼€å§‹ä½ç½® a æ’å…¥åˆ°å…‰æ ‡çš„åé¢ A æ’å…¥åˆ°è¡Œçš„æœ€åä½ç½® 7.é‡å¤æœ€åä¸€ä¸ªå‘½ä»¤ . 8. æ’¤é”€ä¸Šä¸€æ­¥æ“ä½œ u ","description":"","tags":["linux","vim"],"title":"Vim ä¸€äº›å¥½ç”¨çš„å‘½ä»¤","uri":"/linux/vim/"},{"categories":["git"],"content":"ä¿®æ”¹æ²¡æœ‰æäº¤åˆ°æš‚å­˜åŒº,æƒ³è¦å›æ»šæ€ä¹ˆåŠ 1  $ git checkout -- filename //å›æ»šå•ä¸ªæ–‡ä»¶   1  $ git checkout . //å›æ»šæ‰€æœ‰æ–‡ä»¶   ä»£ç å†™é”™äº†åˆ†æ”¯ git add . //æŠŠæ‰€æœ‰æ”¹åŠ¨æš‚å­˜ git stash //æŠŠæš‚å­˜çš„æ–‡ä»¶æäº¤åˆ°gitçš„æš‚å­˜æ ˆ git checkout //è¿å‡ºå¯¹åº”çš„åˆ†æ”¯ git stash pop //å°†æš‚å­˜æ ˆä¸­çš„ä»£ç æ”¾å‡ºæ¥ ä»£ç å›æ»š $ git reset --hard HEAD^ //å›é€€åˆ°ä¸Šä¸ªç‰ˆæœ¬ $ git reset --hard HEAD~3 //å›é€€åˆ°å‰3æ¬¡æäº¤ä¹‹å‰ï¼Œä»¥æ­¤ç±»æ¨ï¼Œå›é€€åˆ°næ¬¡æäº¤ä¹‹å‰ $ git reset --hard commit_id //é€€åˆ°/è¿›åˆ° æŒ‡å®šcommitçš„shaç  ","description":"","tags":["git"],"title":"Git ä¸€äº›å¥½ç”¨çš„å‘½ä»¤","uri":"/git/usage/"},{"categories":["aliyun"],"content":" é˜¿é‡Œäº‘OSSå¯ä»¥åˆ›å»ºå¤šä¸ªbucket, é€šè¿‡ç»™æŒ‡å®šbucketåˆ†é…æƒé™, é™åˆ¶åªå…è®¸æ“ä½œæŒ‡å®šçš„bucket\n åœ¨ bucket åŸºç¡€è®¾ç½®ä¸­, è®¾ç½®é™æ€é¡µé¢é…ç½®é»˜è®¤é¦–é¡µä¸ºindex.php, é»˜è®¤404é¡µä¸º index.php ä¹‹åå†é…ç½®åŸŸåè¯ä¹¦CDNç­‰, å°±å¯ä»¥å°†è‡ªå·±çš„ç«™ç‚¹éƒ¨ç½²åˆ°OSSä¸Š ","description":"","tags":["aliyun","oss"],"title":"Ossæ„å»ºç«™ç‚¹","uri":"/aliyun/website/"},{"categories":["aliyun"],"content":" é˜¿é‡Œäº‘OSSå¯ä»¥åˆ›å»ºå¤šä¸ªbucket, é€šè¿‡ç»™æŒ‡å®šbucketåˆ†é…æƒé™, é™åˆ¶åªå…è®¸æ“ä½œæŒ‡å®šçš„bucket\n å‡è®¾é…ç½®çš„bucketåç§°æ˜¯: bucket ä¸‹é¢è¿™ä¸‰æ®µJSON, ç¬¬ä¸€æ®µæ˜¯å…è®¸ç”¨æˆ·ç™»å½•, ç¬¬äºŒæ®µå…è®¸æ“ä½œbucket, ç¬¬ä¸‰æ®µå…è®¸æ“ä½œbucketå†…çš„èµ„æº\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35  { \"Version\": \"1\", \"Statement\": [ { \"Effect\": \"Allow\", \"Action\": [ \"oss:ListBuckets\", \"oss:GetBucketStat\", \"oss:GetBucketInfo\", \"oss:GetBucketAcl\" ], \"Resource\": \"acs:oss:*:*:*\" }, { \"Effect\": \"Allow\", \"Action\": [ \"oss:Get*\", \"oss:Put*\", \"oss:List*\", \"oss:DeleteObject\" ], \"Resource\": \"acs:oss:*:*:bucket\" }, { \"Effect\": \"Allow\", \"Action\": [ \"oss:Get*\", \"oss:Put*\", \"oss:List*\", \"oss:DeleteObject\" ], \"Resource\": \"acs:oss:*:*:bucket/*\" } ] }   ","description":"","tags":["aliyun","oss"],"title":"Ossæƒé™é…ç½®","uri":"/aliyun/oss-permission/"},{"categories":["c"],"content":"C ç¤ºä¾‹: 1  $ vim hello.world.c   1 2 3 4 5 6 7 8  #include \u003cstdio.h\u003e int main() { printf(\"Hello World\"); return 0; }   1 2  # ç¼–è¯‘é¡¹ç›® gcc hello.world.c -o hello-example1   C++ ç¤ºä¾‹: 1  $ vim hello.world.cpp   1 2 3 4 5 6 7 8 9 10  #include \u003ciostream\u003e using namespace std; int main() { cout \u003c\u003c \"Hello World\"; return 0; }   1  g++ hello.world.cpp -o hello-example2   ","description":"","tags":["c","c++"],"title":"C å’Œ C++ å…¥é—¨ç¤ºä¾‹","uri":"/c++/basic-usage/"},{"categories":["linux"],"content":"ä¸‹è½½ ohmyzsh 1  $ sh -c \"$(curl -fsSL https://raw.github.com/ohmyzsh/ohmyzsh/master/tools/install.sh)\"   ä¸‹è½½ zsh-autosuggestions  å‘½ä»¤è‡ªåŠ¨å»ºè®®å’Œè¡¥å…¨\n 1  $ git clone git://github.com/zsh-users/zsh-autosuggestions $ZSH_CUSTOM/plugins/zsh-autosuggestions   ä¸‹è½½ zsh-syntax-highlighting  ä½¿ç”¨ zsh æ’ä»¶ zsh-syntax-highlighting é«˜äº®ä½ çš„å¯ç”¨å‘½ä»¤\n 1  $ git clone https://github.com/zsh-users/zsh-syntax-highlighting.git ${ZSH_CUSTOM:-~/.oh-my-zsh/custom}/plugins/zsh-syntax-highlighting   å¢åŠ å‡ ä¸ªå¥½ç”¨çš„åˆ«å 1 2 3 4 5 6  $ vim ~/.alias_profile alias cl=clear alias history='fc -il 1' alias k=kubernetes # å…¶ä»–åˆ«åå¯ç»§ç»­å¢åŠ    ä¿®æ”¹ ys THEMES æ ·å¼ $ vim ~/.oh-my-zsh/themes/ys.zsh-theme PROMPT=\" %{$terminfo[bold]$fg[yellow]%}%~%{$reset_color%}\\ ${hg_info}\\ \\ %{$fg[white]%}[%*] $exit_code %{$terminfo[bold]$fg[white]%}$ %{$reset_color%}\" ä¿®æ”¹.zshrc # If you come from bash you might have to change your $PATH. # export PATH=$HOME/bin:/usr/local/bin:$PATH # Path to your oh-my-zsh installation. export ZSH=\"$HOME/.oh-my-zsh\" # Set name of the theme to load --- if set to \"random\", it will # load a random theme each time oh-my-zsh is loaded, in which case, # to know which specific one was loaded, run: echo $RANDOM_THEME # See https://github.com/ohmyzsh/ohmyzsh/wiki/Themes ZSH_THEME=\"ys\" # Set list of themes to pick from when loading at random # Setting this variable when ZSH_THEME=random will cause zsh to load # a theme from this variable instead of looking in $ZSH/themes/ # If set to an empty array, this variable will have no effect. # ZSH_THEME_RANDOM_CANDIDATES=( \"robbyrussell\" \"agnoster\" ) # Uncomment the following line to use case-sensitive completion. # CASE_SENSITIVE=\"true\" # Uncomment the following line to use hyphen-insensitive completion. # Case-sensitive completion must be off. _ and - will be interchangeable. # HYPHEN_INSENSITIVE=\"true\" # Uncomment the following line to disable bi-weekly auto-update checks. # DISABLE_AUTO_UPDATE=\"true\" # Uncomment the following line to automatically update without prompting. # DISABLE_UPDATE_PROMPT=\"true\" # Uncomment the following line to change how often to auto-update (in days). export UPDATE_ZSH_DAYS=13 # Uncomment the following line if pasting URLs and other text is messed up. # DISABLE_MAGIC_FUNCTIONS=\"true\" # Uncomment the following line to disable colors in ls. # DISABLE_LS_COLORS=\"true\" # Uncomment the following line to disable auto-setting terminal title. # DISABLE_AUTO_TITLE=\"true\" # Uncomment the following line to enable command auto-correction. # ENABLE_CORRECTION=\"true\" # Uncomment the following line to display red dots whilst waiting for completion. # COMPLETION_WAITING_DOTS=\"true\" # Uncomment the following line if you want to disable marking untracked files # under VCS as dirty. This makes repository status check for large repositories # much, much faster. # DISABLE_UNTRACKED_FILES_DIRTY=\"true\" # Uncomment the following line if you want to change the command execution time # stamp shown in the history command output. # You can set one of the optional three formats: # \"mm/dd/yyyy\"|\"dd.mm.yyyy\"|\"yyyy-mm-dd\" # or set a custom format using the strftime function format specifications, # see 'man strftime' for details. HIST_STAMPS=\"mm/dd/yyyy\" # Would you like to use another custom folder than $ZSH/custom? # ZSH_CUSTOM=/path/to/new-custom-folder # Which plugins would you like to load? # Standard plugins can be found in $ZSH/plugins/ # Custom plugins may be added to $ZSH_CUSTOM/plugins/ # Example format: plugins=(rails git textmate ruby lighthouse) # Add wisely, as too many plugins slow down shell startup. plugins=( git z zsh-autosuggestions extract web-search zsh-syntax-highlighting ) source $ZSH/oh-my-zsh.sh source $HOME/.alias_profile åœ¨å½“å‰ç¯å¢ƒä¸‹è¯»å–å¹¶æ‰§è¡Œ FileName ä¸­çš„å‘½ä»¤ $ source ~/.zshrc ","description":"","tags":["linux","zsh"],"title":"å¿«é€Ÿæ­å»º Zshç¯å¢ƒåŠé…ç½®","uri":"/linux/zsh/"},{"categories":["php"],"content":"æœ‰ç”¨çš„phpå‘½ä»¤è¡Œå‘½ä»¤ 1. æŸ¥çœ‹å½“å‰å·²å®‰è£…çš„æ‰©å±• 1  $ php -m   2. æŸ¥çœ‹å½“å‰phpç‰ˆæœ¬ 1  $ php -v   3. æŸ¥çœ‹æ‰©å±•ç‰ˆæœ¬ 1  $ php --ri æ‰©å±•å   4. å¿«é€ŸæŸ¥çœ‹æ‰©å±•ç‰ˆæœ¬ 1  $ php -i | less   5. æŸ¥çœ‹phpé…ç½®æ–‡ä»¶è·¯å¾„ 1  $ php -i | grep php.ini   6. æ‰§è¡Œæ–‡ä»¶(æ£€æŸ¥ä»£ç è¯­æ³•æ˜¯å¦æ­£ç¡®) 1  $ php -f æ–‡ä»¶å   7. ç›´æ¥æ‰§è¡Œä»£ç  1 2  $ php -r 'echo 1;' $ php -r \"echo ini_get('memory_limit');\"//æŸ¥çœ‹å†…å­˜é™åˆ¶   8. æ£€æŸ¥ä»£ç è¯­æ³• 1  $ php -l æ–‡ä»¶å   9. æŸ¥çœ‹å¸®åŠ© 1  $ php -h   10. æŸ¥çœ‹å½“å‰phpå¯æ‰§è¡Œæ–‡ä»¶ä½ç½® 1  $ which php   11. å¼€å¯æœåŠ¡ 1  $ php -S 0.0.0.0:1234   12. è¯»å–ç‰¹å®šçš„iniæ–‡ä»¶ 1  $ php -c /usr/local/etc/php/php.ini   13. è®¾ç½®iniæ¡ç›® 1  $ php -d memory_limit=-1 `which composer` install   ","description":"","tags":["php"],"title":"Php Command Script","uri":"/php/script/"}]
